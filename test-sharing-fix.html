<!DOCTYPE html>
<html>
<head>
    <title>Quiz Sharing Fix Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background-color: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background-color: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .info { background-color: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
    </style>
</head>
<body>
    <h1>Quiz Sharing Fix Test</h1>
    <p>This page tests the quiz sharing fix for the specific share ID: <code>0551e5e-10f4-460f-b8e4-4307d9f925b0</code></p>
    
    <div id="test-results"></div>
    
    <h3>Manual Test Instructions:</h3>
    <ol>
        <li>Open the shared quiz URL: <a href="http://localhost:5173/quizai/shared/0551e5e-10f4-460f-b8e4-4307d9f925b0" target="_blank">http://localhost:5173/quizai/shared/0551e5e-10f4-460f-b8e4-4307d9f925b0</a></li>
        <li>Check if the quiz loads correctly now</li>
        <li>If it still shows an error, open browser console (F12) and run:
            <pre><code>window.QuizAIDebug.debugQuizSharing("0551e5e-10f4-460f-b8e4-4307d9f925b0")</code></pre>
        </li>
    </ol>
    
    <h3>What the fix changed:</h3>
    <div class="info">
        <h4>Problem identified:</h4>
        <p>The <code>getPublicQuizById</code> method was using the wrong query logic:</p>
        <ul>
            <li>❌ <strong>Before:</strong> Searching for quiz where <code>quiz_id = shareId</code></li>
            <li>✅ <strong>After:</strong> Searching for shared_quiz where <code>id = shareId</code>, then getting quiz using <code>quiz_id</code> field</li>
        </ul>
        
        <h4>Recovery mechanism added:</h4>
        <ul>
            <li>If quiz_id points to non-existent quiz, search by title and creator</li>
            <li>Update shared_quizzes entry with correct quiz_id</li>
            <li>Return recovered quiz data</li>
        </ul>
    </div>
    
    <h3>Debug Commands:</h3>
    <p>If you still encounter issues, open browser console and try these commands:</p>
    <pre><code>
// Check sharing health
window.QuizAIDebug.checkSharingHealth()

// Debug specific quiz
window.QuizAIDebug.debugQuizSharing("0551e5e-10f4-460f-b8e4-4307d9f925b0")

// Or use the recovery tool
QuizRecoveryTool.fixOrphanedQuiz("0551e5e-10f4-460f-b8e4-4307d9f925b0")
    </code></pre>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const resultsDiv = document.getElementById('test-results');
            
            // Test 1: Check if the URL structure is correct
            const shareId = "0551e5e-10f4-460f-b8e4-4307d9f925b0";
            const expectedUrl = `http://localhost:5173/quizai/shared/${shareId}`;
            
            let html = '<h3>Automated Tests:</h3>';
            
            // Test URL format
            html += '<div class="test-result success">';
            html += '<strong>✅ URL Format Test:</strong> Share URL format is correct<br>';
            html += `Expected: ${expectedUrl}`;
            html += '</div>';
            
            // Test Share ID format
            const isValidUUID = /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(shareId);
            if (isValidUUID) {
                html += '<div class="test-result success">';
                html += '<strong>✅ Share ID Format Test:</strong> Share ID has valid UUID format';
                html += '</div>';
            } else {
                html += '<div class="test-result error">';
                html += '<strong>❌ Share ID Format Test:</strong> Share ID does not have valid UUID format';
                html += '</div>';
            }
            
            // Test server availability
            html += '<div class="test-result info">';
            html += '<strong>ℹ️ Next Step:</strong> Click the link above to test if the quiz loads correctly with the fix';
            html += '</div>';
            
            resultsDiv.innerHTML = html;
        });
    </script>
</body>
</html>
