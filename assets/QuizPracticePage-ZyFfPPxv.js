import{j as e}from"./ui-BGuvgkTr.js";import{f as ee,u as te,r as d}from"./router-BxjC687J.js";import{c as E,P as re,M as A,B as z,u as se,s as ie,L as Q,C as ne,e as ae,j as oe,k as le}from"./index-RLXs16_0.js";import{u as ce}from"./useQuizFlow-DMbF_K24.js";import"./vendor-DoC2WAmd.js";import"./utils-rUpm7H1u.js";import"./markdown-Bj7tmv2T.js";const G=({question:n,options:q,currentIndex:h,totalQuestions:y,selectedOption:w,onSelectOption:a,onCheckAnswer:T,onSkipQuestion:o,isSubmitting:C,isAnswerChecked:g=!1,isAnswerCorrect:N=null,correctAnswer:p=""})=>{const{t:f}=E(),I=y>0?(h+1)/y*100:0;return e.jsxs("div",{className:"quiz-question-container",children:[e.jsxs("div",{className:"quiz-progress",children:[e.jsx("div",{className:"flex justify-between items-center mb-1.5",children:e.jsx("span",{className:"text-sm font-medium text-[var(--color-text-primary)]",children:f("quizTakingQuestionProgress",{current:h+1,total:y})})}),e.jsx(re,{progress:I,size:"md",className:"mb-5"})]}),e.jsx("div",{className:"question-content mb-4",children:e.jsx(A,{text:n,markdownFormatting:!0})}),e.jsxs("div",{className:"space-y-3",children:[" ",q.map((k,u)=>{const m=w===k,l=p===k;let b="",i="",r="";return g?m&&N?(b="answer-option-correct bg-green-100 dark:bg-green-900/30 border-green-500 text-green-700 dark:text-green-300 font-semibold scale-[1.01]",i="border-green-500 bg-green-500",r="correct-answer-pulse"):m&&!N?(b="answer-option-incorrect bg-red-100 dark:bg-red-900/30 border-red-500 text-red-700 dark:text-red-300 font-semibold scale-[1.01]",i="border-red-500 bg-red-500",r="incorrect-answer-pulse"):l?(b="answer-option-correct bg-green-100 dark:bg-green-900/30 border-green-500 text-green-700 dark:text-green-300 font-semibold",i="border-green-500 bg-green-500"):(b="bg-[var(--color-bg-surface-3)]/70 border-[var(--color-border-interactive)] text-[var(--color-text-secondary)]",i="border-[var(--color-text-muted)] bg-[var(--color-bg-surface-2)]"):(b=m?"bg-[var(--color-primary-accent)]/50 border-[var(--color-primary-accent)] text-[var(--color-primary-accent-text)] font-semibold scale-[1.01]":"bg-[var(--color-bg-surface-3)]/70 hover:bg-[var(--color-bg-surface-3)]/40 border-[var(--color-border-interactive)] hover:border-[var(--color-primary-accent)] text-[var(--color-text-primary)]",i=m?"border-[var(--color-primary-accent-text)] bg-[var(--color-primary-accent)]":"border-[var(--color-text-muted)] bg-[var(--color-bg-surface-2)] group-hover:border-[var(--color-primary-accent)]"),e.jsxs("button",{type:"button",className:`w-full flex items-center text-left p-3.5 sm:p-4 rounded-xl border-2 focus:outline-none focus-visible:ring-4 focus-visible:ring-[var(--color-primary-accent)]/50 focus-visible:ring-offset-2 shadow-lg 
                          transition-all var(--duration-fast) var(--ease-ios) will-change-transform, border, background-color
                          ${b} ${r}`,onClick:()=>a(k),disabled:C||g,"aria-pressed":m,"aria-checked":g&&l?"true":"false",children:[e.jsx("span",{className:`option-indicator mr-3.5 flex-shrink-0 w-6 h-6 rounded-full border-2 flex items-center justify-center ${i}`,children:(m||g&&l)&&e.jsx("div",{className:"w-3 h-3 bg-white rounded-full"})}),e.jsx("div",{className:"option-content flex-grow text-sm sm:text-base flex items-center",children:e.jsx(A,{text:k,markdownFormatting:!0,compact:!0,stripPrefix:!0})}),g&&e.jsx("span",{className:"ml-2",children:l?e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-green-500",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}):m&&!N?e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-red-500",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}):null})]},u)})]}),e.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-center mt-5 pt-5 border-t border-[var(--color-border-default)] gap-3",children:g?e.jsx("div",{className:"w-full flex justify-end items-center"}):e.jsxs(e.Fragment,{children:[e.jsx(z,{variant:"subtle",onClick:o,disabled:C,className:"w-full sm:w-auto",children:f("skipQuestion")}),e.jsx(z,{variant:"primary",onClick:T,disabled:C||!w,className:"w-full sm:w-auto",children:f(C?"loading":"checkAnswer")})]})})]})};G.displayName="PracticeQuizQuestion";const H=({explanation:n,className:q=""})=>{const{t:h}=E();return e.jsxs("div",{className:`animate-fadeInUp mt-5 p-5 rounded-lg bg-[var(--color-bg-surface-2)]/50 border border-[var(--color-border-default)] shadow-md ${q}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-[var(--color-primary-accent)]",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2h-1V9a1 1 0 00-1-1z",clipRule:"evenodd"})}),e.jsx("span",{className:"font-semibold text-[var(--color-primary-accent)] text-base",children:h("resultsExplanationTitle")})]}),e.jsx("div",{className:"explanation-content",children:e.jsx("div",{className:"pl-1.5 border-l-2 border-[var(--color-primary-accent)]/20",children:e.jsx("div",{className:"explanation-text text-sm leading-relaxed text-[var(--color-text-body)] markdown-content",children:e.jsx(A,{text:n,markdownFormatting:!0})})})})]})};H.displayName="PracticeQuizExplanation";const de=()=>{const{t:n}=E(),{quizId:q}=ee(),h=te(),{setQuizResult:y,currentUser:w}=se(),[a,T]=d.useState(null),[o,C]=d.useState(!1),[g,N]=d.useState(null),[p,f]=d.useState([]),[I,k]=d.useState(!1),[u,m]=d.useState(!1),l=d.useRef(!1),b=d.useCallback(()=>{l.current||k(!0)},[]),{localActiveQuiz:i,currentQuestion:r,currentQuestionIndex:P,loading:U,timeLeft:S,goToNextQuestion:O,goToPreviousQuestion:B,formatTime:J,totalQuestions:L,shuffledQuestions:M,attemptSettings:R}=ce(q,b);d.useEffect(()=>{M.length>0&&p.length===0&&f(M.map(s=>({questionId:s.id,selectedOption:null,isCorrect:null,firstTryCorrect:null,attempts:0})))},[M,p.length]),d.useEffect(()=>{if(l.current)return;let s=null,t=!1,x=null;if(r&&p.length>0){const j=p.find(F=>F.questionId===r.id);j&&(s=j.selectedOption,j.isCorrect!==null&&(t=!0,x=j.isCorrect))}T(s),C(t),N(x),m(!1)},[P,r,p]);const v=d.useCallback(async()=>{if(l.current||!i)return;l.current=!0,m(!0);let s=[...p];r&&a&&!o?s=s.map(c=>c.questionId===r.id?{...c,selectedOption:a,isCorrect:null,attempts:c.attempts||0}:c):r&&!a&&!o&&(s=s.map(c=>c.questionId===r.id?{...c,selectedOption:null,isCorrect:null}:c));const t=s.filter(c=>c.isCorrect===!0).length,x=s.map(c=>({questionId:c.questionId,answer:c.selectedOption||""})),j=i.questions.length>0?t/i.questions.length*100:0,F={quizId:i.id,score:parseFloat(j.toFixed(2)),answers:x,totalCorrect:t,totalQuestions:i.questions.length,timeTaken:R.timeLimit>0?R.timeLimit*60-(S||0):void 0,sourceMode:"practice",createdAt:new Date().toISOString()};if(y(F),w)try{const c=await ie.saveQuizResult(F,w.id,w);console.log(c?"Practice result saved to database successfully":"Practice result not saved to database (user not authenticated with Supabase, using local storage only)")}catch(c){console.error("Failed to save practice result to database:",c)}else console.log("No user logged in, practice result saved locally only");h(`/results/${i.id}`)},[i,p,r,a,o,y,R.timeLimit,S,h,w]),K=s=>{o||l.current||u||T(s)},W=()=>{if(!a||!r||l.current||u)return;m(!0);const s=a===r.correctAnswer;C(!0),N(s),f(t=>t.map(x=>x.questionId===r.id?{...x,selectedOption:a,isCorrect:s,attempts:(x.attempts||0)+1,...(x.attempts||0)===0&&{firstTryCorrect:s}}:x))},X=d.useCallback(()=>{!i||!r||l.current||u||(m(!0),a&&!o?f(s=>s.map(t=>t.questionId===r.id&&(t.selectedOption!==a||t.isCorrect===null)?{...t,selectedOption:a,isCorrect:t.isCorrect,attempts:t.attempts||0}:t)):!a&&!o&&f(s=>s.map(t=>t.questionId===r.id&&t.selectedOption!==null&&t.isCorrect===null?{...t,selectedOption:null}:t)),O()||v())},[i,r,O,v,a,o,u]),Y=d.useCallback(()=>{!i||!r||l.current||u||(m(!0),O()||v())},[i,r,O,v,u]),Z=d.useCallback(()=>{!r||l.current||u||(m(!0),a&&!o?f(s=>s.map(t=>t.questionId===r.id&&(t.selectedOption!==a||t.isCorrect===null)?{...t,selectedOption:a,isCorrect:t.isCorrect,attempts:t.attempts||0}:t)):!a&&!o&&f(s=>s.map(t=>t.questionId===r.id&&t.selectedOption!==null&&t.isCorrect===null?{...t,selectedOption:null}:t)),B())},[B,a,o,r,u]),$=d.useCallback(()=>{v()},[v]),_=(s,t)=>{const x=t.findIndex(j=>j===s);return x===-1?s:`${String.fromCharCode(65+x)}. ${s}`},V=()=>r?e.jsxs("div",{className:"space-y-4",children:[e.jsx(G,{question:r.questionText,options:r.options,currentIndex:P,totalQuestions:L,selectedOption:a,onSelectOption:K,onCheckAnswer:W,onSkipQuestion:Y,isSubmitting:u,isAnswerChecked:o,isAnswerCorrect:g,correctAnswer:r.correctAnswer}),o&&e.jsx(H,{explanation:r.explanation||n("resultsNoExplanation"),isCorrect:g===!0,correctOptionLabel:_(r.correctAnswer,r.options),showFeedbackBanner:!1})]}):null;if(u&&l.current)return e.jsx("div",{className:"flex flex-col items-center justify-center p-8 min-h-[400px]",children:e.jsx(Q,{text:n("quizPracticeEnding")||"Processing...",size:"lg"})});if(U||!i)return e.jsx(Q,{text:n("quizTakingLoading"),className:"mt-24",size:"xl"});if(!r)return i&&L>0&&P>=L?(l.current||v(),e.jsx("div",{className:"flex flex-col items-center justify-center p-8 min-h-[400px]",children:e.jsx(Q,{text:n("quizPracticeEnding")||"Completing practice...",size:"lg"})})):U?e.jsx(Q,{text:n("quizTakingLoading"),className:"mt-24",size:"xl"}):(console.error("QuizPracticePage: currentQuestion is undefined, but not due to finishing. Quiz data might be missing or an error occurred."),e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 min-h-[400px]",children:[e.jsx(Q,{text:n("error")+" - "+(n("quizTakingLoading")||"Processing..."),size:"lg"}),e.jsx(z,{onClick:()=>h("/dashboard"),className:"mt-4",children:n("resultsGoToDashboard")})]}));const D=P===L-1;return e.jsxs(ne,{className:"max-w-2xl mx-auto shadow-2xl !rounded-2xl animate-page-slide-fade-in p-5 sm:p-6",useGlassEffect:!0,children:[e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-[var(--color-text-primary)] mb-3 leading-tight tracking-tight line-clamp-2",title:i.title,children:n("quizPracticeTitle",{quizTitle:i.title})}),e.jsx("div",{className:"flex justify-between items-center text-xs text-[var(--color-text-secondary)] mb-2",children:S!==null&&e.jsx("span",{className:`font-semibold ${S<=60?"text-red-400 animate-pulse":"text-[var(--color-primary-accent)]"}`,children:n("quizTakingTimeLeft",{time:J(S)})})})]}),V(),e.jsxs("div",{className:"quiz-navigation-actions mt-6 pt-6 border-t border-[var(--color-border-default)] flex flex-col sm:flex-row sm:justify-between gap-3",children:[e.jsx(z,{variant:"secondary",onClick:Z,disabled:u||P===0,size:"md",leftIcon:e.jsx(ae,{className:"w-4 h-4"}),className:"w-full sm:w-auto",children:n("previous")}),e.jsx(z,{variant:D&&o?"primary":"secondary",onClick:o?X:v,disabled:u,size:"md",rightIcon:e.jsx(oe,{className:"w-4 h-4"}),className:"w-full sm:w-auto",children:n(o?D?"finishPractice":"nextQuestion":"finishPractice")})]}),I&&e.jsx(le,{isOpen:I&&!l.current,onClose:$,title:n("timesUp"),size:"md",hideCloseButton:!0,footerContent:e.jsx("div",{className:"flex justify-center",children:e.jsx(z,{variant:"primary",onClick:$,size:"md",children:n("timesUpSubmit")})}),children:e.jsx("p",{className:"text-[var(--color-text-body)] text-base leading-relaxed text-center",children:n("timesUpMessage")})})]})};de.displayName="QuizPracticePage";export{de as default};
