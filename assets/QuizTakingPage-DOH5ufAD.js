import{h as K,i as V,A as X,k as Y,r as o,j as e,E as M,C as q,n as b,T as Z,F as _,p as ee,B as m,w as se,q as te,x as L,H as P}from"./index-s5Pu3w2C.js";import{u as ae}from"./useQuizFlow-Kaafc0ne.js";const re=()=>{var U;const{setQuizResult:y}=K(),{t}=V(),{quizId:E}=X(),C=Y(),[n,k]=o.useState({}),[i,v]=o.useState(null),[z,u]=o.useState(!1),[T,S]=o.useState(!1),F=o.useCallback(()=>{S(!0)},[]),{localActiveQuiz:r,currentQuestion:s,currentQuestionIndex:f,loading:O,timeLeft:x,goToNextQuestion:B,goToPreviousQuestion:$,formatTime:R,totalQuestions:l,attemptSettings:j}=ae(E,F);o.useEffect(()=>{s&&n[s.id]?v(n[s.id]):v(null)},[s,n]);const D=a=>{v(a)},Q=o.useCallback(()=>{s&&i?k(a=>({...a,[s.id]:i})):s&&!i&&n[s.id]&&k(a=>{const c={...a};return delete c[s.id],c})},[s,i,n]),w=o.useCallback(()=>{if(!r)return;let a={...n};s&&i?a[s.id]=i:s&&!i&&a[s.id]&&delete a[s.id];let c=0;const d=[];r.questions.forEach(g=>{const N=a[g.id];N?(d.push({questionId:g.id,answer:N}),N===g.correctAnswer&&c++):d.push({questionId:g.id,answer:""})});const p=l>0?c/l*100:0,h={quizId:r.id,score:parseFloat(p.toFixed(2)),answers:d,totalCorrect:c,totalQuestions:l,timeTaken:j.timeLimit>0?j.timeLimit*60-(x||0):void 0,sourceMode:"take",createdAt:new Date().toISOString()};y(h),u(!1),S(!1),C(`/results/${r.id}`)},[r,n,s,i,x,y,C,l,j.timeLimit]),G=()=>{r&&(Q(),B()||u(!0))},W=()=>{Q(),$()},A=o.useCallback(()=>u(!1),[]),I=o.useCallback(()=>{w()},[w]);if(O||!r)return e.jsx(M,{text:t("quizTakingLoading"),className:"mt-24",size:"xl"});if(!s)return e.jsxs(q,{className:"max-w-3xl mx-auto shadow-2xl !rounded-2xl animate-fadeInUp",useGlassEffect:!0,children:[e.jsx(M,{text:t("quizTakingLoading")}),e.jsx("p",{className:"text-center text-[var(--color-text-secondary)] mt-4",children:t("quizTakingErrorQuestionNotFound")})]});const H=l>0?(f+1)/l*100:0,J=f===l-1;return e.jsxs(q,{className:"max-w-3xl mx-auto shadow-2xl !rounded-2xl animate-page-slide-fade-in",useGlassEffect:!0,children:[e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-[var(--color-text-primary)] mb-3 sm:mb-4 leading-tight tracking-tight line-clamp-2",title:r.title,children:e.jsx(b,{text:r.title})}),e.jsxs("div",{className:"flex justify-between items-center text-sm text-[var(--color-text-secondary)] mb-4 sm:mb-5",children:[e.jsx("span",{children:t("quizTakingQuestionProgress",{current:f+1,total:l})}),((U=r.config)==null?void 0:U.customUserPrompt)&&e.jsx(Z,{content:e.jsx("div",{className:"max-w-xs text-left text-xs",children:e.jsx(b,{text:r.config.customUserPrompt})}),placement:"bottom-end",children:e.jsx(_,{className:"w-5 h-5 text-yellow-300 cursor-help"})}),x!==null&&e.jsx("span",{className:`font-semibold ${x<=60?"text-red-400 animate-pulse":"text-[var(--color-primary-accent)]"}`,children:t("quizTakingTimeLeft",{time:R(x)})})]}),e.jsx(ee,{progress:H,size:"lg",barClassName:"bg-gradient-to-r from-[var(--color-primary-accent)] to-indigo-500"})]}),e.jsx("div",{children:e.jsx("div",{className:"p-5 sm:p-8 bg-[var(--color-bg-surface-2)]/60 rounded-xl shadow-inner border border-[var(--color-border-default)] min-h-[280px] flex flex-col",children:e.jsxs("div",{className:"animate-fadeInUp",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-[var(--color-text-primary)] mb-6 sm:mb-8 leading-relaxed",children:e.jsx(b,{text:s.questionText})}),e.jsx("div",{className:"flex-grow",children:e.jsx("div",{className:"space-y-3.5 sm:space-y-4",children:s.options.map((a,c)=>{const d=i===a;let p="bg-[var(--color-bg-surface-3)] hover:bg-[var(--color-bg-surface-3)]/70 border-[var(--color-border-interactive)] hover:border-[var(--color-primary-accent)] text-[var(--color-text-primary)]",h=e.jsx(P,{className:"w-6 h-6 text-[var(--color-text-muted)] group-hover:text-[var(--color-primary-accent)] transition-colors var(--duration-fast) var(--ease-ios)",strokeWidth:2.5});return d&&(p="bg-[var(--color-primary-accent)]/50 border-[var(--color-primary-accent)] text-[var(--color-primary-accent-text)] font-semibold hover:bg-[var(--color-primary-accent)]/60 scale-[1.01]",h=e.jsx(P,{className:"w-6 h-6 text-[var(--color-primary-accent-text)]",isFilled:!0,strokeWidth:1})),e.jsxs("button",{onClick:()=>D(a),className:`w-full flex items-center text-left p-3.5 sm:p-4 rounded-xl border-2 focus:outline-none focus-visible:ring-4 focus-visible:ring-[var(--color-primary-accent)]/50 focus-visible:ring-offset-2 ${d?"focus-visible:ring-offset-[var(--color-bg-surface-1)]":"focus-visible:ring-offset-[var(--color-bg-surface-2)]"} shadow-lg 
                                 transition-all var(--duration-fast) var(--ease-ios) will-change-transform, border, background-color
                                 ${p}`,"aria-pressed":d,children:[e.jsx("span",{className:"mr-3.5 flex-shrink-0",children:h}),e.jsxs("span",{className:"text-sm sm:text-base flex-grow",children:[" ",e.jsx(b,{text:a})," "]})]},c)})})})]},s.id)})}),e.jsxs("div",{className:"flex flex-col space-y-3 pt-6 sm:pt-8 border-t border-[var(--color-border-default)] mt-6 sm:mt-8",children:[" ",e.jsx(m,{onClick:G,disabled:!i&&!(s&&n[s.id]),variant:"primary",size:"lg",rightIcon:e.jsx(se,{className:"w-5 h-5"}),className:"w-full py-3 rounded-xl",children:t(J?"submit":"nextQuestion")}),e.jsxs("div",{className:"flex justify-between items-center pt-3",children:[e.jsx(m,{onClick:W,disabled:f===0,variant:"outline",size:"md",leftIcon:e.jsx(te,{className:"w-4 h-4"}),className:"py-2.5 px-5 rounded-lg",children:t("previous")}),e.jsx(m,{onClick:()=>u(!0),variant:"outline",size:"md",className:"py-2.5 px-5 rounded-lg",children:t("quizTakingSubmitQuiz")})]})]}),z&&e.jsx(L,{isOpen:z,onClose:A,title:t("quizTakingSubmitQuiz"),size:"md",footerContent:e.jsxs("div",{className:"flex justify-end gap-3.5",children:[e.jsx(m,{variant:"secondary",onClick:A,size:"md",children:t("cancel")}),e.jsx(m,{variant:"primary",onClick:w,size:"md",children:t("submit")})]}),children:e.jsx("p",{className:"text-[var(--color-text-body)] text-base leading-relaxed",children:t("submitConfirmationMessage")})}),T&&e.jsx(L,{isOpen:T,onClose:I,title:t("timesUp"),size:"md",hideCloseButton:!0,footerContent:e.jsx("div",{className:"flex justify-center",children:e.jsx(m,{variant:"primary",onClick:I,size:"md",children:t("timesUpSubmit")})}),children:e.jsx("p",{className:"text-[var(--color-text-body)] text-base leading-relaxed text-center",children:t("timesUpMessage")})})]})};re.displayName="QuizTakingPage";export{re as default};
