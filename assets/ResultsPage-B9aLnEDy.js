import{k as I,j as e,H as G,X as w,i as U,E as O,m as H,J as A,r as u,F as X,n as o,B as g,C as T,o as y,q as J,N as Q,O as W,Q as Y,U as K,D as Z}from"./index-CCre2QPF.js";function _(t){return t.replace(/^#+\s*Câu hỏi\s*\d*\s*$/gm,"").replace(/^#+\s+/gm,"").replace(/<[^>]*>?/gm,"").replace(/\[([^\]]+)\]\([^)]+\)/g,"$1").replace(/\{#[^}]+\}/g,"").replace(/cu-hi-\d+/g,"").replace(/\n+/g," ").replace(/\s+/g," ").trim()}function ee(t){const c=_(t),i=c.match(/(?:Thông báo|Câu hỏi|[^.!?]+\?)/);return i?i[0].trim():c}const te=({question:t,index:c,isCorrect:i})=>{const{t:h}=I(),r=h("resultsQuestionItem",{index:c+1}),x=ee(t.questionText);return e.jsxs("div",{className:"flex items-start w-full gap-3",children:[e.jsx("div",{className:`flex items-center justify-center w-8 h-8 sm:w-9 sm:h-9 rounded-lg flex-shrink-0 mt-0.5 ${i?"bg-green-100 dark:bg-green-500/20 text-green-600 dark:text-green-300":"bg-red-100 dark:bg-red-500/20 text-red-600 dark:text-red-300"}`,children:i?e.jsx(G,{className:"w-5 h-5"}):e.jsx(w,{className:"w-5 h-5"})}),e.jsxs("div",{className:"ml-1 flex-grow min-w-0 inline-flex items-baseline",children:[e.jsx("span",{className:"text-[var(--color-text-secondary)] text-xs font-semibold mr-1.5",children:r}),e.jsx("span",{className:"text-[var(--color-text-primary)] font-medium text-sm md:text-base leading-relaxed whitespace-pre-line",children:x})]})]})},re=t=>({hidden:{opacity:t?1:0,y:t?0:20},visible:{opacity:1,y:0,transition:{duration:t?.001:.4,ease:[.25,.1,.25,1]}}}),D=({question:t,userAnswerText:c,isCorrect:i,index:h,sourceContentSnippet:r,initiallyOpen:x=!1})=>{const{t:n}=I(),s=A(),a=u.useMemo(()=>re(s),[s]);return e.jsx(o.div,{variants:a,children:e.jsx(K,{initiallyOpen:x,containerClassName:`!rounded-xl shadow-lg ${i?"!border-green-500/60":"!border-red-500/60"}`,title:e.jsx(te,{question:t,index:h,isCorrect:i}),titleClassName:`py-3.5 px-4 sm:py-4 sm:px-5 rounded-t-xl ${i?"hover:!bg-green-400/15":"hover:!bg-red-400/15"}`,contentClassName:"!bg-[var(--color-bg-surface-2)]/30",children:e.jsxs("div",{className:"space-y-5 text-sm sm:text-base p-4 sm:p-5",children:[" ",e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:t.options.map((m,j)=>{const p=m===c,v=m===t.correctAnswer;let d="py-2.5 px-3.5 rounded-lg border text-sm transition-all var(--duration-fast) var(--ease-ios)";return p?d+=v?" bg-green-500/20 border-green-500/70 text-green-200 font-semibold ring-2 ring-green-500/50":" bg-red-500/20 border-red-500/70 text-red-200 font-semibold ring-2 ring-red-500/50":v?d+=" bg-green-500/10 border-green-500/40 text-green-300":d+=" bg-[var(--color-bg-surface-2)]/70 border-[var(--color-border-default)] text-[var(--color-text-secondary)] opacity-80",e.jsx("div",{className:d,children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs("span",{className:"font-medium mr-2.5 flex-shrink-0",children:[String.fromCharCode(65+j),"."]}),e.jsx("div",{className:"flex-grow markdown-content option-content flex items-center",children:e.jsx(y,{text:m,markdownFormatting:!0,stripPrefix:!0,compact:!0})})]})},j)})}),e.jsxs("div",{className:"mt-5 border-t border-[var(--color-border-default)] pt-5",children:[" ",e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-[var(--color-primary-accent)]",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2h-1V9a1 1 0 00-1-1z",clipRule:"evenodd"})}),e.jsx("span",{className:"font-semibold text-[var(--color-primary-accent)] text-base",children:n("resultsExplanationTitle")})]}),e.jsx("div",{className:"explanation-content",children:e.jsx("div",{className:"pl-1.5 border-l-2 border-[var(--color-primary-accent)]/20",children:e.jsxs("div",{className:"explanation-text text-sm leading-relaxed text-[var(--color-text-body)] markdown-content",children:[" ",e.jsx(y,{text:t.explanation||n("resultsNoExplanation"),markdownFormatting:!0})]})})})]}),r&&e.jsxs("details",{className:"mt-5 pt-5 border-t border-[var(--color-border-default)]",children:[e.jsxs("summary",{className:"text-xs text-[var(--color-text-muted)] cursor-pointer hover:text-[var(--color-primary-accent)] flex items-center font-semibold group transition-colors var(--duration-fast) var(--ease-ios)",children:[e.jsx(Z,{className:"w-4 h-4 mr-2.5 text-[var(--color-text-muted)] group-hover:text-[var(--color-primary-accent)] transition-colors var(--duration-fast) var(--ease-ios)",strokeWidth:2}),n("resultsViewSourceSnippet")]}),e.jsx("blockquote",{className:"mt-3 text-xs text-[var(--color-text-muted)]/80 max-h-36 overflow-y-auto p-3.5 bg-[var(--color-bg-surface-2)]/60 border border-[var(--color-border-default)] rounded-lg shadow-inner italic markdown-content",children:e.jsx(y,{text:r,markdownFormatting:!0})})]})]})})})};D.displayName="QuestionResultItem";const se=t=>({hidden:{opacity:t?1:0},visible:{opacity:1,transition:{staggerChildren:t?0:.1,duration:t?.001:.3,ease:[.25,.1,.25,1]}}}),ae=t=>({hidden:{opacity:t?1:0,y:t?0:20},visible:{opacity:1,y:0,transition:{duration:t?.001:.4,ease:[.25,.1,.25,1]}}}),ie=t=>({hidden:{opacity:t?1:0},visible:{opacity:1,transition:{staggerChildren:t?0:.075}}}),ne=()=>{const{quizResult:t,isLoading:c,getQuizByIdFromAll:i,setActiveQuiz:h}=U(),{t:r}=I(),{quizId:x}=O(),n=H(),s=A(),[a,m]=u.useState(null),[j,p]=u.useState(!0),[v,d]=u.useState(null),R=u.useMemo(()=>se(s),[s]),b=u.useMemo(()=>ae(s),[s]),S=u.useMemo(()=>ie(s),[s]);if(u.useEffect(()=>{if(p(!0),d(null),c)return;if(!t){console.warn(`ResultsPage: App context loaded, but quizResult is null. Param quizId from URL: ${x}.`),d(r("resultsErrorNotFound",{quizId:x||"unknown"})),m(null),p(!1);return}if(!t.quizId){console.error("ResultsPage: quizResult object exists but quizResult.quizId is missing. Invalid state."),d(r("resultsErrorNotFound",{quizId:"unknown"})),m(null),p(!1);return}const l=i(t.quizId);l?(m(l),h(l),p(!1)):(console.error(`ResultsPage: Quiz ${t.quizId} not found in fully loaded quizzes list.`),d(r("resultsErrorNotFound",{quizId:t.quizId})),m(null),p(!1))},[t,i,h,x,c,r]),j)return e.jsx("div",{className:"flex flex-col items-center justify-center min-h-[calc(100vh-380px)] text-center p-5",children:e.jsx(X,{text:r("resultsLoading"),className:"mb-10",size:"xl"})});if(v)return e.jsxs(o.div,{initial:s?{opacity:1,y:0}:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:s?.001:.4,ease:[.25,.1,.25,1]},className:"flex flex-col items-center justify-center min-h-[calc(100vh-380px)] text-center p-5",children:[e.jsx(w,{className:"w-16 h-16 mb-6 text-[var(--color-danger-accent)]"}),e.jsx("p",{className:"text-xl font-semibold text-[var(--color-text-primary)] mb-3",children:r("error")}),e.jsx("p",{className:"text-base text-[var(--color-text-secondary)] mb-10 max-w-md",children:v}),e.jsxs(g,{onClick:()=>n("/dashboard"),variant:"secondary",size:"lg",className:"py-3 px-7 rounded-xl",children:[" ",r("resultsGoToDashboard")," "]})]});if(!t||!a)return console.error("ResultsPage: Reached render stage where quizResult or currentDisplayQuiz is unexpectedly null despite no explicit error state and not loading."),e.jsxs(o.div,{initial:s?{opacity:1,y:0}:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:s?.001:.4,ease:[.25,.1,.25,1]},className:"flex flex-col items-center justify-center min-h-[calc(100vh-380px)] text-center p-5",children:[e.jsx(w,{className:"w-16 h-16 mb-6 text-[var(--color-danger-accent)]"}),e.jsx("p",{className:"text-xl font-semibold text-[var(--color-text-primary)] mb-3",children:r("error")}),e.jsxs("p",{className:"text-base text-[var(--color-text-secondary)] mb-10 max-w-md",children:[r("resultsErrorNotFound",{quizId:x||"unknown"})," (Unexpected)"]}),e.jsxs(g,{onClick:()=>n("/dashboard"),variant:"secondary",size:"lg",className:"py-3.5 px-8 rounded-xl",children:[" ",r("resultsGoToDashboard")," "]})]});if(a.id!==t.quizId)return console.error("ResultsPage: Mismatch between currentDisplayQuiz.id and quizResult.quizId. This indicates a critical state inconsistency."),e.jsxs(o.div,{initial:s?{opacity:1,y:0}:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:s?.001:.4,ease:[.25,.1,.25,1]},className:"flex flex-col items-center justify-center min-h-[calc(100vh-380px)] text-center p-5",children:[e.jsx(w,{className:"w-16 h-16 mb-6 text-[var(--color-danger-accent)]"}),e.jsx("p",{className:"text-xl font-semibold mb-4 text-[var(--color-danger-accent)]",children:"Critical Error: Data Mismatch"}),e.jsxs("p",{className:"text-sm text-[var(--color-text-muted)]",children:["Displayed Quiz ID: ",a.id,", Result Quiz ID: ",t.quizId]}),e.jsxs(g,{onClick:()=>n("/dashboard"),variant:"secondary",size:"lg",className:"py-3.5 px-8 rounded-xl mt-6",children:[" ",r("resultsGoToDashboard")," "]})]});const{score:f,answers:F,totalCorrect:E,totalQuestions:P,sourceMode:z}=t,$=(l,N)=>N?N.trim()===l.correctAnswer.trim():!1,V=f>=70?"text-green-400":f>=40?"text-amber-400":"text-red-400",L=f>=70?"bg-gradient-to-r from-green-400 to-emerald-400":f>=40?"bg-gradient-to-r from-amber-400 to-yellow-400":"bg-gradient-to-r from-red-400 to-rose-400",M=z==="practice"?r("practiceSummaryTitle",{quizTitle:a.title}):r("resultsTitle",{quizTitle:a.title});return e.jsx(o.div,{initial:"hidden",animate:"visible",variants:R,children:e.jsxs(T,{className:"max-w-4xl mx-auto shadow-2xl !rounded-2xl",useGlassEffect:!0,children:[e.jsx(o.h1,{variants:b,className:"text-3xl sm:text-4xl font-bold text-[var(--color-text-primary)] mb-4 text-center leading-tight tracking-tight line-clamp-2",title:a.title,children:e.jsx(y,{text:M,markdownFormatting:!0})}),e.jsx(o.p,{variants:b,className:"text-base text-[var(--color-text-secondary)] mb-12 text-center",children:e.jsx(y,{text:r(z==="practice"?"practiceSummarySubtitle":"resultsSubtitle"),markdownFormatting:!0})}),e.jsx(o.div,{variants:b,children:e.jsxs(T,{className:"mb-12 !bg-[var(--color-bg-surface-2)]/70 shadow-xl !border-[var(--color-border-default)] p-0 overflow-hidden !rounded-2xl",useGlassEffect:!1,children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-around items-center text-center gap-8 p-6 sm:p-10 !bg-[var(--color-bg-surface-1)]/60",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("p",{className:"text-sm text-[var(--color-text-muted)] uppercase tracking-wider font-medium mb-1.5",children:r("resultsYourScore")}),e.jsxs("p",{className:`text-6xl sm:text-7xl font-extrabold ${V} tracking-tight`,children:[f.toFixed(0),e.jsx("span",{className:"text-4xl",children:"%"})]})]}),e.jsx("div",{className:"w-full md:w-px h-px md:h-24 bg-[var(--color-border-default)] my-3 md:my-0"}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("p",{className:"text-sm text-[var(--color-text-muted)] uppercase tracking-wider font-medium mb-1.5",children:r("resultsCorrectAnswers")}),e.jsxs("p",{className:"text-5xl sm:text-6xl font-bold text-[var(--color-text-primary)]",children:[E," ",e.jsxs("span",{className:"text-3xl text-[var(--color-text-muted)]/80",children:["/ ",P]})]})]})]}),e.jsx(J,{progress:f,className:"w-full rounded-b-2xl overflow-hidden",size:"lg",barClassName:`${L} !h-3.5`,showPercentage:!1})]})}),e.jsx(o.h2,{variants:b,className:"text-2xl sm:text-3xl font-semibold text-[var(--color-text-primary)] mb-8 sm:mb-10",children:r("resultsBreakdownTitle")}),e.jsx(o.div,{variants:S,initial:"hidden",animate:"visible",className:"space-y-5",children:Array.isArray(a.questions)&&a.questions.map((l,N)=>{const k=F.find(B=>B.questionId===l.id),C=k?k.answer:"",q=$(l,C);return e.jsx(D,{question:l,userAnswerText:C,isCorrect:q,index:N,sourceContentSnippet:a.sourceContentSnippet,initiallyOpen:!q},l.id)})}),e.jsxs(o.div,{variants:b,className:"mt-14 flex flex-col sm:flex-row justify-center items-center gap-4 sm:gap-5",children:[z==="practice"?e.jsx(g,{onClick:()=>n(`/practice/${a.id}`),variant:"outline",size:"lg",leftIcon:e.jsx(Q,{className:"w-5 h-5"}),className:"w-full sm:w-auto py-3 px-8 rounded-xl",children:r("practiceAgain")}):e.jsx(g,{onClick:()=>n(`/quiz/${a.id}`),variant:"outline",size:"lg",leftIcon:e.jsx(Q,{className:"w-5 h-5"}),className:"w-full sm:w-auto py-3 px-8 rounded-xl",children:r("resultsTryAgain")}),e.jsx(g,{onClick:()=>n("/dashboard"),variant:"secondary",size:"lg",leftIcon:e.jsx(W,{className:"w-5 h-5"}),className:"w-full sm:w-auto py-3 px-8 rounded-xl",children:r("resultsBackToDashboard")}),e.jsx(g,{onClick:()=>n("/create"),variant:"primary",size:"lg",leftIcon:e.jsx(Y,{className:"w-5 h-5"}),className:"w-full sm:w-auto bg-gradient-to-r from-[var(--color-primary-accent)] to-indigo-500 hover:from-[var(--color-primary-accent-hover)] hover:to-indigo-600 text-white shadow-xl py-3 px-8 rounded-xl",children:r("resultsCreateNewQuiz")})]})]})})};ne.displayName="ResultsPage";export{ne as default};
