import{h as F,k as J,V as O,A as P,r as e}from"./index-BJ6IOBh1.js";function q(m){if(!m)return[];const s=[...m];for(let o=s.length-1;o>0;o--){const n=Math.floor(Math.random()*(o+1));[s[o],s[n]]=[s[n],s[o]]}return s}const w={shuffleQuestions:!1,shuffleAnswers:!1,timeLimit:0},_=(m,s)=>{var L;const{quizzes:o,activeQuiz:n,setActiveQuiz:p}=F(),Q=J(),b=O(),{quizId:x}=P(),d=m||x,[r,E]=e.useState(null),[l,M]=e.useState(w),[i,z]=e.useState([]),[a,S]=e.useState(0),[N,y]=e.useState(!0),[g,A]=e.useState(null),u=e.useRef(null),I=(L=b.state)==null?void 0:L.attemptSettings,v=e.useMemo(()=>I,[JSON.stringify(I)]);e.useEffect(()=>{let t=!0;return(()=>{if(!d){t&&Q("/dashboard");return}const f=v||((r==null?void 0:r.id)===d?l:w);t&&JSON.stringify(f)!==JSON.stringify(l)&&M(f);let c=n&&n.id===d?n:o.find(h=>h.id===d);if(c){if(t){E(c),(!n||n.id!==c.id)&&p(c);let h=c.questions;f.shuffleQuestions&&(h=q([...c.questions])),z(h),S(0),f.timeLimit>0?A(f.timeLimit*60):A(null)}}else t&&Q("/dashboard");t&&y(!1)})(),()=>{t=!1,u.current&&clearInterval(u.current)}},[d,o,n,Q,p,v,r==null?void 0:r.id,l]),e.useEffect(()=>{if(g===null){u.current&&clearInterval(u.current);return}if(g<=0){u.current&&clearInterval(u.current),r&&s&&s();return}return u.current=window.setInterval(()=>{A(t=>t?t-1:0)},1e3),()=>{u.current&&clearInterval(u.current)}},[g,r,s]);const C=e.useMemo(()=>{if(!i||i.length===0||a>=i.length)return;const t=i[a];return t&&l.shuffleAnswers?{...t,options:q([...t.options])}:t},[i,a,l.shuffleAnswers]),k=e.useCallback(()=>a<i.length-1?(S(t=>t+1),!0):!1,[a,i.length]),D=e.useCallback(()=>a>0?(S(t=>t-1),!0):!1,[a]);return{localActiveQuiz:r,shuffledQuestions:i,currentQuestion:C,currentQuestionIndex:a,loading:N,timeLeft:g,attemptSettings:l,goToNextQuestion:k,goToPreviousQuestion:D,formatTime:t=>{const T=Math.floor(t/60),f=t%60;return`${T.toString().padStart(2,"0")}:${f.toString().padStart(2,"0")}`},totalQuestions:i.length,setShuffledQuestions:z,setCurrentQuestionIndex:S}};export{_ as u};
