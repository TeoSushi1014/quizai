import{j as e,m as C}from"./ui-BGuvgkTr.js";import{s as v,l as i,C as N,O as j,B as y,o as E,u as L,c as z,Q as $,L as G,M as T,R as _,U as q}from"./index-Czoj4BS-.js";import{r as c,u as B}from"./router-BxjC687J.js";import"./vendor-DoC2WAmd.js";import"./utils-rUpm7H1u.js";import"./markdown-Bj7tmv2T.js";const h=[{name:"GEMINI_API_KEY",displayName:"Google Gemini API Key (Personal)",description:"Optional: Use your own API key for quiz generation. Leave empty to use default system key.",placeholder:"AIzaSy... (optional - leave empty to use default)",pattern:/^AIza[0-9A-Za-z-_]{35}$/,required:!1}],D=({onApiKeyUpdate:l})=>{const[n,d]=c.useState({}),[o,p]=c.useState({}),[w,f]=c.useState({}),[x,m]=c.useState({}),[S,b]=c.useState(!1);c.useEffect(()=>{g()},[]);const g=async()=>{const s={},r={};for(const a of h)try{const t=await v.getUserPersonalApiKey(a.name);s[a.name]=t||"",r[a.name]=t?"valid":"unknown"}catch(t){i.error(`Failed to load API key: ${a.name}`,"ApiKeyManager",{},t),s[a.name]="",r[a.name]="unknown"}d(s),m(r)},A=(s,r)=>{const a=h.find(t=>t.name===s);return!(!a||a.required&&!r.trim()||a.pattern&&!a.pattern.test(r))},I=(s,r)=>{d(t=>({...t,[s]:r}));const a=A(s,r);m(t=>({...t,[s]:r.trim()?a?"valid":"invalid":"unknown"}))},k=async s=>{const r=n[s];if(r.trim()){f(a=>({...a,[s]:!0}));try{await v.setApiKey(s,r)?(m(t=>({...t,[s]:"valid"})),i.info(`API key saved successfully: ${s}`,"ApiKeyManager"),l==null||l()):(m(t=>({...t,[s]:"invalid"})),i.error(`Failed to save API key: ${s}`,"ApiKeyManager"))}catch(a){i.error(`Error saving API key: ${s}`,"ApiKeyManager",{},a),m(t=>({...t,[s]:"invalid"}))}finally{f(a=>({...a,[s]:!1}))}}},P=async()=>{b(!0);try{const s=h.map(async t=>{const u=n[t.name];return u!=null&&u.trim()?v.setApiKey(t.name,u):!0});(await Promise.all(s)).every(Boolean)?(i.info("All API keys saved successfully","ApiKeyManager"),l==null||l(),await g()):i.error("Some API keys failed to save","ApiKeyManager")}catch(s){i.error("Error saving API keys","ApiKeyManager",{},s)}finally{b(!1)}},K=s=>{p(r=>({...r,[s]:!r[s]}))},M=s=>{switch(s){case"valid":return e.jsx(E,{className:"w-5 h-5 text-green-500"});case"invalid":return e.jsx("span",{className:"w-5 h-5 text-red-500",children:"âš ï¸"});default:return e.jsx(j,{className:"w-5 h-5 text-gray-400"})}};return e.jsxs(N,{className:"!bg-[var(--color-bg-surface-2)]/80 !border-[var(--color-border-default)] p-6 rounded-xl shadow-lg",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(j,{className:"w-6 h-6 mr-3 text-[var(--color-primary-accent)]"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-[var(--color-text-primary)]",children:"API Key Management"}),e.jsx("p",{className:"text-sm text-[var(--color-text-secondary)] mt-1",children:"Securely store your API keys in Supabase"})]})]}),e.jsxs("div",{className:"space-y-6",children:[h.map(s=>{var r;return e.jsxs(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-[var(--color-text-primary)]",children:[s.displayName,s.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("p",{className:"text-xs text-[var(--color-text-secondary)] mt-1",children:s.description})]}),M(x[s.name]||"unknown")]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:o[s.name]?"text":"password",value:n[s.name]||"",onChange:a=>I(s.name,a.target.value),placeholder:s.placeholder,className:`w-full px-4 py-3 pr-20 bg-[var(--color-bg-surface-1)] border rounded-lg text-[var(--color-text-primary)] placeholder-[var(--color-text-secondary)] focus:outline-none focus:ring-2 focus:ring-[var(--color-primary-accent)] ${x[s.name]==="invalid"?"border-red-500":x[s.name]==="valid"?"border-green-500":"border-[var(--color-border-default)]"}`}),e.jsxs("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex items-center space-x-2",children:[e.jsx("button",{type:"button",onClick:()=>K(s.name),className:"p-1 text-[var(--color-text-secondary)] hover:text-[var(--color-text-primary)] transition-colors",children:o[s.name]?e.jsx("span",{className:"w-5 h-5",children:"ðŸ‘ï¸"}):e.jsx("span",{className:"w-5 h-5",children:"ðŸ™ˆ"})}),e.jsx(y,{onClick:()=>k(s.name),isLoading:w[s.name],disabled:!((r=n[s.name])!=null&&r.trim())||x[s.name]==="invalid",size:"sm",variant:"primary",className:"!py-1 !px-3",children:"Save"})]})]}),x[s.name]==="invalid"&&e.jsx("p",{className:"text-xs text-red-500",children:"Invalid API key format. Please check your key."})]},s.name)}),e.jsx("div",{className:"flex justify-end pt-4 border-t border-[var(--color-border-default)]",children:e.jsx(y,{onClick:P,isLoading:S,variant:"primary",size:"lg",className:"min-w-[120px]",children:"Save All Keys"})})]}),e.jsx("div",{className:"mt-6 p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(j,{className:"w-5 h-5 text-blue-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"text-blue-300 font-medium mb-1",children:"How API Keys Work"}),e.jsxs("ul",{className:"text-blue-200/80 leading-relaxed space-y-1 text-xs list-disc list-inside",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Default System Key:"})," We provide a shared API key for all users to get started"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Personal API Key:"})," You can add your own key to avoid rate limits and have better control"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Priority:"})," Your personal key (if provided) will be used first, then falls back to system default"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Security:"})," All keys are encrypted and stored securely. Only you can see your personal keys"]})]})]})]})})]})},H=()=>{const{currentUser:l}=L(),{t:n}=z(),d=B(),{theme:o,toggleTheme:p}=$();return l?e.jsx("div",{className:"max-w-2xl mx-auto py-8 animate-page-slide-fade-in",children:e.jsxs(N,{useGlassEffect:!0,className:"shadow-2xl !rounded-2xl",children:[e.jsxs("div",{className:"text-center mb-10",children:[e.jsx("h1",{className:"text-3xl font-bold text-[var(--color-text-primary)] mb-3 tracking-tight",children:e.jsx(T,{text:n("navSettings")})}),e.jsx("p",{className:"text-[var(--color-text-secondary)] text-sm leading-relaxed",children:"Manage your application preferences and API settings."})]}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-semibold text-[var(--color-text-primary)] mb-4 pb-2 border-b border-[var(--color-border-default)]",children:"Theme Settings"}),e.jsx("div",{className:"bg-[var(--color-bg-surface-2)] rounded-xl p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[o==="dark"?e.jsx(_,{className:"w-5 h-5 text-[var(--color-primary-accent)]"}):e.jsx(q,{className:"w-5 h-5 text-[var(--color-primary-accent)]"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-[var(--color-text-primary)]",children:o==="dark"?"Dark Mode":"Light Mode"}),e.jsx("p",{className:"text-sm text-[var(--color-text-secondary)]",children:"Switch between light and dark themes"})]})]}),e.jsx(y,{variant:"primary",size:"sm",onClick:p,className:"px-4",children:o==="dark"?"Switch to Light":"Switch to Dark"})]})})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-semibold text-[var(--color-text-primary)] mb-4 pb-2 border-b border-[var(--color-border-default)]",children:"API Settings"}),e.jsx(D,{})]})]}),e.jsx("div",{className:"flex justify-center mt-10 pt-8 border-t border-[var(--color-border-default)]",children:e.jsx(y,{variant:"secondary",onClick:()=>d("/dashboard"),className:"px-8",children:"Back to Dashboard"})})]})}):(d("/signin",{state:{from:{pathname:"/settings"}}}),e.jsx(G,{text:n("loading")}))};export{H as default};
