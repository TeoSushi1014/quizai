import{k as U,j as e,q as _,o as R,B as k,E as ee,m as te,i as re,r as u,F as P,C as se,T as ne,H as ie,s as le,x as ae,y as oe}from"./index-DCYZb2u-.js";import{u as ce}from"./useQuizFlow-DM6O7lJs.js";const H=({question:i,options:z,currentIndex:b,totalQuestions:w,selectedOption:l,onSelectOption:Q,onCheckAnswer:o,onSkipQuestion:T,isSubmitting:N,isAnswerChecked:x=!1,isAnswerCorrect:c=null,correctAnswer:p=""})=>{const{t:f}=U(),S=w>0?(b+1)/w*100:0;return e.jsxs("div",{className:"quiz-question-container",children:[e.jsxs("div",{className:"quiz-progress",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1.5",children:[e.jsx("span",{className:"text-sm font-medium text-[var(--color-text-primary)]",children:f("quizTakingQuestionProgress",{current:b+1,total:w})}),e.jsxs("span",{className:"text-xs font-semibold text-[var(--color-text-secondary)]",children:[S.toFixed(0),"%"]})]}),e.jsx(_,{progress:S,size:"md",className:"mb-5"})]}),x&&e.jsxs("div",{className:`mb-4 p-3 rounded-lg flex items-center feedback-banner ${c?"bg-green-100 dark:bg-green-900/30 border-l-4 border-green-500":"bg-red-100 dark:bg-red-900/30 border-l-4 border-red-500"}`,children:[e.jsx("div",{className:`mr-2.5 ${c?"text-green-500":"text-red-500"}`,children:c?e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}):e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsxs("div",{children:[e.jsx("p",{className:`font-medium ${c?"text-green-700 dark:text-green-300":"text-red-700 dark:text-red-300"}`,children:f(c?"answerCorrect":"answerIncorrect")}),!c&&e.jsxs("p",{className:"text-sm text-red-600 dark:text-red-300 mt-0.5",children:[f("resultsCorrectAnswerMC")," ",e.jsx("span",{className:"font-medium",children:p})]})]})]}),e.jsx("div",{className:"question-content mb-4",children:e.jsx(R,{text:i,markdownFormatting:!0})}),e.jsxs("div",{className:"space-y-3",children:[" ",z.map((d,v)=>{const a=l===d,C=p===d;let n="",r="",h="";return x?a&&c?(n="answer-option-correct bg-green-100 dark:bg-green-900/30 border-green-500 text-green-700 dark:text-green-300 font-semibold scale-[1.01]",r="border-green-500 bg-green-500",h="correct-answer-pulse"):a&&!c?(n="answer-option-incorrect bg-red-100 dark:bg-red-900/30 border-red-500 text-red-700 dark:text-red-300 font-semibold scale-[1.01]",r="border-red-500 bg-red-500",h="incorrect-answer-pulse"):C?(n="answer-option-correct bg-green-100 dark:bg-green-900/30 border-green-500 text-green-700 dark:text-green-300 font-semibold",r="border-green-500 bg-green-500"):(n="bg-[var(--color-bg-surface-3)]/70 border-[var(--color-border-interactive)] text-[var(--color-text-secondary)]",r="border-[var(--color-text-muted)] bg-[var(--color-bg-surface-2)]"):(n=a?"bg-[var(--color-primary-accent)]/50 border-[var(--color-primary-accent)] text-[var(--color-primary-accent-text)] font-semibold scale-[1.01]":"bg-[var(--color-bg-surface-3)]/70 hover:bg-[var(--color-bg-surface-3)]/40 border-[var(--color-border-interactive)] hover:border-[var(--color-primary-accent)] text-[var(--color-text-primary)]",r=a?"border-[var(--color-primary-accent-text)] bg-[var(--color-primary-accent)]":"border-[var(--color-text-muted)] bg-[var(--color-bg-surface-2)] group-hover:border-[var(--color-primary-accent)]"),e.jsxs("button",{type:"button",className:`w-full flex items-center text-left p-3.5 sm:p-4 rounded-xl border-2 focus:outline-none focus-visible:ring-4 focus-visible:ring-[var(--color-primary-accent)]/50 focus-visible:ring-offset-2 shadow-lg 
                          transition-all var(--duration-fast) var(--ease-ios) will-change-transform, border, background-color
                          ${n} ${h}`,onClick:()=>Q(d),disabled:N||x,"aria-pressed":a,"aria-checked":x&&C?"true":"false",children:[e.jsx("span",{className:`option-indicator mr-3.5 flex-shrink-0 w-6 h-6 rounded-full border-2 flex items-center justify-center ${r}`,children:(a||x&&C)&&e.jsx("div",{className:"w-3 h-3 bg-white rounded-full"})}),e.jsx("div",{className:"option-content flex-grow text-sm sm:text-base flex items-center",children:e.jsx(R,{text:d,markdownFormatting:!0,compact:!0,stripPrefix:!0})}),x&&e.jsx("span",{className:"ml-2",children:C?e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-green-500",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}):a&&!c?e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-red-500",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}):null})]},v)})]}),e.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-center mt-5 pt-5 border-t border-[var(--color-border-default)] gap-3",children:x?e.jsx("div",{className:"w-full flex justify-end items-center"}):e.jsxs(e.Fragment,{children:[e.jsx(k,{variant:"subtle",onClick:T,disabled:N,className:"w-full sm:w-auto",children:f("skipQuestion")}),e.jsx(k,{variant:"primary",onClick:o,disabled:N||!l,className:"w-full sm:w-auto",children:f(N?"loading":"checkAnswer")})]})})]})};H.displayName="PracticeQuizQuestion";const E=({explanation:i,className:z=""})=>{const{t:b}=U();return e.jsxs("div",{className:`animate-fadeInUp mt-5 p-5 rounded-lg bg-[var(--color-bg-surface-2)]/50 border border-[var(--color-border-default)] shadow-md ${z}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-[var(--color-primary-accent)]",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2h-1V9a1 1 0 00-1-1z",clipRule:"evenodd"})}),e.jsx("span",{className:"font-semibold text-[var(--color-primary-accent)] text-base",children:b("resultsExplanationTitle")})]}),e.jsx("div",{className:"pl-1.5 border-l-2 border-[var(--color-primary-accent)]/20",children:e.jsx(R,{text:i,markdownFormatting:!0,compact:!0,className:"text-sm text-[var(--color-text-body)] leading-relaxed"})})]})};E.displayName="PracticeQuizExplanation";const de=()=>{var G;const{t:i}=U(),{quizId:z}=ee(),b=te(),{setQuizResult:w}=re(),[l,Q]=u.useState(null),[o,T]=u.useState(!1),[N,x]=u.useState(null),[c,p]=u.useState([]),[f,S]=u.useState(!1),[d,v]=u.useState(!1),a=u.useRef(!1),C=u.useCallback(()=>{a.current||S(!0)},[]),{localActiveQuiz:n,currentQuestion:r,currentQuestionIndex:h,loading:B,timeLeft:q,goToNextQuestion:I,goToPreviousQuestion:$,formatTime:V,totalQuestions:L,shuffledQuestions:O,attemptSettings:F}=ce(z,C);u.useEffect(()=>{O.length>0&&c.length===0&&p(O.map(s=>({questionId:s.id,selectedOption:null,isCorrect:null,firstTryCorrect:null,attempts:0})))},[O,c.length]),u.useEffect(()=>{if(a.current)return;let s=null,t=!1,g=null;if(r&&c.length>0){const y=c.find(M=>M.questionId===r.id);y&&(s=y.selectedOption,y.isCorrect!==null&&(t=!0,g=y.isCorrect))}Q(s),T(t),x(g),v(!1)},[h,r,c]);const j=u.useCallback(()=>{if(a.current||!n)return;a.current=!0,v(!0);let s=[...c];r&&l&&!o?s=s.map(m=>m.questionId===r.id?{...m,selectedOption:l,isCorrect:null,attempts:m.attempts||0}:m):r&&!l&&!o&&(s=s.map(m=>m.questionId===r.id?{...m,selectedOption:null,isCorrect:null}:m));const t=s.filter(m=>m.isCorrect===!0).length,g=s.map(m=>({questionId:m.questionId,answer:m.selectedOption||""})),y=n.questions.length>0?t/n.questions.length*100:0,M={quizId:n.id,score:parseFloat(y.toFixed(2)),answers:g,totalCorrect:t,totalQuestions:n.questions.length,timeTaken:F.timeLimit>0?F.timeLimit*60-(q||0):void 0,sourceMode:"practice",createdAt:new Date().toISOString()};w(M),b(`/results/${n.id}`)},[n,c,r,l,o,w,F.timeLimit,q,b]),J=s=>{o||a.current||d||Q(s)},K=()=>{if(!l||!r||a.current||d)return;v(!0);const s=l===r.correctAnswer;T(!0),x(s),p(t=>t.map(g=>g.questionId===r.id?{...g,selectedOption:l,isCorrect:s,attempts:(g.attempts||0)+1,...(g.attempts||0)===0&&{firstTryCorrect:s}}:g))},W=u.useCallback(()=>{!n||!r||a.current||d||(v(!0),l&&!o?p(s=>s.map(t=>t.questionId===r.id&&(t.selectedOption!==l||t.isCorrect===null)?{...t,selectedOption:l,isCorrect:t.isCorrect,attempts:t.attempts||0}:t)):!l&&!o&&p(s=>s.map(t=>t.questionId===r.id&&t.selectedOption!==null&&t.isCorrect===null?{...t,selectedOption:null}:t)),I()||j())},[n,r,I,j,l,o,d]),X=u.useCallback(()=>{!n||!r||a.current||d||(v(!0),I()||j())},[n,r,I,j,d]),Y=u.useCallback(()=>{!r||a.current||d||(v(!0),l&&!o?p(s=>s.map(t=>t.questionId===r.id&&(t.selectedOption!==l||t.isCorrect===null)?{...t,selectedOption:l,isCorrect:t.isCorrect,attempts:t.attempts||0}:t)):!l&&!o&&p(s=>s.map(t=>t.questionId===r.id&&t.selectedOption!==null&&t.isCorrect===null?{...t,selectedOption:null}:t)),$())},[$,l,o,r,d]),A=u.useCallback(()=>{j()},[j]);if(d&&a.current)return e.jsx("div",{className:"flex flex-col items-center justify-center p-8 min-h-[400px]",children:e.jsx(P,{text:i("quizPracticeEnding")||"Processing...",size:"lg"})});if(B||!n)return e.jsx(P,{text:i("quizTakingLoading"),className:"mt-24",size:"xl"});if(!r)return n&&L>0&&h>=L?(a.current||j(),e.jsx("div",{className:"flex flex-col items-center justify-center p-8 min-h-[400px]",children:e.jsx(P,{text:i("quizPracticeEnding")||"Completing practice...",size:"lg"})})):B?e.jsx(P,{text:i("quizTakingLoading"),className:"mt-24",size:"xl"}):(console.error("QuizPracticePage: currentQuestion is undefined, but not due to finishing. Quiz data might be missing or an error occurred."),e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 min-h-[400px]",children:[e.jsx(P,{text:i("error")+" - "+(i("quizTakingLoading")||"Processing..."),size:"lg"}),e.jsx(k,{onClick:()=>b("/dashboard"),className:"mt-4",children:i("resultsGoToDashboard")})]}));const D=h===L-1,Z=()=>r?e.jsxs("div",{className:"space-y-4",children:[e.jsx(H,{question:r.questionText,options:r.options,currentIndex:h,totalQuestions:L,selectedOption:l,onSelectOption:J,onCheckAnswer:K,onSkipQuestion:X,isSubmitting:d,isAnswerChecked:o,isAnswerCorrect:N,correctAnswer:r.correctAnswer}),o&&e.jsx(E,{explanation:r.explanation||i("resultsNoExplanation")})]}):null;return e.jsxs(se,{className:"max-w-2xl mx-auto shadow-2xl !rounded-2xl animate-page-slide-fade-in p-5 sm:p-6",useGlassEffect:!0,children:[e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-[var(--color-text-primary)] mb-3 leading-tight tracking-tight line-clamp-2",title:n.title,children:i("quizPracticeTitle",{quizTitle:n.title})}),e.jsxs("div",{className:"flex justify-between items-center text-xs text-[var(--color-text-secondary)] mb-2",children:[q!==null&&e.jsx("span",{className:`font-semibold ${q<=60?"text-red-400 animate-pulse":"text-[var(--color-primary-accent)]"}`,children:i("quizTakingTimeLeft",{time:V(q)})}),((G=n.config)==null?void 0:G.customUserPrompt)&&e.jsx(ne,{content:e.jsx("div",{className:"max-w-xs text-left text-xs",children:e.jsx(E,{explanation:n.config.customUserPrompt})}),placement:"bottom-end",children:e.jsx(ie,{className:"w-4 h-4 text-yellow-300 cursor-help"})})]})]}),Z(),e.jsxs("div",{className:"quiz-navigation-actions mt-6 pt-6 border-t border-[var(--color-border-default)] flex flex-col sm:flex-row sm:justify-between gap-3",children:[e.jsx(k,{variant:"secondary",onClick:Y,disabled:d||h===0,size:"md",leftIcon:e.jsx(le,{className:"w-4 h-4"}),className:"w-full sm:w-auto",children:i("previous")}),e.jsx(k,{variant:D&&o?"primary":"secondary",onClick:o?W:j,disabled:d,size:"md",rightIcon:e.jsx(ae,{className:"w-4 h-4"}),className:"w-full sm:w-auto",children:i(o?D?"finishPractice":"nextQuestion":"finishPractice")})]}),f&&e.jsx(oe,{isOpen:f&&!a.current,onClose:A,title:i("timesUp"),size:"md",hideCloseButton:!0,footerContent:e.jsx("div",{className:"flex justify-center",children:e.jsx(k,{variant:"primary",onClick:A,size:"md",children:i("timesUpSubmit")})}),children:e.jsx("p",{className:"text-[var(--color-text-body)] text-base leading-relaxed text-center",children:i("timesUpMessage")})})]})};de.displayName="QuizPracticePage";export{de as default};
