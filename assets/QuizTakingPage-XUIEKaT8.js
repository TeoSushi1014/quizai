import{u as J,a as K,w as V,b as X,r as n,j as e,L as A,C as M,f as Y,x as Z,p as _,B as r,d as ee,q as se,M as U,y as L}from"./index-DcfiZvdk.js";import{M as b}from"./MathText-Bdaeuop9.js";import{u as te}from"./useQuizFlow-c2E89btq.js";const le=()=>{var I;const{setQuizResult:C}=J(),{t:s}=K(),{quizId:q}=V(),y=X(),[c,P]=n.useState({}),[d,j]=n.useState(null),[z,f]=n.useState(!1),[T,v]=n.useState(!1),E=n.useCallback(()=>{v(!0)},[]),{localActiveQuiz:t,currentQuestion:a,currentQuestionIndex:h,loading:F,timeLeft:m,goToNextQuestion:O,goToPreviousQuestion:B,formatTime:$,totalQuestions:l,attemptSettings:k}=te(q,E);n.useEffect(()=>{a&&c[a.id]?j(c[a.id]):j(null)},[a,c]);const R=i=>{j(i)},p=n.useCallback(()=>{a&&d&&P(i=>({...i,[a.id]:d}))},[a,d]),w=n.useCallback(()=>{if(!t)return;p();let i=0;const x=[];t.questions.forEach(o=>{const N=c[o.id];N?(x.push({questionId:o.id,answer:N}),N===o.correctAnswer&&i++):x.push({questionId:o.id,answer:""})});const u=l>0?i/l*100:0,g={quizId:t.id,score:parseFloat(u.toFixed(2)),answers:x,totalCorrect:i,totalQuestions:l,timeTaken:k.timeLimit>0?k.timeLimit*60-(m||0):void 0,sourceMode:"take",createdAt:new Date().toISOString()};C(g),f(!1),v(!1),y(`/results/${t.id}`)},[t,c,m,C,y,p,l,k.timeLimit]),D=()=>{t&&(p(),O()||f(!0))},G=()=>{p(),B()},S=n.useCallback(()=>f(!1),[]),Q=n.useCallback(()=>{v(!1),w()},[w]);if(F||!t)return e.jsx(A,{text:s("quizTakingLoading"),className:"mt-24",size:"xl"});if(!a)return e.jsxs(M,{className:"max-w-3xl mx-auto shadow-2xl !rounded-2xl animate-fadeInUp",useGlassEffect:!0,children:[e.jsx(A,{text:s("quizTakingLoading")}),e.jsx("p",{className:"text-center text-slate-300 mt-4",children:s("quizTakingErrorQuestionNotFound")})]});const W=l>0?(h+1)/l*100:0,H=h===l-1;return e.jsxs(M,{className:"max-w-3xl mx-auto shadow-2xl !border-slate-700/40 !rounded-2xl animate-page-slide-fade-in",useGlassEffect:!0,children:[e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-slate-50 mb-3 sm:mb-4 leading-tight tracking-tight line-clamp-2",title:t.title,children:e.jsx(b,{text:t.title})}),e.jsxs("div",{className:"flex justify-between items-center text-sm text-slate-300 mb-4 sm:mb-5",children:[e.jsx("span",{children:s("quizTakingQuestionProgress",{current:h+1,total:l})}),((I=t.config)==null?void 0:I.customUserPrompt)&&e.jsx(Y,{content:e.jsx("div",{className:"max-w-xs text-left text-xs",children:e.jsx(b,{text:t.config.customUserPrompt})}),placement:"bottom-end",children:e.jsx(Z,{className:"w-5 h-5 text-yellow-300 cursor-help"})}),m!==null&&e.jsx("span",{className:`font-semibold ${m<=60?"text-red-400 animate-pulse":"text-sky-300"}`,children:s("quizTakingTimeLeft",{time:$(m)})})]}),e.jsx(_,{progress:W,size:"lg",barClassName:"bg-gradient-to-r from-sky-500 to-indigo-500"})]}),e.jsx("div",{children:e.jsx("div",{className:"p-5 sm:p-8 bg-slate-700/60 rounded-xl shadow-inner border border-slate-600/70 min-h-[280px] flex flex-col",children:e.jsxs("div",{className:"animate-fadeInUp",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-slate-100 mb-6 sm:mb-8 leading-relaxed",children:e.jsx(b,{text:a.questionText})}),e.jsx("div",{className:"flex-grow",children:e.jsx("div",{className:"space-y-3.5 sm:space-y-4",children:a.options.map((i,x)=>{const u=d===i;let g="bg-slate-600 hover:bg-slate-500/80 border-slate-500 hover:border-sky-500 text-slate-100",o=e.jsx(L,{className:"w-6 h-6 text-slate-400 group-hover:text-sky-400 transition-colors var(--duration-fast) var(--ease-ios)",strokeWidth:2.5});return u&&(g="bg-sky-500/50 border-sky-400 text-sky-50 font-semibold hover:bg-sky-500/60 scale-[1.01]",o=e.jsx(L,{className:"w-6 h-6 text-sky-50",isFilled:!0,strokeWidth:1})),e.jsxs("button",{onClick:()=>R(i),className:`w-full flex items-center text-left p-3.5 sm:p-4 rounded-xl border-2 focus:outline-none focus-visible:ring-4 focus-visible:ring-sky-400/50 focus-visible:ring-offset-2 ${u?"focus-visible:ring-offset-white":"focus-visible:ring-offset-slate-700"} shadow-lg 
                                 transition-all var(--duration-fast) var(--ease-ios) will-change-transform, border, background-color
                                 ${g}`,"aria-pressed":u,children:[e.jsx("span",{className:"mr-3.5 flex-shrink-0",children:o}),e.jsxs("span",{className:"text-sm sm:text-base flex-grow",children:[" ",e.jsx(b,{text:i})," "]})]},x)})})})]},a.id)})}),e.jsxs("div",{className:"flex flex-col space-y-3 pt-6 sm:pt-8 border-t border-slate-700/60 mt-6 sm:mt-8",children:[" ",e.jsx(r,{onClick:D,disabled:!d,variant:"primary",size:"lg",rightIcon:e.jsx(ee,{className:"w-5 h-5"}),className:"w-full py-3 rounded-xl",children:s(H?"submit":"nextQuestion")}),e.jsxs("div",{className:"flex justify-between items-center pt-3",children:[e.jsx(r,{onClick:G,disabled:h===0,variant:"outline",size:"md",leftIcon:e.jsx(se,{className:"w-4 h-4"}),className:"py-2.5 px-5 rounded-lg",children:s("previous")}),e.jsx(r,{onClick:()=>f(!0),variant:"outline",size:"md",className:"py-2.5 px-5 rounded-lg",children:s("quizTakingSubmitQuiz")})]})]}),z&&e.jsx(U,{isOpen:z,onClose:S,title:s("quizTakingSubmitQuiz"),size:"md",footerContent:e.jsxs("div",{className:"flex justify-end gap-3.5",children:[e.jsx(r,{variant:"secondary",onClick:S,size:"md",children:s("cancel")}),e.jsx(r,{variant:"primary",onClick:w,size:"md",children:s("submit")})]}),children:e.jsx("p",{className:"text-slate-200 text-base leading-relaxed",children:s("submitConfirmationMessage")})}),T&&e.jsx(U,{isOpen:T,onClose:Q,title:s("timesUp"),size:"md",hideCloseButton:!0,footerContent:e.jsx("div",{className:"flex justify-center",children:e.jsx(r,{variant:"primary",onClick:Q,size:"md",children:s("timesUpSubmit")})}),children:e.jsx("p",{className:"text-slate-200 text-base leading-relaxed text-center",children:s("timesUpMessage")})})]})};export{le as default};
