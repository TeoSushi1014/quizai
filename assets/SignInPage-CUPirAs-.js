import{u as f,a as p,b as x,F as y,R as C,Q as j,j as e,C as w,B as v}from"./index-DcfiZvdk.js";const k={},_=()=>{const{login:m,currentUser:i}=f(),{t:o}=p(),c=x(),l=y(),d=void 0;C.useEffect(()=>{var t,s;if(i){const r=((s=(t=l.state)==null?void 0:t.from)==null?void 0:s.pathname)||"/dashboard";c(r,{replace:!0})}},[i,c,l.state]);const n=()=>{console.error("Login Failed. Check Google Cloud Console for redirect_uri_mismatch or other OAuth errors. Also check server COOP headers.")},a=j({onSuccess:async t=>{if(t.access_token)try{const s=await fetch("https://www.googleapis.com/oauth2/v3/userinfo",{headers:{Authorization:`Bearer ${t.access_token}`}});if(!s.ok){const g=await s.json().catch(()=>({message:"Failed to parse error response from userinfo endpoint"}));console.error("Failed to fetch user info:",s.status,s.statusText,g),n();return}const r=await s.json(),h={id:r.sub,name:r.name,email:r.email,imageUrl:r.picture};m(h)}catch(s){console.error("Error during token validation or fetching user info:",s),n()}else console.error("Login success callback, but no access_token in tokenResponse:",t),n()},onError:n}),u=()=>{if(!d){console.error("VITE_RECAPTCHA_SITE_KEY is not configured. Proceeding with login directly."),a();return}if(typeof grecaptcha>"u"||typeof grecaptcha.enterprise>"u"||typeof grecaptcha.enterprise.ready!="function"){console.warn("reCAPTCHA enterprise.js not loaded or not ready. Proceeding with login directly."),a();return}grecaptcha.enterprise.ready(async()=>{try{const t=await grecaptcha.enterprise.execute(d,{action:"LOGIN"});console.log("reCAPTCHA token obtained (first 10 chars):",t.slice(0,10)+"..."),console.log("Skipping reCAPTCHA assessment. Proceeding with login."),a()}catch(t){console.error("Lỗi khi thực thi reCAPTCHA (token generation):",t),a()}})};return e.jsx("div",{className:"flex flex-col items-center justify-center min-h-[calc(100vh-250px)] py-10 sm:py-16",children:e.jsxs(w,{className:"max-w-md w-full text-center shadow-2xl p-8 sm:p-10 md:p-12 !rounded-2xl",useGlassEffect:!0,children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-slate-50 mb-4 mt-8 sm:mt-10",children:o("signInTitle")}),e.jsx("p",{className:"text-slate-300/80 mb-10 text-sm",children:o("signInSubtitle")}),e.jsx("div",{className:"flex justify-center mb-8",children:e.jsx(v,{onClick:u,variant:"outline",size:"lg",leftIcon:e.jsx("img",{src:"https://img.icons8.com/color/48/google-logo.png",alt:"Google",className:"w-5 h-5"}),className:"w-full max-w-xs sm:w-[280px] !justify-start !text-slate-200 !bg-slate-700/60 hover:!bg-slate-600/80 !border-slate-600 hover:!border-slate-500 !px-4 !py-3 !rounded-lg shadow-md",children:e.jsx("span",{className:"ml-3 text-sm font-medium",children:o("loginWithGoogle")})})}),e.jsxs("p",{className:"text-xs text-slate-400/80",children:[o("signInAgreementPrompt")," "," ",e.jsx("a",{href:"#",className:"text-sky-400 hover:underline font-medium",children:o("footerTerms")})," ",o("and")," "," ",e.jsx("a",{href:"#",className:"text-sky-400 hover:underline font-medium",children:o("footerPrivacy")}),"."]})]})})};export{_ as default};
