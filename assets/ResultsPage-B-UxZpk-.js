const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-QW2lQ77I.js","assets/ui-BGuvgkTr.js","assets/router-BxjC687J.js","assets/vendor-DoC2WAmd.js","assets/utils-rUpm7H1u.js","assets/markdown-Bj7tmv2T.js","assets/index-DrsYec8i.css"])))=>i.map(i=>d[i]);
import{_ as U}from"./utils-rUpm7H1u.js";import{j as e,m as c}from"./ui-BGuvgkTr.js";import{f as Y,u as H,r as m}from"./router-BxjC687J.js";import{b as Q,n as X,X as q,u as J,o as T,l as y,L as K,B as p,C as A,M as N,P as W,A as P,H as Z,p as ee,q as te}from"./index-QW2lQ77I.js";import"./vendor-DoC2WAmd.js";import"./markdown-Bj7tmv2T.js";function se(t){return t.replace(/^#+\s*Câu hỏi\s*\d*\s*$/gm,"").replace(/^#+\s+/gm,"").replace(/<[^>]*>?/gm,"").replace(/\[([^\]]+)\]\([^)]+\)/g,"$1").replace(/\{#[^}]+\}/g,"").replace(/cu-hi-\d+/g,"").replace(/\n+/g," ").replace(/\s+/g," ").trim()}function re(t){const x=se(t),i=x.match(/(?:Thông báo|Câu hỏi|[^.!?]+\?)/);return i?i[0].trim():x}const ae=({question:t,index:x,isCorrect:i})=>{const{t:g}=Q(),h=g("resultsQuestionItem",{index:x+1}),s=re(t.questionText);return e.jsxs("div",{className:"flex items-start w-full gap-3",children:[e.jsx("div",{className:`flex items-center justify-center w-8 h-8 sm:w-9 sm:h-9 rounded-lg flex-shrink-0 mt-0.5 ${i?"bg-green-100 dark:bg-green-500/20 text-green-600 dark:text-green-300":"bg-red-100 dark:bg-red-500/20 text-red-600 dark:text-red-300"}`,children:i?e.jsx(X,{className:"w-5 h-5"}):e.jsx(q,{className:"w-5 h-5"})}),e.jsxs("div",{className:"ml-1 flex-grow min-w-0 inline-flex items-baseline",children:[e.jsx("span",{className:"text-[var(--color-text-secondary)] text-xs font-semibold mr-1.5",children:h}),e.jsx("span",{className:"text-[var(--color-text-primary)] font-medium text-sm md:text-base leading-relaxed whitespace-pre-line",children:s})]})]})},ie=t=>({hidden:{opacity:t?1:0,y:t?0:20},visible:{opacity:1,y:0,transition:{duration:t?.001:.4,ease:[.25,.1,.25,1]}}}),D=({question:t,userAnswerText:x,isCorrect:i,index:g,initiallyOpen:h=!1,getAnswerDisplayText:s})=>{const{t:u}=Q(),d=T(),l=m.useMemo(()=>ie(d),[d]);return e.jsx(c.div,{variants:l,children:e.jsx(te,{initiallyOpen:h,containerClassName:`!rounded-xl shadow-lg ${i?"!border-green-500/60":"!border-red-500/60"}`,title:e.jsx(ae,{question:t,index:g,isCorrect:i}),titleClassName:`py-3.5 px-4 sm:py-4 sm:px-5 rounded-t-xl ${i?"hover:!bg-green-400/15":"hover:!bg-red-400/15"}`,contentClassName:"!bg-[var(--color-bg-surface-2)]/30",children:e.jsxs("div",{className:"space-y-5 text-sm sm:text-base p-4 sm:p-5",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-[var(--color-text-secondary)] mb-1.5",children:u("resultsYourAnswerLabel")||"Your Answer:"}),e.jsx("p",{className:`p-3 rounded-md ${i?"bg-green-500/10 text-green-700 dark:text-green-300":"bg-red-500/10 text-red-700 dark:text-red-300"}`,children:e.jsx(N,{text:s(t,x)})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-[var(--color-text-secondary)] mb-1.5",children:u("resultsCorrectAnswerLabel")||"Correct Answer:"}),e.jsx("p",{className:`p-3 rounded-md ${i?"bg-green-500/10 text-green-700 dark:text-green-300":"bg-blue-500/10 text-blue-700 dark:text-blue-300"}`,children:e.jsx(N,{text:s(t,t.correctAnswer)})})]}),t.explanation&&e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-[var(--color-text-secondary)] mb-1.5",children:u("resultsExplanationLabel")||"Explanation:"}),e.jsx("div",{className:"p-3 rounded-md bg-gray-500/10 text-[var(--color-text-primary)]",children:e.jsx(N,{text:t.explanation,markdownFormatting:!0})})]})]})})})};D.displayName="QuestionResultItem";const le=t=>({hidden:{opacity:t?1:0},visible:{opacity:1,transition:{staggerChildren:t?0:.1,duration:t?.001:.3,ease:[.25,.1,.25,1]}}}),ne=t=>({hidden:{opacity:t?1:0,y:t?0:20},visible:{opacity:1,y:0,transition:{duration:t?.001:.4,ease:[.25,.1,.25,1]}}}),oe=t=>({hidden:{opacity:t?1:0},visible:{opacity:1,transition:{staggerChildren:t?0:.075}}}),ce=()=>{const{quizResult:t,isLoading:x,getQuizByIdFromAll:i,setActiveQuiz:g,setQuizResult:h}=J(),{t:s}=Q(),{quizId:u}=Y(),d=H(),l=T(),[n,w]=m.useState(null),[S,b]=m.useState(!0),[R,z]=m.useState(null),E=m.useMemo(()=>le(l),[l]),v=m.useMemo(()=>ne(l),[l]),F=m.useMemo(()=>oe(l),[l]);if(m.useEffect(()=>{if(b(!0),z(null),x)return;if(!t){console.warn(`ResultsPage: App context loaded, but quizResult is null. Param quizId from URL: ${u}.`);const r=localStorage.getItem("quizResult");if(r)try{const a=JSON.parse(r);if(a&&a.quizId===u){y.info("Found quiz result in localStorage, manually setting...","ResultsPage"),h(a);return}}catch(a){y.error("Failed to parse localStorage quiz result","ResultsPage",{},a)}z(s("resultsErrorNotFound",{quizId:u||"unknown"})+" - "+s("resultsErrorNoData")),w(null),b(!1);return}if(!t.quizId){console.error("ResultsPage: quizResult object exists but quizResult.quizId is missing. Invalid state."),z(s("resultsErrorNotFound",{quizId:"unknown"})),w(null),b(!1);return}(async()=>{let r=i(t.quizId);if(!r){y.info("Quiz not found in local data, attempting to fetch shared quiz...","ResultsPage");try{const{getSharedQuiz:a}=await U(async()=>{const{getSharedQuiz:I}=await import("./index-QW2lQ77I.js").then(C=>C.a4);return{getSharedQuiz:I}},__vite__mapDeps([0,1,2,3,4,5,6])),j=await a(t.quizId);j&&(r=j,y.info("Successfully fetched shared quiz data","ResultsPage"))}catch(a){y.error("Failed to fetch shared quiz","ResultsPage",{},a)}}r?(w(r),g(r),b(!1)):(console.error(`ResultsPage: Quiz ${t.quizId} not found in fully loaded quizzes list.`),z(s("resultsErrorNotFound",{quizId:t.quizId})),w(null),b(!1))})()},[t,i,g,u,x,s,h]),S)return e.jsx("div",{className:"flex flex-col items-center justify-center min-h-[calc(100vh-380px)] text-center p-5",children:e.jsx(K,{text:s("resultsLoading"),className:"mb-10",size:"xl"})});if(R)return e.jsxs(c.div,{initial:l?{opacity:1,y:0}:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:l?.001:.4,ease:[.25,.1,.25,1]},className:"flex flex-col items-center justify-center min-h-[calc(100vh-380px)] text-center p-5",children:[e.jsx(q,{className:"w-16 h-16 mb-6 text-[var(--color-danger-accent)]"}),e.jsx("p",{className:"text-xl font-semibold text-[var(--color-text-primary)] mb-3",children:s("error")}),e.jsx("p",{className:"text-base text-[var(--color-text-secondary)] mb-10 max-w-md",children:R}),e.jsxs(p,{onClick:()=>d("/dashboard"),variant:"secondary",size:"lg",className:"py-3 px-7 rounded-xl",children:[" ",s("resultsGoToDashboard")," "]})]});if(!t||!n)return console.error("ResultsPage: Reached render stage where quizResult or currentDisplayQuiz is unexpectedly null despite no explicit error state and not loading."),e.jsxs(c.div,{initial:l?{opacity:1,y:0}:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:l?.001:.4,ease:[.25,.1,.25,1]},className:"flex flex-col items-center justify-center min-h-[calc(100vh-380px)] text-center p-5",children:[e.jsx(q,{className:"w-16 h-16 mb-6 text-[var(--color-danger-accent)]"}),e.jsx("p",{className:"text-xl font-semibold text-[var(--color-text-primary)] mb-3",children:s("error")}),e.jsxs("p",{className:"text-base text-[var(--color-text-secondary)] mb-10 max-w-md",children:[s("resultsErrorNotFound",{quizId:u||"unknown"})," (Unexpected)"]}),e.jsxs(p,{onClick:()=>d("/dashboard"),variant:"secondary",size:"lg",className:"py-3.5 px-8 rounded-xl",children:[" ",s("resultsGoToDashboard")," "]})]});if(n.id!==t.quizId)return y.error("ResultsPage: Mismatch between currentDisplayQuiz.id and quizResult.quizId","ResultsPage",{displayQuizId:n.id,resultQuizId:t.quizId}),e.jsxs(c.div,{initial:l?{opacity:1,y:0}:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:l?.001:.4,ease:[.25,.1,.25,1]},className:"flex flex-col items-center justify-center min-h-[calc(100vh-380px)] text-center p-5",children:[e.jsx(q,{className:"w-16 h-16 mb-6 text-[var(--color-danger-accent)]"}),e.jsx("p",{className:"text-xl font-semibold mb-4 text-[var(--color-danger-accent)]",children:"Critical Error: Data Mismatch"}),e.jsxs("p",{className:"text-sm text-[var(--color-text-muted)]",children:["Displayed Quiz ID: ",n.id,", Result Quiz ID: ",t.quizId]}),e.jsxs(p,{onClick:()=>d("/dashboard"),variant:"secondary",size:"lg",className:"py-3.5 px-8 rounded-xl mt-6",children:[" ",s("resultsGoToDashboard")," "]})]});const{score:f,answers:L,totalCorrect:$,totalQuestions:_,sourceMode:k}=t,M=(o,r)=>r?r.trim()===o.correctAnswer.trim():!1,B=(o,r)=>{if(!r||r.trim()==="")return"No answer provided";const a=parseInt(r);return!isNaN(a)&&o.options&&o.options[a]?o.options[a]:r},G=f>=70?"text-green-400":f>=40?"text-amber-400":"text-red-400",V=f>=70?"bg-gradient-to-r from-green-400 to-emerald-400":f>=40?"bg-gradient-to-r from-amber-400 to-yellow-400":"bg-gradient-to-r from-red-400 to-rose-400",O=k==="practice"?s("practiceSummaryTitle",{quizTitle:n.title}):s("resultsTitle",{quizTitle:n.title});return e.jsx(c.div,{initial:"hidden",animate:"visible",variants:E,children:e.jsxs(A,{className:"max-w-4xl mx-auto shadow-2xl !rounded-2xl",useGlassEffect:!0,children:[e.jsx(c.h1,{variants:v,className:"text-3xl sm:text-4xl font-bold text-[var(--color-text-primary)] mb-4 text-center leading-tight tracking-tight line-clamp-2",title:n.title,children:e.jsx(N,{text:O,markdownFormatting:!0})}),e.jsx(c.div,{variants:v,className:"text-base text-[var(--color-text-secondary)] mb-12 text-center",children:e.jsx(N,{text:s(k==="practice"?"practiceSummarySubtitle":"resultsSubtitle"),markdownFormatting:!0})}),e.jsx(c.div,{variants:v,children:e.jsxs(A,{className:"mb-12 !bg-[var(--color-bg-surface-2)]/70 shadow-xl !border-[var(--color-border-default)] p-0 overflow-hidden !rounded-2xl",useGlassEffect:!1,children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-around items-center text-center gap-8 p-6 sm:p-10 !bg-[var(--color-bg-surface-1)]/60",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("p",{className:"text-sm text-[var(--color-text-muted)] uppercase tracking-wider font-medium mb-1.5",children:s("resultsYourScore")}),e.jsxs("p",{className:`text-6xl sm:text-7xl font-extrabold ${G} tracking-tight`,children:[f.toFixed(0),e.jsx("span",{className:"text-4xl",children:"%"})]})]}),e.jsx("div",{className:"w-full md:w-px h-px md:h-24 bg-[var(--color-border-default)] my-3 md:my-0"}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("p",{className:"text-sm text-[var(--color-text-muted)] uppercase tracking-wider font-medium mb-1.5",children:s("resultsCorrectAnswers")}),e.jsxs("p",{className:"text-5xl sm:text-6xl font-bold text-[var(--color-text-primary)]",children:[$," ",e.jsxs("span",{className:"text-3xl text-[var(--color-text-muted)]/80",children:["/ ",_]})]})]})]}),e.jsx(W,{progress:f,className:"w-full rounded-b-2xl overflow-hidden",size:"lg",barClassName:`${V} !h-3.5`,showPercentage:!1})]})}),e.jsx(c.h2,{variants:v,className:"text-2xl sm:text-3xl font-semibold text-[var(--color-text-primary)] mb-8 sm:mb-10",children:s("resultsBreakdownTitle")}),e.jsx(c.div,{variants:F,initial:"hidden",animate:"visible",className:"space-y-5",children:Array.isArray(n.questions)&&n.questions.map((o,r)=>{const a=L.find(C=>C.questionId===o.id),j=a?a.answer:"",I=M(o,j);return e.jsx(D,{question:o,userAnswerText:j,isCorrect:I,index:r,initiallyOpen:!I,getAnswerDisplayText:B},o.id)})}),e.jsxs(c.div,{variants:v,className:"mt-14 flex flex-col sm:flex-row justify-center items-center gap-4 sm:gap-5",children:[k==="practice"?e.jsx(p,{onClick:()=>d(`/practice/${n.id}`),variant:"outline",size:"lg",leftIcon:e.jsx(P,{className:"w-5 h-5"}),className:"w-full sm:w-auto py-3 px-8 rounded-xl",children:s("practiceAgain")}):e.jsx(p,{onClick:()=>d(`/quiz/${n.id}`),variant:"outline",size:"lg",leftIcon:e.jsx(P,{className:"w-5 h-5"}),className:"w-full sm:w-auto py-3 px-8 rounded-xl",children:s("resultsTryAgain")}),e.jsx(p,{onClick:()=>d("/dashboard"),variant:"secondary",size:"lg",leftIcon:e.jsx(Z,{className:"w-5 h-5"}),className:"w-full sm:w-auto py-3 px-8 rounded-xl",children:s("resultsBackToDashboard")}),e.jsx(p,{onClick:()=>d("/create"),variant:"primary",size:"lg",leftIcon:e.jsx(ee,{className:"w-5 h-5"}),className:"w-full sm:w-auto bg-gradient-to-r from-[var(--color-primary-accent)] to-indigo-500 hover:from-[var(--color-primary-accent-hover)] hover:to-indigo-600 text-white shadow-xl py-3 px-8 rounded-xl",children:s("resultsCreateNewQuiz")})]})]})})};ce.displayName="ResultsPage";export{ce as default};
