import{a as _,w as ee,b as te,u as se,r as o,j as e,L as N,B as f,C as ie,f as re,x as ne,p as le,V as I,d as T,q as ae,M as ce,y as P,X as oe}from"./index-DcfiZvdk.js";import{M as k}from"./MathText-Bdaeuop9.js";import{u as de}from"./useQuizFlow-c2E89btq.js";const fe=()=>{var D;const{t:s}=_(),{quizId:G}=ee(),v=te(),{setQuizResult:S}=se(),[a,q]=o.useState(null),[d,Q]=o.useState(!1),[b,F]=o.useState(null),[m,j]=o.useState([]),[A,L]=o.useState(!1),[w,W]=o.useState(!1),n=o.useRef(!1),X=o.useCallback(()=>{n.current||L(!0)},[]),{localActiveQuiz:l,currentQuestion:r,currentQuestionIndex:g,loading:U,timeLeft:C,goToNextQuestion:O,goToPreviousQuestion:E,formatTime:J,totalQuestions:p,shuffledQuestions:y,attemptSettings:z}=de(G,X),K="https://img.icons8.com/?size=256&id=eoxMN35Z6JKg&format=png";o.useEffect(()=>{y.length>0&&m.length===0&&j(y.map(i=>({questionId:i.id,selectedOption:null,isCorrect:null,firstTryCorrect:null,attempts:0})))},[y,m.length]),o.useEffect(()=>{if(n.current)return;let i=null,t=!1,c=null;if(r&&m.length>0){const u=m.find(x=>x.questionId===r.id);u&&(i=u.selectedOption,u.isCorrect!==null&&(t=!0,c=u.isCorrect))}q(i),Q(t),F(c)},[g,r,m]);const M=o.useCallback(()=>l?(!n.current&&r&&a&&!d&&j(i=>i.map(t=>t.questionId===r.id?{...t,selectedOption:a,isCorrect:null,attempts:(t.attempts||0)+1,...(t.attempts||0)===0&&t.firstTryCorrect===null&&{firstTryCorrect:null}}:t)),!0):!1,[l,r,a,d]),h=o.useCallback(()=>{if(n.current||!l)return;M();const i=m.filter(x=>x.isCorrect===!0).length,t=m.map(x=>({questionId:x.questionId,answer:x.selectedOption||""})),c=l.questions.length>0?i/l.questions.length*100:0,u={quizId:l.id,score:parseFloat(c.toFixed(2)),answers:t,totalCorrect:i,totalQuestions:l.questions.length,timeTaken:z.timeLimit>0?z.timeLimit*60-(C||0):void 0,sourceMode:"practice",createdAt:new Date().toISOString()};S(u),n.current=!0,W(!0)},[M,l,m,S,z.timeLimit,C]);o.useEffect(()=>{w&&n.current&&l&&v(`/results/${l.id}`)},[w,l,v]);const V=i=>{d||n.current||q(i)},Z=()=>{if(!a||!r||n.current)return;const i=a===r.correctAnswer;Q(!0),F(i),j(t=>t.map(c=>c.questionId===r.id?{...c,selectedOption:a,isCorrect:i,attempts:(c.attempts||0)+1,...(c.attempts||0)===0&&{firstTryCorrect:i}}:c))},$=o.useCallback(()=>{!l||!r||n.current||(a&&!d&&j(i=>i.map(t=>t.questionId===r.id&&(t.selectedOption!==a||t.isCorrect===null)?{...t,selectedOption:a,isCorrect:null,attempts:t.attempts||0}:t)),O()||h())},[l,r,O,h,a,d]),H=o.useCallback(()=>{!r||n.current||(a&&!d&&j(i=>i.map(t=>t.questionId===r.id&&(t.selectedOption!==a||t.isCorrect===null)?{...t,selectedOption:a,isCorrect:null,attempts:t.attempts||0}:t)),E())},[E,a,d,r]),R=o.useCallback(()=>{L(!1),h()},[h]);if(w)return e.jsx("div",{className:"flex flex-col items-center justify-center p-8 min-h-[400px]",children:e.jsx(N,{text:s("quizPracticeEnding")||"Processing...",size:"lg"})});if(U||!l)return e.jsx(N,{text:s("quizTakingLoading"),className:"mt-24",size:"xl"});if(!r)return l&&p>0&&g>=p?(n.current||(console.warn("QuizPracticePage: currentQuestion is undefined because index is out of bounds. Initiating finish."),h()),e.jsx("div",{className:"flex flex-col items-center justify-center p-8 min-h-[400px]",children:e.jsx(N,{text:s("quizPracticeEnding")||"Completing practice...",size:"lg"})})):U?e.jsx(N,{text:s("quizTakingLoading"),className:"mt-24",size:"xl"}):(console.error("QuizPracticePage: currentQuestion is undefined, but not due to finishing. Quiz data might be missing or an error occurred."),e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 min-h-[400px]",children:[e.jsx(N,{text:s("error")+" - "+(s("quizTakingLoading")||"Processing..."),size:"lg"}),e.jsx(f,{onClick:()=>v("/dashboard"),className:"mt-4",children:s("resultsGoToDashboard")})]}));const Y=p>0?(g+1)/p*100:0,B=g===p-1;return e.jsxs(ie,{className:"max-w-3xl mx-auto shadow-2xl !border-slate-700/40 !rounded-2xl animate-page-slide-fade-in",useGlassEffect:!0,children:[e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-slate-50 mb-4 leading-tight tracking-tight line-clamp-2",title:l.title,children:e.jsx(k,{text:s("quizPracticeTitle",{quizTitle:l.title})})}),e.jsxs("div",{className:"flex justify-between items-center text-sm text-slate-300 mb-5",children:[e.jsx("span",{children:s("quizTakingQuestionProgress",{current:g+1,total:p})}),C!==null&&e.jsx("span",{className:`font-semibold ${C<=60?"text-red-400 animate-pulse":"text-sky-300"}`,children:s("quizTakingTimeLeft",{time:J(C)})}),((D=l.config)==null?void 0:D.customUserPrompt)&&e.jsx(re,{content:e.jsx("div",{className:"max-w-xs text-left text-xs",children:e.jsx(k,{text:l.config.customUserPrompt})}),placement:"bottom-end",children:e.jsx(ne,{className:"w-5 h-5 text-yellow-300 cursor-help"})})]}),e.jsx(le,{progress:Y,size:"lg",barClassName:"bg-gradient-to-r from-purple-500 to-pink-500"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"p-6 sm:p-8 bg-slate-700/60 rounded-xl shadow-inner border border-slate-600/70 min-h-[200px] flex flex-col",children:e.jsxs("div",{className:"animate-fadeInUp",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-slate-100 mb-8 leading-relaxed",children:e.jsx(k,{text:r.questionText})}),e.jsx("div",{className:"flex-grow",children:e.jsx("div",{className:"space-y-4",children:r.options.map((i,t)=>{const c=a===i;let u="bg-slate-600 hover:bg-slate-500/80 border-slate-500 hover:border-sky-500 text-slate-100",x=e.jsx(P,{className:"w-6 h-6 text-slate-400 group-hover:text-sky-400 transition-colors var(--duration-fast) var(--ease-ios)",strokeWidth:2.5});return d?c&&b?(u="bg-green-500/40 border-green-500 text-green-50 font-semibold scale-[1.01]",x=e.jsx(I,{className:"w-6 h-6 text-green-50",isFilled:!0})):c&&!b?(u="bg-red-500/40 border-red-500 text-red-50 font-semibold scale-[1.01]",x=e.jsx(oe,{className:"w-6 h-6 text-red-50"})):i===r.correctAnswer?(u="bg-green-500/30 border-green-600 text-green-100 opacity-90",x=e.jsx(I,{className:"w-6 h-6 text-green-100",isFilled:!1})):(u="bg-slate-600/50 border-slate-700 text-slate-400 opacity-70 cursor-not-allowed",x=e.jsx(P,{className:"w-6 h-6 text-slate-500",strokeWidth:2.5})):c&&(u="bg-sky-500/50 border-sky-400 text-sky-50 font-semibold hover:bg-sky-500/60 scale-[1.01]",x=e.jsx(P,{className:"w-6 h-6 text-sky-50",isFilled:!0,strokeWidth:1})),e.jsxs("button",{onClick:()=>V(i),disabled:d||n.current,className:`w-full flex items-center text-left p-4 sm:p-4 rounded-xl border-2 focus:outline-none focus-visible:ring-4 focus-visible:ring-sky-400/50 focus-visible:ring-offset-2 ${c?"focus-visible:ring-offset-white":"focus-visible:ring-offset-slate-700"} shadow-lg
                                 transition-all var(--duration-fast) var(--ease-ios) will-change-transform, border, background-color
                                 ${u}`,"aria-pressed":c,children:[e.jsx("span",{className:"mr-3.5 flex-shrink-0",children:x}),e.jsx("span",{className:"text-sm sm:text-base flex-grow",children:e.jsx(k,{text:i})})]},`${i}-${t}`)})})})]},r.id)}),d&&e.jsxs("div",{className:"my-6 p-5 bg-slate-700/40 rounded-xl border border-slate-600/50 animate-fadeInUp",children:[e.jsxs("p",{className:"flex items-start text-base font-semibold text-sky-300 mb-2.5",children:[e.jsx("img",{src:K,alt:s("resultsExplanationTitle"),className:"w-5 h-5 mr-3 flex-shrink-0 mt-0.5"}),s("resultsExplanationTitle")]}),e.jsx("div",{className:"text-slate-300/90 text-sm leading-relaxed whitespace-pre-wrap break-words",children:e.jsx(k,{text:r.explanation||s("resultsNoExplanation")})})]})]}),e.jsxs("div",{className:"flex flex-col space-y-3 pt-6 border-t border-slate-700/60 mt-6 sm:mt-8",children:[" ",d?e.jsxs(e.Fragment,{children:[b===!0&&e.jsx("p",{className:"text-center text-green-400 font-semibold text-lg animate-fadeIn",children:s("answerCorrect")}),b===!1&&e.jsx("p",{className:"text-center text-red-400 font-semibold text-lg animate-fadeIn",children:s("answerIncorrect")}),e.jsx(f,{onClick:$,variant:"primary",size:"lg",rightIcon:e.jsx(T,{className:"w-5 h-5"}),disabled:n.current,className:`w-full py-3 rounded-xl ${b?"bg-green-500 hover:bg-green-600":"bg-red-500 hover:bg-red-600"}`,children:s(B?"finishPractice":"nextQuestion")})]}):e.jsx(f,{onClick:Z,disabled:!a||n.current,variant:"primary",size:"lg",leftIcon:e.jsx(I,{className:"w-5 h-5"}),className:"w-full py-3 rounded-xl",children:s("checkAnswer")}),e.jsxs("div",{className:"flex justify-between items-center pt-3",children:[e.jsx(f,{onClick:H,disabled:g===0||n.current,variant:"outline",size:"md",leftIcon:e.jsx(ae,{className:"w-4 h-4"}),className:"py-2.5 px-5 rounded-lg",children:s("previous")}),!d&&(B?e.jsx(f,{onClick:h,disabled:n.current,variant:"outline",size:"md",rightIcon:e.jsx(T,{className:"w-4 h-4"}),className:"py-2.5 px-5 rounded-lg",children:s("finishPractice")}):e.jsx(f,{onClick:$,disabled:n.current,variant:"outline",size:"md",rightIcon:e.jsx(T,{className:"w-4 h-4"}),className:"py-2.5 px-5 rounded-lg",children:s("skipQuestion")})),d&&e.jsx(f,{onClick:h,disabled:n.current,variant:"outline",size:"md",className:"py-2.5 px-5 rounded-lg",children:s("finishPractice")})]})]}),A&&e.jsx(ce,{isOpen:A&&!n.current,onClose:R,title:s("timesUp"),size:"md",hideCloseButton:!0,footerContent:e.jsx("div",{className:"flex justify-center",children:e.jsx(f,{variant:"primary",onClick:R,size:"md",children:s("timesUpSubmit")})}),children:e.jsx("p",{className:"text-slate-200 text-base leading-relaxed text-center",children:s("timesUpMessage")})})]})};export{fe as default};
