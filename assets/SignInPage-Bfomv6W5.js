import{i as x,k as v,m as y,Y as P,R as I,l as o,a6 as w,j as r,C as S,B as b}from"./index-DhksjH-H.js";const j={},C=()=>{const{login:f,currentUser:c}=x(),{t:a}=v(),l=y(),g=P(),d=void 0;I.useEffect(()=>{var e,t;if(c){const n=((t=(e=g.state)==null?void 0:e.from)==null?void 0:t.pathname)||"/dashboard";o.info("User already signed in, redirecting.","SignInPage",{from:n}),l(n,{replace:!0})}},[c,l,g.state]);const i=e=>{o.error("Google Login Failed.","SignInPage",{errorDetails:e})},s=w({onSuccess:async e=>{if(o.info("Google Login Succeeded (token obtained).","SignInPage",{hasAccessToken:!!e.access_token}),e.access_token)try{const t=await fetch("https://www.googleapis.com/oauth2/v3/userinfo",{headers:{Authorization:`Bearer ${e.access_token}`}});if(!t.ok){const u=await t.json().catch(()=>({message:"Failed to parse error response from userinfo endpoint"}));o.error("Failed to fetch user info from Google.","SignInPage",{status:t.status,errorData:u}),i(u);return}const n=await t.json(),p=n.picture?n.picture.replace(/=s\d+-c$/,"=s256-c"):n.picture,m={id:n.sub,name:n.name,email:n.email,imageUrl:p};o.info("User info fetched successfully. Calling login context function.","SignInPage",{userId:m.id}),f(m,e)}catch(t){o.error("Error during token validation or fetching user info.","SignInPage",void 0,t),i(t)}else o.error("Login success callback, but no access_token in tokenResponse.","SignInPage",{tokenResponse:e}),i(e)},onError:i,scope:"email profile https://www.googleapis.com/auth/drive.file"}),h=()=>{if(o.info("Custom Google Login button clicked.","SignInPage"),!d){o.warn("VITE_RECAPTCHA_SITE_KEY is not configured. Proceeding with login directly.","SignInPage"),s();return}if(typeof grecaptcha>"u"||typeof grecaptcha.enterprise>"u"||typeof grecaptcha.enterprise.ready!="function"){o.warn("reCAPTCHA enterprise.js not loaded or not ready. Proceeding with login directly.","SignInPage"),s();return}grecaptcha.enterprise.ready(async()=>{try{const e=await grecaptcha.enterprise.execute(d,{action:"LOGIN"});o.info("reCAPTCHA token obtained for LOGIN action.","SignInPage",{tokenPreview:e.slice(0,10)+"..."}),o.info("Skipping reCAPTCHA assessment for now. Proceeding with login.","SignInPage"),s()}catch(e){o.error("Lỗi khi thực thi reCAPTCHA (token generation):","SignInPage",void 0,e),s()}})};return r.jsx("div",{className:"flex flex-col items-center justify-center min-h-[calc(100vh-250px)] py-10 sm:py-16",children:r.jsxs(S,{className:"max-w-md w-full text-center shadow-2xl p-8 sm:p-10 md:p-12 !rounded-2xl",useGlassEffect:!0,children:[r.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-[var(--color-text-primary)] mb-4 mt-8 sm:mt-10",children:a("signInTitle")}),r.jsx("p",{className:"text-[var(--color-text-secondary)] mb-10 text-sm",children:a("signInSubtitle")}),r.jsx("div",{className:"flex justify-center mb-8",children:r.jsx(b,{onClick:h,variant:"subtle",size:"lg",leftIcon:r.jsx("img",{src:"https://img.icons8.com/color/48/google-logo.png",alt:"Google",className:"w-5 h-5"}),className:"w-full max-w-xs sm:w-[280px] !justify-start !text-[var(--color-text-primary)] hover:!bg-[var(--color-bg-surface-3)] !border-[var(--color-border-interactive)] hover:!border-[var(--color-border-strong)] !px-4 !py-3 !rounded-lg shadow-md",children:r.jsx("span",{className:"ml-3 text-sm font-medium",children:a("loginWithGoogle")})})}),r.jsxs("p",{className:"text-xs text-[var(--color-text-muted)]",children:[a("signInAgreementPrompt")," "," ",r.jsx("a",{href:"#",className:"text-[var(--color-primary-accent)] hover:underline font-medium",children:a("footerTerms")})," ",a("and")," "," ",r.jsx("a",{href:"#",className:"text-[var(--color-primary-accent)] hover:underline font-medium",children:a("footerPrivacy")}),"."]})]})})};C.displayName="SignInPage";export{C as default};
