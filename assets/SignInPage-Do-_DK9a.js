import{h as p,i as x,k as v,V as y,R as P,l as o,a3 as I,j as n,C as w,B as S}from"./index-BJ6IOBh1.js";const b={},j=()=>{const{login:f,currentUser:c}=p(),{t}=x(),l=v(),g=y(),d=void 0;P.useEffect(()=>{var e,r;if(c){const a=((r=(e=g.state)==null?void 0:e.from)==null?void 0:r.pathname)||"/dashboard";o.info("User already signed in, redirecting.","SignInPage",{from:a}),l(a,{replace:!0})}},[c,l,g.state]);const s=e=>{o.error("Google Login Failed.","SignInPage",{errorDetails:e})},i=I({onSuccess:async e=>{if(o.info("Google Login Succeeded (token obtained).","SignInPage",{hasAccessToken:!!e.access_token}),e.access_token)try{const r=await fetch("https://www.googleapis.com/oauth2/v3/userinfo",{headers:{Authorization:`Bearer ${e.access_token}`}});if(!r.ok){const u=await r.json().catch(()=>({message:"Failed to parse error response from userinfo endpoint"}));o.error("Failed to fetch user info from Google.","SignInPage",{status:r.status,errorData:u}),s(u);return}const a=await r.json(),m={id:a.sub,name:a.name,email:a.email,imageUrl:a.picture};o.info("User info fetched successfully. Calling login context function.","SignInPage",{userId:m.id}),f(m,e.access_token)}catch(r){o.error("Error during token validation or fetching user info.","SignInPage",void 0,r),s(r)}else o.error("Login success callback, but no access_token in tokenResponse.","SignInPage",{tokenResponse:e}),s(e)},onError:s,scope:"email profile https://www.googleapis.com/auth/drive.file"}),h=()=>{if(o.info("Custom Google Login button clicked.","SignInPage"),!d){o.warn("VITE_RECAPTCHA_SITE_KEY is not configured. Proceeding with login directly.","SignInPage"),i();return}if(typeof grecaptcha>"u"||typeof grecaptcha.enterprise>"u"||typeof grecaptcha.enterprise.ready!="function"){o.warn("reCAPTCHA enterprise.js not loaded or not ready. Proceeding with login directly.","SignInPage"),i();return}grecaptcha.enterprise.ready(async()=>{try{const e=await grecaptcha.enterprise.execute(d,{action:"LOGIN"});o.info("reCAPTCHA token obtained for LOGIN action.","SignInPage",{tokenPreview:e.slice(0,10)+"..."}),o.info("Skipping reCAPTCHA assessment for now. Proceeding with login.","SignInPage"),i()}catch(e){o.error("Lỗi khi thực thi reCAPTCHA (token generation):","SignInPage",void 0,e),i()}})};return n.jsx("div",{className:"flex flex-col items-center justify-center min-h-[calc(100vh-250px)] py-10 sm:py-16",children:n.jsxs(w,{className:"max-w-md w-full text-center shadow-2xl p-8 sm:p-10 md:p-12 !rounded-2xl",useGlassEffect:!0,children:[n.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-[var(--color-text-primary)] mb-4 mt-8 sm:mt-10",children:t("signInTitle")}),n.jsx("p",{className:"text-[var(--color-text-secondary)] mb-10 text-sm",children:t("signInSubtitle")}),n.jsx("div",{className:"flex justify-center mb-8",children:n.jsx(S,{onClick:h,variant:"subtle",size:"lg",leftIcon:n.jsx("img",{src:"https://img.icons8.com/color/48/google-logo.png",alt:"Google",className:"w-5 h-5"}),className:"w-full max-w-xs sm:w-[280px] !justify-start !text-[var(--color-text-primary)] hover:!bg-[var(--color-bg-surface-3)] !border-[var(--color-border-interactive)] hover:!border-[var(--color-border-strong)] !px-4 !py-3 !rounded-lg shadow-md",children:n.jsx("span",{className:"ml-3 text-sm font-medium",children:t("loginWithGoogle")})})}),n.jsxs("p",{className:"text-xs text-[var(--color-text-muted)]",children:[t("signInAgreementPrompt")," "," ",n.jsx("a",{href:"#",className:"text-[var(--color-primary-accent)] hover:underline font-medium",children:t("footerTerms")})," ",t("and")," "," ",n.jsx("a",{href:"#",className:"text-[var(--color-primary-accent)] hover:underline font-medium",children:t("footerPrivacy")}),"."]})]})})};j.displayName="SignInPage";export{j as default};
