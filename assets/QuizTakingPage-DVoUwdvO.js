import{i as K,k as V,E as X,m as Y,r as o,j as e,F as q,C as I,o as h,T as Z,H as _,q as ee,J as U,B as m,x as te,s as se,y as F}from"./index-1V_vZCT5.js";import{u as ae}from"./useQuizFlow-BpEkoGed.js";const re=()=>{var A;const{setQuizResult:w}=K(),{t:s}=V(),{quizId:M}=X(),N=Y(),[n,k]=o.useState({}),[i,g]=o.useState(null),[C,x]=o.useState(!1),[y,z]=o.useState(!1),L=o.useCallback(()=>{z(!0)},[]),{localActiveQuiz:r,currentQuestion:t,currentQuestionIndex:f,loading:P,timeLeft:u,goToNextQuestion:E,goToPreviousQuestion:O,formatTime:B,totalQuestions:l,attemptSettings:v}=ae(M,L);o.useEffect(()=>{t&&n[t.id]?g(n[t.id]):g(null)},[t,n]);const R=a=>{g(a)},T=o.useCallback(()=>{t&&i?k(a=>({...a,[t.id]:i})):t&&!i&&n[t.id]&&k(a=>{const c={...a};return delete c[t.id],c})},[t,i,n]),b=o.useCallback(()=>{if(!r)return;let a={...n};t&&i?a[t.id]=i:t&&!i&&a[t.id]&&delete a[t.id];let c=0;const d=[];r.questions.forEach(p=>{const j=a[p.id];j?(d.push({questionId:p.id,answer:j}),j===p.correctAnswer&&c++):d.push({questionId:p.id,answer:""})});const H=l>0?c/l*100:0,J={quizId:r.id,score:parseFloat(H.toFixed(2)),answers:d,totalCorrect:c,totalQuestions:l,timeTaken:v.timeLimit>0?v.timeLimit*60-(u||0):void 0,sourceMode:"take",createdAt:new Date().toISOString()};w(J),x(!1),z(!1),N(`/results/${r.id}`)},[r,n,t,i,u,w,N,l,v.timeLimit]),$=()=>{r&&(T(),E()||x(!0))},D=()=>{T(),O()},S=o.useCallback(()=>x(!1),[]),Q=o.useCallback(()=>{b()},[b]);if(P||!r)return e.jsx(q,{text:s("quizTakingLoading"),className:"mt-24",size:"xl"});if(!t)return e.jsxs(I,{className:"max-w-3xl mx-auto shadow-2xl !rounded-2xl animate-fadeInUp",useGlassEffect:!0,children:[e.jsx(q,{text:s("quizTakingLoading")}),e.jsx("p",{className:"text-center text-[var(--color-text-secondary)] mt-4",children:s("quizTakingErrorQuestionNotFound")})]});const G=l>0?(f+1)/l*100:0,W=f===l-1;return e.jsxs(I,{className:"max-w-3xl mx-auto shadow-2xl !rounded-2xl animate-page-slide-fade-in",useGlassEffect:!0,children:[e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-[var(--color-text-primary)] mb-3 sm:mb-4 leading-tight tracking-tight line-clamp-2",title:r.title,children:e.jsx(h,{text:r.title,markdownFormatting:!0})}),e.jsxs("div",{className:"flex justify-between items-center text-sm text-[var(--color-text-secondary)] mb-4 sm:mb-5",children:[e.jsx("span",{children:s("quizTakingQuestionProgress",{current:f+1,total:l})}),((A=r.config)==null?void 0:A.customUserPrompt)&&e.jsx(Z,{content:e.jsx("div",{className:"max-w-xs text-left text-xs",children:e.jsx(h,{text:r.config.customUserPrompt,markdownFormatting:!0})}),placement:"bottom-end",children:e.jsx(_,{className:"w-5 h-5 text-yellow-300 cursor-help"})}),u!==null&&e.jsx("span",{className:`font-semibold ${u<=60?"text-red-400 animate-pulse":"text-[var(--color-primary-accent)]"}`,children:s("quizTakingTimeLeft",{time:B(u)})})]}),e.jsx(ee,{progress:G,size:"lg",barClassName:"bg-gradient-to-r from-[var(--color-primary-accent)] to-indigo-500"})]}),e.jsxs("div",{className:"mt-8",children:[e.jsxs("div",{className:"quiz-question-text",children:[" ",e.jsx(h,{text:t.questionText,markdownFormatting:!0})]}),e.jsxs("div",{className:"quiz-options",children:[" ",t.options.map((a,c)=>{const d=i===a;return e.jsxs("button",{onClick:()=>R(a),className:`w-full flex items-center text-left p-3.5 sm:p-4 rounded-xl border-2 focus:outline-none focus-visible:ring-4 focus-visible:ring-[var(--color-primary-accent)]/50 focus-visible:ring-offset-2 shadow-lg 
                         transition-all var(--duration-fast) var(--ease-ios) will-change-transform, border, background-color
                         ${d?"bg-[var(--color-primary-accent)]/50 border-[var(--color-primary-accent)] text-[var(--color-primary-accent-text)] font-semibold scale-[1.01]":"bg-[var(--color-bg-surface-3)]/70 hover:bg-[var(--color-bg-surface-3)]/40 border-[var(--color-border-interactive)] hover:border-[var(--color-primary-accent)] text-[var(--color-text-primary)]"}`,"aria-pressed":d,children:[e.jsx("span",{className:"mr-3.5 flex-shrink-0",children:d?e.jsx(U,{className:"w-6 h-6 text-[var(--color-primary-accent-text)]",isFilled:!0,strokeWidth:1}):e.jsx(U,{className:"w-6 h-6 text-[var(--color-text-muted)] group-hover:text-[var(--color-primary-accent)] transition-colors var(--duration-fast) var(--ease-ios)",strokeWidth:2.5})}),e.jsxs("div",{className:"text-sm sm:text-base flex-grow markdown-content",children:[" ",e.jsx(h,{text:a,markdownFormatting:!0})]})]},c)})]})]}),e.jsxs("div",{className:"flex flex-col space-y-3 pt-6 sm:pt-8 border-t border-[var(--color-border-default)] mt-6 sm:mt-8",children:[e.jsx(m,{onClick:$,disabled:!i&&!(t&&n[t.id]),variant:"primary",size:"lg",rightIcon:e.jsx(te,{className:"w-5 h-5"}),className:"w-full py-3 rounded-xl",children:s(W?"submit":"nextQuestion")}),e.jsxs("div",{className:"flex justify-between items-center pt-3",children:[e.jsx(m,{onClick:D,disabled:f===0,variant:"outline",size:"md",leftIcon:e.jsx(se,{className:"w-4 h-4"}),className:"py-2.5 px-5 rounded-lg",children:s("previous")}),e.jsx(m,{onClick:()=>x(!0),variant:"outline",size:"md",className:"py-2.5 px-5 rounded-lg",children:s("quizTakingSubmitQuiz")})]})]}),C&&e.jsx(F,{isOpen:C,onClose:S,title:s("quizTakingSubmitQuiz"),size:"md",footerContent:e.jsxs("div",{className:"flex justify-end gap-3.5",children:[e.jsx(m,{variant:"secondary",onClick:S,size:"md",children:s("cancel")}),e.jsx(m,{variant:"primary",onClick:b,size:"md",children:s("submit")})]}),children:e.jsx("p",{className:"text-[var(--color-text-body)] text-base leading-relaxed",children:s("submitConfirmationMessage")})}),y&&e.jsx(F,{isOpen:y,onClose:Q,title:s("timesUp"),size:"md",hideCloseButton:!0,footerContent:e.jsx("div",{className:"flex justify-center",children:e.jsx(m,{variant:"primary",onClick:Q,size:"md",children:s("timesUpSubmit")})}),children:e.jsx("p",{className:"text-[var(--color-text-body)] text-base leading-relaxed text-center",children:s("timesUpMessage")})})]})};re.displayName="QuizTakingPage";export{re as default};
