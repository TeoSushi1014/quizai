import{j as r}from"./ui-BGuvgkTr.js";import{u as b,b as y,R as P}from"./router-BxjC687J.js";import{u as S,c as j,l as n,C as N,J as C}from"./index-Bo9azFxb.js";import"./vendor-DoC2WAmd.js";import"./utils-rUpm7H1u.js";import"./markdown-Bj7tmv2T.js";const L=()=>{const{login:p,currentUser:g}=S(),{t}=j(),l=b(),c=y();P.useEffect(()=>{var e,o;if(g){const s=((o=(e=c.state)==null?void 0:e.from)==null?void 0:o.pathname)||"/dashboard";n.info("User already signed in, redirecting.","SignInPage",{from:s}),l(s,{replace:!0})}},[g,l,c.state]);const i=e=>{n.error("Google Login Failed.","SignInPage",{errorDetails:e})},h=async e=>{var o,s,u;if(n.info("ðŸŽ‰ Google Login successful - ID token received!","SignInPage",{hasCredential:!!e.credential,credentialLength:((o=e.credential)==null?void 0:o.length)||0}),e.credential)try{const I=e.credential.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),v=decodeURIComponent(atob(I).split("").map(function(m){return"%"+("00"+m.charCodeAt(0).toString(16)).slice(-2)}).join("")),a=JSON.parse(v);n.info("ID token decoded successfully","SignInPage",{userId:a.sub,email:a.email});const f={id:a.sub,name:a.name,email:a.email,imageUrl:a.picture,idToken:e.credential};n.info("Calling login...","SignInPage",{userId:f.id,hasIdToken:!0});const x=await p(f);if(x){n.info("Login completed successfully, redirecting...","SignInPage",{userId:x.id});const m=((u=(s=c.state)==null?void 0:s.from)==null?void 0:u.pathname)||"/dashboard";l(m,{replace:!0})}else n.error("Login returned null result","SignInPage"),i(new Error("Login failed - no user returned"))}catch(d){n.error("Error during credential processing or login","SignInPage",void 0,d),i(d)}else n.error("Credential response received but no credential token","SignInPage",{credentialResponse:e}),i(e)};return r.jsx("div",{className:"flex flex-col items-center justify-center min-h-[calc(100vh-250px)] py-10 sm:py-16",children:r.jsxs(N,{className:"max-w-md w-full text-center shadow-2xl p-8 sm:p-10 md:p-12 !rounded-2xl",useGlassEffect:!0,children:[r.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-[var(--color-text-primary)] mb-4 mt-8 sm:mt-10",children:t("signInTitle")}),r.jsx("p",{className:"text-[var(--color-text-secondary)] mb-10 text-sm",children:t("signInSubtitle")}),r.jsx("div",{className:"flex flex-col items-center mb-8",children:r.jsx(C,{onSuccess:h,onError:i,useOneTap:!1,shape:"rectangular",theme:"outline",size:"large",text:"signin_with",width:"300",locale:"en"})}),r.jsxs("p",{className:"text-xs text-[var(--color-text-muted)]",children:[t("signInAgreementPrompt")," "," ",r.jsx("a",{href:"#",className:"text-[var(--color-primary-accent)] hover:underline font-medium",children:t("footerTerms")})," ",t("and")," "," ",r.jsx("a",{href:"#",className:"text-[var(--color-primary-accent)] hover:underline font-medium",children:t("footerPrivacy")}),"."]})]})})};L.displayName="SignInPage";export{L as default};
