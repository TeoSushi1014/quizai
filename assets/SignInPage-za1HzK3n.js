import{j as o}from"./ui-BGuvgkTr.js";import{u as I,b as P,R as w}from"./router-BxjC687J.js";import{u as S,c as b,l as r,J as j,C as L,B as C}from"./index-CV11Qt_x.js";import"./vendor-DoC2WAmd.js";import"./utils-rUpm7H1u.js";import"./markdown-Bj7tmv2T.js";const N={},_=()=>{const{login:h,currentUser:m}=S(),{t:n}=b(),d=I(),u=P(),f=void 0;w.useEffect(()=>{var e,c;if(m){const l=((c=(e=u.state)==null?void 0:e.from)==null?void 0:c.pathname)||"/dashboard";r.info("User already signed in, redirecting.","SignInPage",{from:l}),d(l,{replace:!0})}},[m,d,u.state]);const a=e=>{r.error("Google Login Failed.","SignInPage",{errorDetails:e})},g=j({onSuccess:async e=>{var c,l;if(r.info("Google Login Succeeded (token obtained).","SignInPage",{hasAccessToken:!!e.access_token}),e.access_token)try{const i=await fetch("https://www.googleapis.com/oauth2/v3/userinfo",{headers:{Authorization:`Bearer ${e.access_token}`}});if(!i.ok){const t=await i.json().catch(()=>({message:"Failed to parse error response from userinfo endpoint"}));r.error("Failed to fetch user info from Google.","SignInPage",{status:i.status,errorData:t}),a(t);return}const s=await i.json(),v=s.picture?s.picture.replace(/=s\d+-c$/,"=s256-c"):s.picture,p={id:s.sub,name:s.name,email:s.email,imageUrl:v};r.info("User info fetched successfully. Calling login context function.","SignInPage",{userId:p.id});try{const t=await h(p,e);if(t){r.info("Login completed successfully, redirecting...","SignInPage",{userId:t.id});const y=((l=(c=u.state)==null?void 0:c.from)==null?void 0:l.pathname)||"/dashboard";d(y,{replace:!0})}else r.error("Login returned null result","SignInPage"),a(new Error("Login failed - no user returned"))}catch(t){r.error("Login process failed","SignInPage",void 0,t),a(t)}}catch(i){r.error("Error during token validation, fetching user info, or login process.","SignInPage",void 0,i),a(i)}else r.error("Login success callback, but no access_token in tokenResponse.","SignInPage",{tokenResponse:e}),a(e)},onError:a,scope:"email profile https://www.googleapis.com/auth/drive.file"}),x=()=>{if(r.info("Custom Google Login button clicked.","SignInPage"),!f){r.warn("VITE_RECAPTCHA_SITE_KEY is not configured. Proceeding with login directly.","SignInPage"),g();return}if(typeof grecaptcha>"u"||typeof grecaptcha.enterprise>"u"||typeof grecaptcha.enterprise.ready!="function"){r.warn("reCAPTCHA enterprise.js not loaded or not ready. Proceeding with login directly.","SignInPage"),g();return}grecaptcha.enterprise.ready(async()=>{try{const e=await grecaptcha.enterprise.execute(f,{action:"LOGIN"});r.info("reCAPTCHA token obtained for LOGIN action.","SignInPage",{tokenPreview:e.slice(0,10)+"..."}),g()}catch(e){r.error("Lỗi khi thực thi reCAPTCHA (token generation):","SignInPage",void 0,e),g()}})};return o.jsx("div",{className:"flex flex-col items-center justify-center min-h-[calc(100vh-250px)] py-10 sm:py-16",children:o.jsxs(L,{className:"max-w-md w-full text-center shadow-2xl p-8 sm:p-10 md:p-12 !rounded-2xl",useGlassEffect:!0,children:[o.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-[var(--color-text-primary)] mb-4 mt-8 sm:mt-10",children:n("signInTitle")}),o.jsx("p",{className:"text-[var(--color-text-secondary)] mb-10 text-sm",children:n("signInSubtitle")}),o.jsx("div",{className:"flex justify-center mb-8",children:o.jsx(C,{onClick:x,variant:"subtle",size:"lg",leftIcon:o.jsx("img",{src:"https://img.icons8.com/color/48/google-logo.png",alt:"Google",className:"w-5 h-5"}),className:"w-full max-w-xs sm:w-[280px] !justify-start !text-[var(--color-text-primary)] hover:!bg-[var(--color-bg-surface-3)] !border-[var(--color-border-interactive)] hover:!border-[var(--color-border-strong)] !px-4 !py-3 !rounded-lg shadow-md",children:o.jsx("span",{className:"ml-3 text-sm font-medium",children:n("loginWithGoogle")})})}),o.jsxs("p",{className:"text-xs text-[var(--color-text-muted)]",children:[n("signInAgreementPrompt")," "," ",o.jsx("a",{href:"#",className:"text-[var(--color-primary-accent)] hover:underline font-medium",children:n("footerTerms")})," ",n("and")," "," ",o.jsx("a",{href:"#",className:"text-[var(--color-primary-accent)] hover:underline font-medium",children:n("footerPrivacy")}),"."]})]})})};_.displayName="SignInPage";export{_ as default};
