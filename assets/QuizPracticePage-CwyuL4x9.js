import{k as M,j as e,q as V,o as E,B as k,E as ee,m as te,i as re,r as d,F as Q,C as se,s as ie,x as ne,y as oe}from"./index-CT6kMGxJ.js";import{u as ae}from"./useQuizFlow-BdG3Ku_T.js";const D=({question:n,options:z,currentIndex:p,totalQuestions:N,selectedOption:o,onSelectOption:S,onCheckAnswer:l,onSkipQuestion:P,isSubmitting:w,isAnswerChecked:f=!1,isAnswerCorrect:x=null,correctAnswer:h=""})=>{const{t:C}=M(),O=N>0?(p+1)/N*100:0;return e.jsxs("div",{className:"quiz-question-container",children:[e.jsxs("div",{className:"quiz-progress",children:[e.jsx("div",{className:"flex justify-between items-center mb-1.5",children:e.jsx("span",{className:"text-sm font-medium text-[var(--color-text-primary)]",children:C("quizTakingQuestionProgress",{current:p+1,total:N})})}),e.jsx(V,{progress:O,size:"md",className:"mb-5"})]}),e.jsx("div",{className:"question-content mb-4",children:e.jsx(E,{text:n,markdownFormatting:!0})}),e.jsxs("div",{className:"space-y-3",children:[" ",z.map((c,b)=>{const a=o===c,y=h===c;let i="",r="",g="";return f?a&&x?(i="answer-option-correct bg-green-100 dark:bg-green-900/30 border-green-500 text-green-700 dark:text-green-300 font-semibold scale-[1.01]",r="border-green-500 bg-green-500",g="correct-answer-pulse"):a&&!x?(i="answer-option-incorrect bg-red-100 dark:bg-red-900/30 border-red-500 text-red-700 dark:text-red-300 font-semibold scale-[1.01]",r="border-red-500 bg-red-500",g="incorrect-answer-pulse"):y?(i="answer-option-correct bg-green-100 dark:bg-green-900/30 border-green-500 text-green-700 dark:text-green-300 font-semibold",r="border-green-500 bg-green-500"):(i="bg-[var(--color-bg-surface-3)]/70 border-[var(--color-border-interactive)] text-[var(--color-text-secondary)]",r="border-[var(--color-text-muted)] bg-[var(--color-bg-surface-2)]"):(i=a?"bg-[var(--color-primary-accent)]/50 border-[var(--color-primary-accent)] text-[var(--color-primary-accent-text)] font-semibold scale-[1.01]":"bg-[var(--color-bg-surface-3)]/70 hover:bg-[var(--color-bg-surface-3)]/40 border-[var(--color-border-interactive)] hover:border-[var(--color-primary-accent)] text-[var(--color-text-primary)]",r=a?"border-[var(--color-primary-accent-text)] bg-[var(--color-primary-accent)]":"border-[var(--color-text-muted)] bg-[var(--color-bg-surface-2)] group-hover:border-[var(--color-primary-accent)]"),e.jsxs("button",{type:"button",className:`w-full flex items-center text-left p-3.5 sm:p-4 rounded-xl border-2 focus:outline-none focus-visible:ring-4 focus-visible:ring-[var(--color-primary-accent)]/50 focus-visible:ring-offset-2 shadow-lg 
                          transition-all var(--duration-fast) var(--ease-ios) will-change-transform, border, background-color
                          ${i} ${g}`,onClick:()=>S(c),disabled:w||f,"aria-pressed":a,"aria-checked":f&&y?"true":"false",children:[e.jsx("span",{className:`option-indicator mr-3.5 flex-shrink-0 w-6 h-6 rounded-full border-2 flex items-center justify-center ${r}`,children:(a||f&&y)&&e.jsx("div",{className:"w-3 h-3 bg-white rounded-full"})}),e.jsx("div",{className:"option-content flex-grow text-sm sm:text-base flex items-center",children:e.jsx(E,{text:c,markdownFormatting:!0,compact:!0,stripPrefix:!0})}),f&&e.jsx("span",{className:"ml-2",children:y?e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-green-500",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}):a&&!x?e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-red-500",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}):null})]},b)})]}),e.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-center mt-5 pt-5 border-t border-[var(--color-border-default)] gap-3",children:f?e.jsx("div",{className:"w-full flex justify-end items-center"}):e.jsxs(e.Fragment,{children:[e.jsx(k,{variant:"subtle",onClick:P,disabled:w,className:"w-full sm:w-auto",children:C("skipQuestion")}),e.jsx(k,{variant:"primary",onClick:l,disabled:w||!o,className:"w-full sm:w-auto",children:C(w?"loading":"checkAnswer")})]})})]})};D.displayName="PracticeQuizQuestion";const G=({explanation:n,className:z=""})=>{const{t:p}=M();return e.jsxs("div",{className:`animate-fadeInUp mt-5 p-5 rounded-lg bg-[var(--color-bg-surface-2)]/50 border border-[var(--color-border-default)] shadow-md ${z}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-[var(--color-primary-accent)]",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2h-1V9a1 1 0 00-1-1z",clipRule:"evenodd"})}),e.jsx("span",{className:"font-semibold text-[var(--color-primary-accent)] text-base",children:p("resultsExplanationTitle")})]}),e.jsx("div",{className:"explanation-content",children:e.jsx("div",{className:"pl-1.5 border-l-2 border-[var(--color-primary-accent)]/20",children:e.jsx("div",{className:"explanation-text text-sm leading-relaxed text-[var(--color-text-body)] markdown-content",children:e.jsx(E,{text:n,markdownFormatting:!0})})})})]})};G.displayName="PracticeQuizExplanation";const le=()=>{const{t:n}=M(),{quizId:z}=ee(),p=te(),{setQuizResult:N}=re(),[o,S]=d.useState(null),[l,P]=d.useState(!1),[w,f]=d.useState(null),[x,h]=d.useState([]),[C,O]=d.useState(!1),[c,b]=d.useState(!1),a=d.useRef(!1),y=d.useCallback(()=>{a.current||O(!0)},[]),{localActiveQuiz:i,currentQuestion:r,currentQuestionIndex:g,loading:R,timeLeft:q,goToNextQuestion:T,goToPreviousQuestion:U,formatTime:H,totalQuestions:I,shuffledQuestions:L,attemptSettings:F}=ae(z,y);d.useEffect(()=>{L.length>0&&x.length===0&&h(L.map(s=>({questionId:s.id,selectedOption:null,isCorrect:null,firstTryCorrect:null,attempts:0})))},[L,x.length]),d.useEffect(()=>{if(a.current)return;let s=null,t=!1,u=null;if(r&&x.length>0){const j=x.find(A=>A.questionId===r.id);j&&(s=j.selectedOption,j.isCorrect!==null&&(t=!0,u=j.isCorrect))}S(s),P(t),f(u),b(!1)},[g,r,x]);const v=d.useCallback(()=>{if(a.current||!i)return;a.current=!0,b(!0);let s=[...x];r&&o&&!l?s=s.map(m=>m.questionId===r.id?{...m,selectedOption:o,isCorrect:null,attempts:m.attempts||0}:m):r&&!o&&!l&&(s=s.map(m=>m.questionId===r.id?{...m,selectedOption:null,isCorrect:null}:m));const t=s.filter(m=>m.isCorrect===!0).length,u=s.map(m=>({questionId:m.questionId,answer:m.selectedOption||""})),j=i.questions.length>0?t/i.questions.length*100:0,A={quizId:i.id,score:parseFloat(j.toFixed(2)),answers:u,totalCorrect:t,totalQuestions:i.questions.length,timeTaken:F.timeLimit>0?F.timeLimit*60-(q||0):void 0,sourceMode:"practice",createdAt:new Date().toISOString()};N(A),p(`/results/${i.id}`)},[i,x,r,o,l,N,F.timeLimit,q,p]),J=s=>{l||a.current||c||S(s)},K=()=>{if(!o||!r||a.current||c)return;b(!0);const s=o===r.correctAnswer;P(!0),f(s),h(t=>t.map(u=>u.questionId===r.id?{...u,selectedOption:o,isCorrect:s,attempts:(u.attempts||0)+1,...(u.attempts||0)===0&&{firstTryCorrect:s}}:u))},W=d.useCallback(()=>{!i||!r||a.current||c||(b(!0),o&&!l?h(s=>s.map(t=>t.questionId===r.id&&(t.selectedOption!==o||t.isCorrect===null)?{...t,selectedOption:o,isCorrect:t.isCorrect,attempts:t.attempts||0}:t)):!o&&!l&&h(s=>s.map(t=>t.questionId===r.id&&t.selectedOption!==null&&t.isCorrect===null?{...t,selectedOption:null}:t)),T()||v())},[i,r,T,v,o,l,c]),X=d.useCallback(()=>{!i||!r||a.current||c||(b(!0),T()||v())},[i,r,T,v,c]),Y=d.useCallback(()=>{!r||a.current||c||(b(!0),o&&!l?h(s=>s.map(t=>t.questionId===r.id&&(t.selectedOption!==o||t.isCorrect===null)?{...t,selectedOption:o,isCorrect:t.isCorrect,attempts:t.attempts||0}:t)):!o&&!l&&h(s=>s.map(t=>t.questionId===r.id&&t.selectedOption!==null&&t.isCorrect===null?{...t,selectedOption:null}:t)),U())},[U,o,l,r,c]),B=d.useCallback(()=>{v()},[v]),Z=(s,t)=>{const u=t.findIndex(j=>j===s);return u===-1?s:`${String.fromCharCode(65+u)}. ${s}`},_=()=>r?e.jsxs("div",{className:"space-y-4",children:[e.jsx(D,{question:r.questionText,options:r.options,currentIndex:g,totalQuestions:I,selectedOption:o,onSelectOption:J,onCheckAnswer:K,onSkipQuestion:X,isSubmitting:c,isAnswerChecked:l,isAnswerCorrect:w,correctAnswer:r.correctAnswer}),l&&e.jsx(G,{explanation:r.explanation||n("resultsNoExplanation"),isCorrect:w===!0,correctOptionLabel:Z(r.correctAnswer,r.options),showFeedbackBanner:!1})]}):null;if(c&&a.current)return e.jsx("div",{className:"flex flex-col items-center justify-center p-8 min-h-[400px]",children:e.jsx(Q,{text:n("quizPracticeEnding")||"Processing...",size:"lg"})});if(R||!i)return e.jsx(Q,{text:n("quizTakingLoading"),className:"mt-24",size:"xl"});if(!r)return i&&I>0&&g>=I?(a.current||v(),e.jsx("div",{className:"flex flex-col items-center justify-center p-8 min-h-[400px]",children:e.jsx(Q,{text:n("quizPracticeEnding")||"Completing practice...",size:"lg"})})):R?e.jsx(Q,{text:n("quizTakingLoading"),className:"mt-24",size:"xl"}):(console.error("QuizPracticePage: currentQuestion is undefined, but not due to finishing. Quiz data might be missing or an error occurred."),e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 min-h-[400px]",children:[e.jsx(Q,{text:n("error")+" - "+(n("quizTakingLoading")||"Processing..."),size:"lg"}),e.jsx(k,{onClick:()=>p("/dashboard"),className:"mt-4",children:n("resultsGoToDashboard")})]}));const $=g===I-1;return e.jsxs(se,{className:"max-w-2xl mx-auto shadow-2xl !rounded-2xl animate-page-slide-fade-in p-5 sm:p-6",useGlassEffect:!0,children:[e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-[var(--color-text-primary)] mb-3 leading-tight tracking-tight line-clamp-2",title:i.title,children:n("quizPracticeTitle",{quizTitle:i.title})}),e.jsx("div",{className:"flex justify-between items-center text-xs text-[var(--color-text-secondary)] mb-2",children:q!==null&&e.jsx("span",{className:`font-semibold ${q<=60?"text-red-400 animate-pulse":"text-[var(--color-primary-accent)]"}`,children:n("quizTakingTimeLeft",{time:H(q)})})})]}),_(),e.jsxs("div",{className:"quiz-navigation-actions mt-6 pt-6 border-t border-[var(--color-border-default)] flex flex-col sm:flex-row sm:justify-between gap-3",children:[e.jsx(k,{variant:"secondary",onClick:Y,disabled:c||g===0,size:"md",leftIcon:e.jsx(ie,{className:"w-4 h-4"}),className:"w-full sm:w-auto",children:n("previous")}),e.jsx(k,{variant:$&&l?"primary":"secondary",onClick:l?W:v,disabled:c,size:"md",rightIcon:e.jsx(ne,{className:"w-4 h-4"}),className:"w-full sm:w-auto",children:n(l?$?"finishPractice":"nextQuestion":"finishPractice")})]}),C&&e.jsx(oe,{isOpen:C&&!a.current,onClose:B,title:n("timesUp"),size:"md",hideCloseButton:!0,footerContent:e.jsx("div",{className:"flex justify-center",children:e.jsx(k,{variant:"primary",onClick:B,size:"md",children:n("timesUpSubmit")})}),children:e.jsx("p",{className:"text-[var(--color-text-body)] text-base leading-relaxed text-center",children:n("timesUpMessage")})})]})};le.displayName="QuizPracticePage";export{le as default};
