const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/services-BHj8px4z.js","assets/service-supabase-wASzC9XA.js","assets/app-components-CFPFxe5x.js","assets/core-react-DcE6uGcR.js","assets/katex-core-BbYO2yyT.js","assets/katex-extras-AZS8NW-4.js","assets/katex-extras-Z53fddTf.css","assets/google-services-Bc_loC93.js","assets/router-Dk7yDelZ.js","assets/feature-quiz-home-Ch5jepSG.js","assets/feature-quiz-components-CChsAlA6.js","assets/ui-framework-CdNWeEQR.js","assets/feature-quiz-dashboard-C8yrEGC7.js","assets/markdown-processors-D3jN8hOQ.js","assets/react-markdown-Cej2CoYR.js","assets/app-components-CL2IDdOq.css","assets/markdown-styles-T-m_OsNd.css","assets/feature-quiz-sharedquiz-Clu9xfzS.js","assets/feature-quiz-2SquOiTn.js","assets/util-storage-UFVse9kk.js","assets/util-document-Dv5rbOR1.js","assets/util-pdf-CkIVnOzu.js"])))=>i.map(i=>d[i]);
import{u as e,a as t,L as s,i as r,B as a,C as i,f as o,j as l,A as n,J as c,n as d,s as x,V as m,E as u}from"./app-components-CFPFxe5x.js";import{r as p,j as h}from"./core-react-DcE6uGcR.js";import{A as f}from"./feature-quiz-components-CChsAlA6.js";import{u as g}from"./feature-quiz-home-Ch5jepSG.js";import{l as j}from"./services-BHj8px4z.js";import{m as y}from"./ui-framework-CdNWeEQR.js";import{d as v,a as b}from"./router-Dk7yDelZ.js";import"./katex-core-BbYO2yyT.js";import"./katex-extras-AZS8NW-4.js";import"./service-supabase-wASzC9XA.js";import"./google-services-Bc_loC93.js";/* empty css                        */import"./feature-quiz-dashboard-C8yrEGC7.js";import"./markdown-processors-D3jN8hOQ.js";import"./react-markdown-Cej2CoYR.js";import"./feature-quiz-sharedquiz-Clu9xfzS.js";import"./feature-quiz-2SquOiTn.js";import"./util-storage-UFVse9kk.js";import"./util-document-Dv5rbOR1.js";import"./util-pdf-CkIVnOzu.js";const N=({question:e,userAnswerText:s,isCorrect:r,index:a,initiallyOpen:i=!1,getAnswerDisplayText:o})=>{const{t:l}=t(),n=g(),c=p.useMemo(()=>(e=>({hidden:{opacity:e?1:0,y:e?0:20},visible:{opacity:1,y:0,transition:{duration:e?.001:.4,ease:[.25,.1,.25,1]}}}))(n),[n]);return h.jsx(y.div,{variants:c,children:h.jsx(m,{initiallyOpen:i,containerClassName:"!rounded-xl shadow-lg "+(r?"!border-green-500/60":"!border-red-500/60"),title:h.jsx(f,{question:e,index:a,isCorrect:r}),titleClassName:"py-3.5 px-4 sm:py-4 sm:px-5 rounded-t-xl "+(r?"hover:!bg-green-400/15":"hover:!bg-red-400/15"),contentClassName:"!bg-[var(--color-bg-surface-2)]/30",children:h.jsxs("div",{className:"space-y-5 text-sm sm:text-base p-4 sm:p-5",children:[h.jsxs("div",{children:[h.jsx("p",{className:"font-semibold text-[var(--color-text-secondary)] mb-1.5",children:l("resultsYourAnswerLabel")||"Your Answer:"}),h.jsx("div",{className:"p-3 rounded-md "+(r?"bg-green-500/10 text-green-700 dark:text-green-300":"bg-red-500/10 text-red-700 dark:text-red-300"),children:h.jsx(u,{content:o(e,s)})})]}),h.jsxs("div",{children:[h.jsx("p",{className:"font-semibold text-[var(--color-text-secondary)] mb-1.5",children:l("resultsCorrectAnswerLabel")||"Correct Answer:"}),h.jsx("div",{className:"p-3 rounded-md "+(r?"bg-green-500/10 text-green-700 dark:text-green-300":"bg-blue-500/10 text-blue-700 dark:text-blue-300"),children:h.jsx(u,{content:o(e,e.correctAnswer)})})]}),e.explanation&&h.jsxs("div",{children:[h.jsx("p",{className:"font-semibold text-[var(--color-text-secondary)] mb-1.5",children:l("resultsExplanationLabel")||"Explanation:"}),h.jsx("div",{className:"p-3 rounded-md bg-gray-500/10 text-[var(--color-text-primary)]",children:h.jsx(u,{content:e.explanation})})]})]})})})};N.displayName="QuestionResultItem";const w=()=>{const{quizResult:m,isLoading:u,getQuizByIdFromAll:f,setActiveQuiz:w,setQuizResult:z}=e(),{t:q}=t(),{quizId:k}=v(),I=b(),C=g(),[A,S]=p.useState(null),[Q,R]=p.useState(!0),[E,T]=p.useState(null),D=p.useMemo(()=>(e=>({hidden:{opacity:e?1:0},visible:{opacity:1,transition:{staggerChildren:e?0:.1,duration:e?.001:.3,ease:[.25,.1,.25,1]}}}))(C),[C]),F=p.useMemo(()=>(e=>({hidden:{opacity:e?1:0,y:e?0:20},visible:{opacity:1,y:0,transition:{duration:e?.001:.4,ease:[.25,.1,.25,1]}}}))(C),[C]),P=p.useMemo(()=>(e=>({hidden:{opacity:e?1:0},visible:{opacity:1,transition:{staggerChildren:e?0:.075}}}))(C),[C]);if(p.useEffect(()=>{if(R(!0),T(null),!u){if(!m){const t=localStorage.getItem("quizResult");if(t)try{const e=JSON.parse(t);if(e&&e.quizId===k)return j.info("Found quiz result in localStorage, manually setting...","ResultsPage"),void z(e)}catch(e){j.error("Failed to parse localStorage quiz result","ResultsPage",{},e)}return T(q("resultsErrorNotFound",{quizId:k||"unknown"})+" - "+q("resultsErrorNoData")),S(null),void R(!1)}if(!m.quizId)return T(q("resultsErrorNotFound",{quizId:"unknown"})),S(null),void R(!1);(async()=>{let e=f(m.quizId);if(!e){j.info("Quiz not found in local data, attempting to fetch shared quiz...","ResultsPage");try{const{getSharedQuiz:t}=await x(async()=>{const{getSharedQuiz:e}=await import("./services-BHj8px4z.js").then(e=>e.t);return{getSharedQuiz:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21])),s=await t(m.quizId);s&&(e=s,j.info("Successfully fetched shared quiz data","ResultsPage"))}catch(t){j.error("Failed to fetch shared quiz","ResultsPage",{},t)}}e?(S(e),w(e),R(!1)):(T(q("resultsErrorNotFound",{quizId:m.quizId})),S(null),R(!1))})()}},[m,f,w,k,u,q,z]),Q)return h.jsx("div",{className:"flex flex-col items-center justify-center min-h-[calc(100vh-380px)] text-center p-5",children:h.jsx(s,{text:q("resultsLoading"),className:"mb-10",size:"xl"})});if(E)return h.jsxs(y.div,{initial:C?{opacity:1,y:0}:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:C?.001:.4,ease:[.25,.1,.25,1]},className:"flex flex-col items-center justify-center min-h-[calc(100vh-380px)] text-center p-5",children:[h.jsx(r,{className:"w-16 h-16 mb-6 text-[var(--color-danger-accent)]"}),h.jsx("p",{className:"text-xl font-semibold text-[var(--color-text-primary)] mb-3",children:q("error")}),h.jsx("p",{className:"text-base text-[var(--color-text-secondary)] mb-10 max-w-md",children:E}),h.jsxs(a,{onClick:()=>I("/dashboard"),variant:"secondary",size:"lg",className:"py-3 px-7 rounded-xl",children:[" ",q("resultsGoToDashboard")," "]})]});if(!m||!A)return h.jsxs(y.div,{initial:C?{opacity:1,y:0}:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:C?.001:.4,ease:[.25,.1,.25,1]},className:"flex flex-col items-center justify-center min-h-[calc(100vh-380px)] text-center p-5",children:[h.jsx(r,{className:"w-16 h-16 mb-6 text-[var(--color-danger-accent)]"}),h.jsx("p",{className:"text-xl font-semibold text-[var(--color-text-primary)] mb-3",children:q("error")}),h.jsxs("p",{className:"text-base text-[var(--color-text-secondary)] mb-10 max-w-md",children:[q("resultsErrorNotFound",{quizId:k||"unknown"})," (Unexpected)"]}),h.jsxs(a,{onClick:()=>I("/dashboard"),variant:"secondary",size:"lg",className:"py-3.5 px-8 rounded-xl",children:[" ",q("resultsGoToDashboard")," "]})]});if(A.id!==m.quizId)return j.error("ResultsPage: Mismatch between currentDisplayQuiz.id and quizResult.quizId","ResultsPage",{displayQuizId:A.id,resultQuizId:m.quizId}),h.jsxs(y.div,{initial:C?{opacity:1,y:0}:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:C?.001:.4,ease:[.25,.1,.25,1]},className:"flex flex-col items-center justify-center min-h-[calc(100vh-380px)] text-center p-5",children:[h.jsx(r,{className:"w-16 h-16 mb-6 text-[var(--color-danger-accent)]"}),h.jsx("p",{className:"text-xl font-semibold mb-4 text-[var(--color-danger-accent)]",children:"Critical Error: Data Mismatch"}),h.jsxs("p",{className:"text-sm text-[var(--color-text-muted)]",children:["Displayed Quiz ID: ",A.id,", Result Quiz ID: ",m.quizId]}),h.jsxs(a,{onClick:()=>I("/dashboard"),variant:"secondary",size:"lg",className:"py-3.5 px-8 rounded-xl mt-6",children:[" ",q("resultsGoToDashboard")," "]})]});const{score:L,answers:M,totalCorrect:G,totalQuestions:O,sourceMode:_}=m,B=(e,t)=>{if(!t||""===t.trim())return"No answer provided";const s=parseInt(t);return!isNaN(s)&&e.options&&e.options[s]?e.options[s]:t},$=L>=70?"text-green-400":L>=40?"text-amber-400":"text-red-400",Y=L>=70?"bg-gradient-to-r from-green-400 to-emerald-400":L>=40?"bg-gradient-to-r from-amber-400 to-yellow-400":"bg-gradient-to-r from-red-400 to-rose-400",J=q("practice"===_?"practiceSummaryTitle":"resultsTitle",{quizTitle:A.title});return h.jsx(y.div,{initial:"hidden",animate:"visible",variants:D,children:h.jsxs(i,{className:"max-w-4xl mx-auto shadow-2xl !rounded-2xl",useGlassEffect:!0,children:[h.jsx(y.h1,{variants:F,className:"text-3xl sm:text-4xl font-bold text-[var(--color-text-primary)] mb-4 text-center leading-tight tracking-tight line-clamp-2",title:A.title,children:h.jsx(o,{text:J,markdownFormatting:!0})}),h.jsx(y.div,{variants:F,className:"text-base text-[var(--color-text-secondary)] mb-12 text-center",children:h.jsx(o,{text:q("practice"===_?"practiceSummarySubtitle":"resultsSubtitle"),markdownFormatting:!0})}),h.jsx(y.div,{variants:F,children:h.jsxs(i,{className:"mb-12 !bg-[var(--color-bg-surface-2)]/70 shadow-xl !border-[var(--color-border-default)] p-0 overflow-hidden !rounded-2xl",useGlassEffect:!1,children:[h.jsxs("div",{className:"flex flex-col md:flex-row justify-around items-center text-center gap-8 p-6 sm:p-10 !bg-[var(--color-bg-surface-1)]/60",children:[h.jsxs("div",{className:"flex flex-col items-center",children:[h.jsx("p",{className:"text-sm text-[var(--color-text-muted)] uppercase tracking-wider font-medium mb-1.5",children:q("resultsYourScore")}),h.jsxs("p",{className:`text-6xl sm:text-7xl font-extrabold ${$} tracking-tight`,children:[L.toFixed(0),h.jsx("span",{className:"text-4xl",children:"%"})]})]}),h.jsx("div",{className:"w-full md:w-px h-px md:h-24 bg-[var(--color-border-default)] my-3 md:my-0"}),h.jsxs("div",{className:"flex flex-col items-center",children:[h.jsx("p",{className:"text-sm text-[var(--color-text-muted)] uppercase tracking-wider font-medium mb-1.5",children:q("resultsCorrectAnswers")}),h.jsxs("p",{className:"text-5xl sm:text-6xl font-bold text-[var(--color-text-primary)]",children:[G," ",h.jsxs("span",{className:"text-3xl text-[var(--color-text-muted)]/80",children:["/ ",O]})]})]})]}),h.jsx(l,{progress:L,className:"w-full rounded-b-2xl overflow-hidden",size:"lg",barClassName:`${Y} !h-3.5`,showPercentage:!1})]})}),h.jsx(y.h2,{variants:F,className:"text-2xl sm:text-3xl font-semibold text-[var(--color-text-primary)] mb-8 sm:mb-10",children:q("resultsBreakdownTitle")}),h.jsx(y.div,{variants:P,initial:"hidden",animate:"visible",className:"space-y-5",children:Array.isArray(A.questions)&&A.questions.map((e,t)=>{const s=M.find(t=>t.questionId===e.id),r=s?s.answer:"",a=((e,t)=>!!t&&t.trim()===e.correctAnswer.trim())(e,r);return h.jsx(N,{question:e,userAnswerText:r,isCorrect:a,index:t,initiallyOpen:!a,getAnswerDisplayText:B},e.id)})}),h.jsxs(y.div,{variants:F,className:"mt-14 flex flex-col sm:flex-row justify-center items-center gap-4 sm:gap-5",children:["practice"===_?h.jsx(a,{onClick:()=>I(`/practice/${A.id}`),variant:"outline",size:"lg",leftIcon:h.jsx(n,{className:"w-5 h-5"}),className:"w-full sm:w-auto py-3 px-8 rounded-xl",children:q("practiceAgain")}):h.jsx(a,{onClick:()=>I(`/quiz/${A.id}`),variant:"outline",size:"lg",leftIcon:h.jsx(n,{className:"w-5 h-5"}),className:"w-full sm:w-auto py-3 px-8 rounded-xl",children:q("resultsTryAgain")}),h.jsx(a,{onClick:()=>I("/dashboard"),variant:"secondary",size:"lg",leftIcon:h.jsx(c,{className:"w-5 h-5"}),className:"w-full sm:w-auto py-3 px-8 rounded-xl",children:q("resultsBackToDashboard")}),h.jsx(a,{onClick:()=>I("/create"),variant:"primary",size:"lg",leftIcon:h.jsx(d,{className:"w-5 h-5"}),className:"w-full sm:w-auto bg-gradient-to-r from-[var(--color-primary-accent)] to-indigo-500 hover:from-[var(--color-primary-accent-hover)] hover:to-indigo-600 text-white shadow-xl py-3 px-8 rounded-xl",children:q("resultsCreateNewQuiz")})]})]})})};w.displayName="ResultsPage";export{w as default};
