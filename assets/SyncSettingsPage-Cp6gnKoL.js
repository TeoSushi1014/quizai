import{j as e,m as D}from"./ui-BGuvgkTr.js";import{l as x,C as b,K as A,B as N,o as E,u as z,c as L,O as G,L as O,M as T,Q as _,h as $,R as P,X as q,I as B}from"./index-rzFk0lB6.js";import{r as v,u as Y}from"./router-BxjC687J.js";import{s as K}from"./secureConfigService-u6yiOjud.js";import"./vendor-DoC2WAmd.js";import"./utils-rUpm7H1u.js";import"./markdown-Bj7tmv2T.js";const g=[{name:"GEMINI_API_KEY",displayName:"Google Gemini API Key (Personal)",description:"Optional: Use your own API key for quiz generation. Leave empty to use default system key.",placeholder:"AIzaSy... (optional - leave empty to use default)",pattern:/^AIza[0-9A-Za-z-_]{35}$/,required:!1}],F=({onApiKeyUpdate:i})=>{const[u,n]=v.useState({}),[c,y]=v.useState({}),[S,h]=v.useState({}),[d,o]=v.useState({}),[p,l]=v.useState(!1);v.useEffect(()=>{j()},[]);const j=async()=>{const s={},r={};for(const a of g)try{const t=await K.getUserPersonalApiKey(a.name);s[a.name]=t||"",r[a.name]=t?"valid":"unknown"}catch(t){x.error(`Failed to load API key: ${a.name}`,"ApiKeyManager",{},t),s[a.name]="",r[a.name]="unknown"}n(s),o(r)},w=(s,r)=>{const a=g.find(t=>t.name===s);return!(!a||a.required&&!r.trim()||a.pattern&&!a.pattern.test(r))},C=(s,r)=>{n(t=>({...t,[s]:r}));const a=w(s,r);o(t=>({...t,[s]:r.trim()?a?"valid":"invalid":"unknown"}))},M=async s=>{const r=u[s];if(r.trim()){h(a=>({...a,[s]:!0}));try{await K.setApiKey(s,r)?(o(t=>({...t,[s]:"valid"})),x.info(`API key saved successfully: ${s}`,"ApiKeyManager"),i==null||i()):(o(t=>({...t,[s]:"invalid"})),x.error(`Failed to save API key: ${s}`,"ApiKeyManager"))}catch(a){x.error(`Error saving API key: ${s}`,"ApiKeyManager",{},a),o(t=>({...t,[s]:"invalid"}))}finally{h(a=>({...a,[s]:!1}))}}},k=async()=>{l(!0);try{const s=g.map(async t=>{const f=u[t.name];return f!=null&&f.trim()?K.setApiKey(t.name,f):!0});(await Promise.all(s)).every(Boolean)?(x.info("All API keys saved successfully","ApiKeyManager"),i==null||i(),await j()):x.error("Some API keys failed to save","ApiKeyManager")}catch(s){x.error("Error saving API keys","ApiKeyManager",{},s)}finally{l(!1)}},I=s=>{y(r=>({...r,[s]:!r[s]}))},m=s=>{switch(s){case"valid":return e.jsx(E,{className:"w-5 h-5 text-green-500"});case"invalid":return e.jsx("span",{className:"w-5 h-5 text-red-500",children:"⚠️"});default:return e.jsx(A,{className:"w-5 h-5 text-gray-400"})}};return e.jsxs(b,{className:"!bg-[var(--color-bg-surface-2)]/80 !border-[var(--color-border-default)] p-6 rounded-xl shadow-lg",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(A,{className:"w-6 h-6 mr-3 text-[var(--color-primary-accent)]"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-[var(--color-text-primary)]",children:"API Key Management"}),e.jsx("p",{className:"text-sm text-[var(--color-text-secondary)] mt-1",children:"Securely store your API keys in Supabase"})]})]}),e.jsxs("div",{className:"space-y-6",children:[g.map(s=>{var r;return e.jsxs(D.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-[var(--color-text-primary)]",children:[s.displayName,s.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("p",{className:"text-xs text-[var(--color-text-secondary)] mt-1",children:s.description})]}),m(d[s.name]||"unknown")]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:c[s.name]?"text":"password",value:u[s.name]||"",onChange:a=>C(s.name,a.target.value),placeholder:s.placeholder,className:`w-full px-4 py-3 pr-20 bg-[var(--color-bg-surface-1)] border rounded-lg text-[var(--color-text-primary)] placeholder-[var(--color-text-secondary)] focus:outline-none focus:ring-2 focus:ring-[var(--color-primary-accent)] ${d[s.name]==="invalid"?"border-red-500":d[s.name]==="valid"?"border-green-500":"border-[var(--color-border-default)]"}`}),e.jsxs("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex items-center space-x-2",children:[e.jsx("button",{type:"button",onClick:()=>I(s.name),className:"p-1 text-[var(--color-text-secondary)] hover:text-[var(--color-text-primary)] transition-colors",children:c[s.name]?e.jsx("span",{className:"w-5 h-5",children:"👁️"}):e.jsx("span",{className:"w-5 h-5",children:"🙈"})}),e.jsx(N,{onClick:()=>M(s.name),isLoading:S[s.name],disabled:!((r=u[s.name])!=null&&r.trim())||d[s.name]==="invalid",size:"sm",variant:"primary",className:"!py-1 !px-3",children:"Save"})]})]}),d[s.name]==="invalid"&&e.jsx("p",{className:"text-xs text-red-500",children:"Invalid API key format. Please check your key."})]},s.name)}),e.jsx("div",{className:"flex justify-end pt-4 border-t border-[var(--color-border-default)]",children:e.jsx(N,{onClick:k,isLoading:p,variant:"primary",size:"lg",className:"min-w-[120px]",children:"Save All Keys"})})]}),e.jsx("div",{className:"mt-6 p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(A,{className:"w-5 h-5 text-blue-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"text-blue-300 font-medium mb-1",children:"How API Keys Work"}),e.jsxs("ul",{className:"text-blue-200/80 leading-relaxed space-y-1 text-xs list-disc list-inside",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Default System Key:"})," We provide a shared API key for all users to get started"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Personal API Key:"})," You can add your own key to avoid rate limits and have better control"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Priority:"})," Your personal key (if provided) will be used first, then falls back to system default"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Security:"})," All keys are encrypted and stored securely. Only you can see your personal keys"]})]})]})]})})]})},R=()=>{const{currentUser:i,syncWithGoogleDrive:u,isDriveLoading:n,driveSyncError:c,lastDriveSync:y,setDriveSyncError:S,isDriveSyncEnabled:h,setDriveSyncEnabled:d,driveSyncMode:o,setDriveSyncMode:p}=z(),{t:l,language:j}=L(),w=Y(),{theme:C,toggleTheme:M}=G();if(!i)return w("/signin",{state:{from:{pathname:"/settings"}}}),e.jsx(O,{text:l("loading")});const k=async()=>{window.confirm(l("syncConfirmation"))&&await u()},I=y?y.toLocaleString(j,{dateStyle:"medium",timeStyle:"short"}):l("syncStatusNever");return e.jsx("div",{className:"max-w-2xl mx-auto py-8 animate-page-slide-fade-in",children:e.jsxs(b,{useGlassEffect:!0,className:"shadow-2xl !rounded-2xl",children:[e.jsxs("div",{className:"text-center mb-10",children:[e.jsx("h1",{className:"text-3xl font-bold text-[var(--color-text-primary)] mb-3 tracking-tight",children:e.jsx(T,{text:l("navSettings")})}),e.jsx("p",{className:"text-[var(--color-text-secondary)] text-sm leading-relaxed",children:"Manage your application preferences and data synchronization."})]}),e.jsxs("div",{className:"space-y-8",children:[e.jsx(F,{onApiKeyUpdate:()=>{console.log("API keys updated")}}),e.jsxs(b,{className:"!bg-[var(--color-bg-surface-2)]/80 !border-[var(--color-border-default)] p-5 sm:p-6 rounded-xl shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(_,{className:"w-5 h-5 mr-2.5 text-sky-400 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-[var(--color-text-primary)]",children:"Google Drive Sync"}),e.jsx("p",{className:"text-xs text-[var(--color-text-secondary)] mt-1",children:"Enable backup and synchronization with Google Drive"})]})]}),e.jsx($,{label:"",checked:h,onChange:d,size:"md"})]}),h&&e.jsx("div",{className:"border-t border-[var(--color-border-default)]/50 pt-4 mt-4",children:e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--color-text-secondary)] mb-2",children:"Sync Mode"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",name:"syncMode",value:"backup-only",checked:o==="backup-only",onChange:m=>p(m.target.value),className:"mr-3 text-[var(--color-primary-accent)]"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-[var(--color-text-primary)]",children:"Backup Only"}),e.jsx("p",{className:"text-xs text-[var(--color-text-secondary)]",children:"Save data to Drive as backup, Supabase remains primary"})]})]}),e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",name:"syncMode",value:"manual",checked:o==="manual",onChange:m=>p(m.target.value),className:"mr-3 text-[var(--color-primary-accent)]"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-[var(--color-text-primary)]",children:"Manual Only"}),e.jsx("p",{className:"text-xs text-[var(--color-text-secondary)]",children:"Only sync when manually triggered below"})]})]}),e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",name:"syncMode",value:"auto",checked:o==="auto",onChange:m=>p(m.target.value),className:"mr-3 text-[var(--color-primary-accent)]"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-[var(--color-text-primary)]",children:"Auto Sync"}),e.jsx("p",{className:"text-xs text-[var(--color-text-secondary)]",children:"Automatically sync changes to Drive (legacy mode)"})]})]})]})]})})]}),h&&e.jsxs(b,{className:"!bg-[var(--color-bg-surface-2)]/80 !border-[var(--color-border-default)] p-5 sm:p-6 rounded-xl shadow-lg",children:[e.jsxs("div",{className:"flex items-center mb-1.5",children:[e.jsx(P,{className:"w-5 h-5 mr-2.5 text-sky-400 flex-shrink-0"}),e.jsx("p",{className:"text-base font-semibold text-[var(--color-text-primary)]",children:"Sync Status & Manual Trigger"})]}),e.jsx("p",{className:"text-xs text-[var(--color-text-secondary)] mb-5 sm:ml-[28px]",children:"Current sync status and manual sync controls"}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-[var(--color-text-secondary)] mb-1",children:l("syncStatus")}),n&&!c&&e.jsxs("div",{className:"flex items-center text-[var(--color-primary-accent)] animate-pulse",children:[e.jsx(P,{className:"w-4 h-4 mr-2 animate-spin"}),e.jsx("span",{className:"text-xs font-semibold",children:l("syncStatusInProgress")})]}),!n&&c&&e.jsxs("div",{className:"flex items-center text-[var(--color-danger-accent)]",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"text-xs font-semibold",children:l("syncStatusError",{error:c})})]}),!n&&!c&&y&&e.jsxs("div",{className:"flex items-center text-[var(--color-success-accent)]",children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"text-xs font-semibold",children:l("syncStatusLast",{dateTime:I})})]}),!n&&!c&&!y&&e.jsxs("div",{className:"flex items-center text-[var(--color-text-muted)]",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"text-xs font-semibold",children:l("syncStatusNever")})]})]}),e.jsx(N,{onClick:k,isLoading:n,disabled:n,variant:"primary",size:"md",leftIcon:e.jsx(P,{className:`w-5 h-5 ${n?"animate-spin":""}`}),className:"w-full sm:w-auto shadow-lg hover:shadow-[var(--color-primary-accent)]/40 py-2.5 px-6",children:l(n?"syncStatusInProgress":"syncNowButton")})]}),c&&e.jsx(N,{variant:"link",size:"xs",onClick:()=>S(null),className:"mt-3 !text-[var(--color-primary-accent)] hover:!text-[var(--color-primary-accent-hover)] text-xs",children:l("close")}),e.jsxs("p",{className:"text-xs text-[var(--color-text-muted)] text-center pt-6 mt-4 border-t border-[var(--color-border-default)]/50",children:["Your QuizAI data is securely stored in a file named ",e.jsx("code",{children:"quizai_user_data.json"})," in your Google Drive's root folder, accessible only by this application."]})]})]})]})})};R.displayName="SyncSettingsPage";export{R as default};
