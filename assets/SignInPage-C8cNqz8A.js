import{j as o}from"./ui-BGuvgkTr.js";import{u as y,b,R as x}from"./router-BxjC687J.js";import{u as v,c as P,l as n,C as j,J as L}from"./index-idi4WXQB.js";import"./vendor-DoC2WAmd.js";import"./utils-rUpm7H1u.js";import"./markdown-Bj7tmv2T.js";const C=()=>{const{login:w,currentUser:f}=v(),{t:a}=P(),u=y(),h=b();x.useEffect(()=>{var e,t;if(f){const r=((t=(e=h.state)==null?void 0:e.from)==null?void 0:t.pathname)||"/dashboard";n.info("User already signed in, redirecting.","SignInPage",{from:r}),u(r,{replace:!0})}},[f,u,h.state]),x.useEffect(()=>{console.log("ðŸ” SignInPage loaded, GoogleLogin component should be available");const e=!!window.google,t=!!document.querySelector('script[src*="accounts.google.com"]');n.info("SignInPage loaded - checking Google OAuth setup","SignInPage",{hasGoogleOAuth:e,hasGoogleScript:t,currentDomain:window.location.hostname,currentURL:window.location.href}),setTimeout(()=>{var r,g,s,d,m;console.log("ðŸ§ª Testing Google OAuth availability:",{googleObject:!!window.google,googleAccounts:!!((r=window.google)!=null&&r.accounts),googleId:!!((s=(g=window.google)==null?void 0:g.accounts)!=null&&s.id),domain:window.location.hostname}),(m=(d=window.google)==null?void 0:d.accounts)!=null&&m.id||(console.error("ðŸ”´ Google OAuth not properly loaded! GoogleLogin component may not work."),console.error("ðŸ”´ This could be why you're not seeing the ID token authentication working."))},2e3)},[]);const c=e=>{n.error("Google Login Failed.","SignInPage",{errorDetails:e})},I=async e=>{var t,r,g;if(n.info("ðŸŽ‰ GoogleLogin SUCCESS - ID token received!","SignInPage",{hasCredential:!!e.credential,credentialLength:((t=e.credential)==null?void 0:t.length)||0}),e.credential)try{const d=e.credential.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),m=decodeURIComponent(atob(d).split("").map(function(i){return"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)}).join("")),l=JSON.parse(m);n.info("ID token decoded successfully","SignInPage",{userId:l.sub,email:l.email});const p={id:l.sub,name:l.name,email:l.email,imageUrl:l.picture,idToken:e.credential};n.info("User profile created from ID token. Calling login context function.","SignInPage",{userId:p.id,hasIdToken:!0});try{const i=await w(p);if(i){n.info("Login completed successfully, redirecting...","SignInPage",{userId:i.id});const S=((g=(r=h.state)==null?void 0:r.from)==null?void 0:g.pathname)||"/dashboard";u(S,{replace:!0})}else n.error("Login returned null result","SignInPage"),c(new Error("Login failed - no user returned"))}catch(i){n.error("Login process failed","SignInPage",void 0,i),c(i)}}catch(s){n.error("Error during credential processing or login","SignInPage",void 0,s),c(s)}else n.error("Credential response received but no credential token","SignInPage",{credentialResponse:e}),c(e)};return o.jsx("div",{className:"flex flex-col items-center justify-center min-h-[calc(100vh-250px)] py-10 sm:py-16",children:o.jsxs(j,{className:"max-w-md w-full text-center shadow-2xl p-8 sm:p-10 md:p-12 !rounded-2xl",useGlassEffect:!0,children:[o.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-[var(--color-text-primary)] mb-4 mt-8 sm:mt-10",children:a("signInTitle")}),o.jsx("p",{className:"text-[var(--color-text-secondary)] mb-10 text-sm",children:a("signInSubtitle")}),o.jsx("div",{className:"flex flex-col items-center space-y-6 mb-8",children:o.jsxs("div",{className:"w-full max-w-xs sm:w-[280px]",children:[o.jsx("div",{className:"text-sm font-medium text-[var(--color-primary-accent)] text-center mb-2",children:"âœ¨ Sign in with Google"}),o.jsx("div",{className:"border-4 border-green-500 rounded p-3 bg-green-50 shadow-lg",children:o.jsx(L,{onSuccess:I,onError:e=>{n.error("GoogleLogin component failed","SignInPage",{error:e,domain:window.location.hostname,userAgent:navigator.userAgent,isSecureContext:window.isSecureContext}),console.error("ðŸ”´ GoogleLogin component error occurred!",e),console.error("ðŸ”´ If you see Cross-Origin-Opener-Policy errors, this might be a domain configuration issue"),console.error("ðŸ”´ Current domain:",window.location.hostname),c("Google Login component failed")},useOneTap:!1,shape:"rectangular",theme:"outline",size:"large",text:"signin_with",width:"260",locale:"en"})})]})}),o.jsxs("p",{className:"text-xs text-[var(--color-text-muted)]",children:[a("signInAgreementPrompt")," "," ",o.jsx("a",{href:"#",className:"text-[var(--color-primary-accent)] hover:underline font-medium",children:a("footerTerms")})," ",a("and")," "," ",o.jsx("a",{href:"#",className:"text-[var(--color-primary-accent)] hover:underline font-medium",children:a("footerPrivacy")}),"."]})]})})};C.displayName="SignInPage";export{C as default};
