import{i as I,k as P,m as w,V as S,R as b,l as r,a4 as j,j as o,C as L,B as C}from"./index-CEvnFZHP.js";const N={},k=()=>{const{login:h,currentUser:m}=I(),{t}=P(),d=w(),u=S(),f=void 0;b.useEffect(()=>{var e,c;if(m){const l=((c=(e=u.state)==null?void 0:e.from)==null?void 0:c.pathname)||"/dashboard";r.info("User already signed in, redirecting.","SignInPage",{from:l}),d(l,{replace:!0})}},[m,d,u.state]);const i=e=>{r.error("Google Login Failed.","SignInPage",{errorDetails:e})},g=j({onSuccess:async e=>{var c,l;if(r.info("Google Login Succeeded (token obtained).","SignInPage",{hasAccessToken:!!e.access_token}),e.access_token)try{const a=await fetch("https://www.googleapis.com/oauth2/v3/userinfo",{headers:{Authorization:`Bearer ${e.access_token}`}});if(!a.ok){const n=await a.json().catch(()=>({message:"Failed to parse error response from userinfo endpoint"}));r.error("Failed to fetch user info from Google.","SignInPage",{status:a.status,errorData:n}),i(n);return}const s=await a.json(),v=s.picture?s.picture.replace(/=s\d+-c$/,"=s256-c"):s.picture,p={id:s.sub,name:s.name,email:s.email,imageUrl:v};r.info("User info fetched successfully. Calling login context function.","SignInPage",{userId:p.id});try{const n=await h(p,e);if(n){r.info("Login completed successfully, redirecting...","SignInPage",{userId:n.id});const y=((l=(c=u.state)==null?void 0:c.from)==null?void 0:l.pathname)||"/dashboard";d(y,{replace:!0})}else r.error("Login returned null result","SignInPage"),i(new Error("Login failed - no user returned"))}catch(n){r.error("Login process failed","SignInPage",void 0,n),i(n)}}catch(a){r.error("Error during token validation, fetching user info, or login process.","SignInPage",void 0,a),i(a)}else r.error("Login success callback, but no access_token in tokenResponse.","SignInPage",{tokenResponse:e}),i(e)},onError:i,scope:"email profile https://www.googleapis.com/auth/drive.file"}),x=()=>{if(r.info("Custom Google Login button clicked.","SignInPage"),!f){r.warn("VITE_RECAPTCHA_SITE_KEY is not configured. Proceeding with login directly.","SignInPage"),g();return}if(typeof grecaptcha>"u"||typeof grecaptcha.enterprise>"u"||typeof grecaptcha.enterprise.ready!="function"){r.warn("reCAPTCHA enterprise.js not loaded or not ready. Proceeding with login directly.","SignInPage"),g();return}grecaptcha.enterprise.ready(async()=>{try{const e=await grecaptcha.enterprise.execute(f,{action:"LOGIN"});r.info("reCAPTCHA token obtained for LOGIN action.","SignInPage",{tokenPreview:e.slice(0,10)+"..."}),g()}catch(e){r.error("Lỗi khi thực thi reCAPTCHA (token generation):","SignInPage",void 0,e),g()}})};return o.jsx("div",{className:"flex flex-col items-center justify-center min-h-[calc(100vh-250px)] py-10 sm:py-16",children:o.jsxs(L,{className:"max-w-md w-full text-center shadow-2xl p-8 sm:p-10 md:p-12 !rounded-2xl",useGlassEffect:!0,children:[o.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-[var(--color-text-primary)] mb-4 mt-8 sm:mt-10",children:t("signInTitle")}),o.jsx("p",{className:"text-[var(--color-text-secondary)] mb-10 text-sm",children:t("signInSubtitle")}),o.jsx("div",{className:"flex justify-center mb-8",children:o.jsx(C,{onClick:x,variant:"subtle",size:"lg",leftIcon:o.jsx("img",{src:"https://img.icons8.com/color/48/google-logo.png",alt:"Google",className:"w-5 h-5"}),className:"w-full max-w-xs sm:w-[280px] !justify-start !text-[var(--color-text-primary)] hover:!bg-[var(--color-bg-surface-3)] !border-[var(--color-border-interactive)] hover:!border-[var(--color-border-strong)] !px-4 !py-3 !rounded-lg shadow-md",children:o.jsx("span",{className:"ml-3 text-sm font-medium",children:t("loginWithGoogle")})})}),o.jsxs("p",{className:"text-xs text-[var(--color-text-muted)]",children:[t("signInAgreementPrompt")," "," ",o.jsx("a",{href:"#",className:"text-[var(--color-primary-accent)] hover:underline font-medium",children:t("footerTerms")})," ",t("and")," "," ",o.jsx("a",{href:"#",className:"text-[var(--color-primary-accent)] hover:underline font-medium",children:t("footerPrivacy")}),"."]})]})})};k.displayName="SignInPage";export{k as default};
