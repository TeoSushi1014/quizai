import{j as e}from"./ui-BGuvgkTr.js";import{u as f,r as n}from"./router-BxjC687J.js";import{u as z,l as h,C as a,L as b,B as x,d as q}from"./index-Czoj4BS-.js";import{q as S}from"./quizResultsService-CAdqKwUF.js";import"./vendor-DoC2WAmd.js";import"./utils-rUpm7H1u.js";import"./markdown-Bj7tmv2T.js";const B=()=>{const{currentUser:r}=z(),c=f(),[s,v]=n.useState([]),[i,l]=n.useState(!0),[o,m]=n.useState(null);n.useEffect(()=>{if(!r){c("/");return}u()},[r,c]);const u=async()=>{if(r)try{l(!0),m(null);const t=await S.getUserQuizHistory(r.id,50);v(t),l(!1),h.info("User quiz history loaded","QuizHistoryPage",{userId:r.id,resultCount:t.length})}catch(t){h.error("Failed to load user quiz history","QuizHistoryPage",{},t),m("Failed to load your quiz history"),l(!1)}},g=t=>{if(!t)return"--:--";const d=Math.floor(t/60),N=t%60;return`${d}:${N.toString().padStart(2,"0")}`},j=t=>new Date(t).toLocaleDateString("vi-VN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),p=t=>t>=80?"text-[var(--color-success-accent)]":t>=60?"text-[var(--color-warning-accent)]":"text-[var(--color-danger-accent)]",y=t=>t>=80?"bg-[var(--color-success-accent)]/10 border-[var(--color-success-accent)]/30":t>=60?"bg-[var(--color-warning-accent)]/10 border-[var(--color-warning-accent)]/30":"bg-[var(--color-danger-accent)]/10 border-[var(--color-danger-accent)]/30";return r?e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-[var(--color-text-primary)] mb-2",children:"Your Quiz History"}),e.jsx("p",{className:"text-[var(--color-text-secondary)]",children:"View all your quiz attempts and track your progress"})]}),i&&e.jsx(a,{className:"p-8",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(b,{}),e.jsx("span",{className:"ml-3 text-[var(--color-text-secondary)]",children:"Loading your quiz history..."})]})}),o&&e.jsx(a,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-[var(--color-danger-accent)] mb-4",children:o}),e.jsx(x,{onClick:u,variant:"outline",size:"sm",children:"Try Again"})]})}),!i&&!o&&s.length===0&&e.jsx(a,{className:"p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx(q,{className:"w-16 h-16 mx-auto text-[var(--color-text-muted)] mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-[var(--color-text-primary)] mb-2",children:"No Quiz History Yet"}),e.jsx("p",{className:"text-[var(--color-text-secondary)] mb-4",children:"You haven't taken any quizzes yet. Start taking quizzes to see your progress here!"}),e.jsx(x,{onClick:()=>c("/"),variant:"primary",children:"Browse Quizzes"})]})}),!i&&!o&&s.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(a,{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-[var(--color-primary-accent)]",children:s.length}),e.jsx("div",{className:"text-sm text-[var(--color-text-secondary)]",children:"Total Attempts"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-[var(--color-success-accent)]",children:[s.length>0?Math.round(s.reduce((t,d)=>t+d.score,0)/s.length):0,"%"]}),e.jsx("div",{className:"text-sm text-[var(--color-text-secondary)]",children:"Average Score"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-[var(--color-warning-accent)]",children:[s.length>0?Math.max(...s.map(t=>t.score)):0,"%"]}),e.jsx("div",{className:"text-sm text-[var(--color-text-secondary)]",children:"Best Score"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-[var(--color-secondary-accent)]",children:new Set(s.map(t=>t.quiz_id)).size}),e.jsx("div",{className:"text-sm text-[var(--color-text-secondary)]",children:"Unique Quizzes"})]})]})}),e.jsxs(a,{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-[var(--color-text-primary)] mb-4",children:"Recent Attempts"}),e.jsx("div",{className:"space-y-3",children:s.map(t=>e.jsx("div",{className:`p-4 rounded-lg border-2 ${y(t.score)}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-[var(--color-text-primary)] mb-1",children:t.quiz_title||"Unknown Quiz"}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-[var(--color-text-secondary)]",children:[e.jsxs("span",{className:`font-bold ${p(t.score)}`,children:[t.score,"% (",Math.round(t.score/100*t.total_questions),"/",t.total_questions,")"]}),e.jsxs("span",{children:["Time: ",g(t.time_taken)]}),e.jsx("span",{children:j(t.created_at)})]})]}),e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>c(`/quiz/${t.quiz_id}`),children:"Take Again"})]})},t.id))})]})]})]}):null};export{B as default};
