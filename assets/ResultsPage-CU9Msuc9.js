import{h as F,i as k,A as G,k as M,r as g,j as e,E as V,m as a,X as j,B as n,C,n as x,p as U,J as q,N as O,O as J,Q as X,D as Y}from"./index-BiirWOEV.js";const H={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.4,ease:[.25,.1,.25,1]}}},T=({question:r,userAnswerText:p,isCorrect:o,index:h,sourceContentSnippet:t,explanationIconUrl:c,initiallyOpen:l})=>{const{t:s}=k();return e.jsx(a.div,{variants:H,children:e.jsx(X,{initiallyOpen:l,containerClassName:`!rounded-xl shadow-lg ${o?"!border-green-500/60":"!border-red-500/60"}`,title:e.jsxs("div",{className:"flex items-center w-full gap-3",children:[e.jsxs("span",{className:"text-xs text-[var(--color-text-muted)] font-semibold",children:["Q",h+1,"."]}),e.jsx("span",{className:`flex-grow text-sm sm:text-base ${o?"text-[var(--color-text-secondary)]":"text-[var(--color-text-primary)] font-semibold"} min-w-0 break-words`,title:r.questionText,children:e.jsx(x,{text:r.questionText})})]}),titleClassName:`py-3.5 px-4 sm:px-5 rounded-t-xl ${o?"hover:!bg-green-400/15":"hover:!bg-red-400/15"}`,contentClassName:"!bg-[var(--color-bg-surface-2)]/30",children:e.jsxs("div",{className:"space-y-4 text-sm sm:text-base",children:[e.jsxs("p",{className:"text-[var(--color-text-secondary)]",children:[e.jsxs("strong",{className:"font-semibold text-[var(--color-text-primary)]",children:[s("resultsYourAnswer")," "]}),e.jsx("span",{className:`${o?"text-green-400 font-medium":"text-red-400 font-medium"} break-words`,children:e.jsx(x,{text:p||s("resultsNotAnswered")})})]}),!o&&e.jsxs("p",{className:"text-[var(--color-text-secondary)]",children:[e.jsxs("strong",{className:"font-semibold text-[var(--color-text-primary)]",children:[s("resultsCorrectAnswerMC")," "]}),e.jsx("span",{className:"text-green-400 font-medium break-words",children:e.jsx(x,{text:r.correctAnswer})})]}),e.jsxs("div",{className:"mt-5 pt-5 border-t border-[var(--color-border-default)]",children:[e.jsxs("p",{className:"flex items-start text-base font-semibold text-[var(--color-primary-accent)] mb-2.5",children:[e.jsx("img",{src:c,alt:s("resultsExplanationTitle"),className:"w-5 h-5 mr-3 flex-shrink-0 mt-0.5"}),s("resultsExplanationTitle")]}),e.jsx("div",{className:"text-[var(--color-text-body)]/90 leading-relaxed whitespace-pre-wrap break-words",children:e.jsx(x,{text:r.explanation||s("resultsNoExplanation")})})]}),t&&e.jsxs("details",{className:"mt-5 pt-5 border-t border-[var(--color-border-default)]",children:[e.jsxs("summary",{className:"text-xs text-[var(--color-text-muted)] cursor-pointer hover:text-[var(--color-primary-accent)] flex items-center font-semibold group transition-colors var(--duration-fast) var(--ease-ios)",children:[" ",e.jsx(Y,{className:"w-4 h-4 mr-2.5 text-[var(--color-text-muted)] group-hover:text-[var(--color-primary-accent)] transition-colors var(--duration-fast) var(--ease-ios)",strokeWidth:2})," ",s("resultsViewSourceSnippet")," "]}),e.jsx("blockquote",{className:"mt-3 text-xs text-[var(--color-text-muted)]/80 max-h-36 overflow-y-auto p-3.5 bg-[var(--color-bg-surface-2)]/60 border border-[var(--color-border-default)] rounded-lg shadow-inner italic",children:e.jsx(x,{text:t})})]})]})})})};T.displayName="QuestionResultItem";const K={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1,duration:.3,ease:[.25,.1,.25,1]}}},u={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.4,ease:[.25,.1,.25,1]}}},W={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.075}}},Z=()=>{const{quizResult:r,isLoading:p,getQuizByIdFromAll:o,setActiveQuiz:h}=F(),{t}=k(),{quizId:c}=G(),l=M(),[s,f]=g.useState(null),[A,m]=g.useState(!0),[N,v]=g.useState(null);if(g.useEffect(()=>{if(m(!0),v(null),p)return;if(!r){console.warn(`ResultsPage: App context loaded, but quizResult is null. Param quizId from URL: ${c}.`),v(t("resultsErrorNotFound",{quizId:c||"unknown"})),f(null),m(!1);return}if(!r.quizId){console.error("ResultsPage: quizResult object exists but quizResult.quizId is missing. Invalid state."),v(t("resultsErrorNotFound",{quizId:"unknown"})),f(null),m(!1);return}const i=o(r.quizId);i?(f(i),h(i),m(!1)):(console.error(`ResultsPage: Quiz ${r.quizId} not found in fully loaded quizzes list.`),v(t("resultsErrorNotFound",{quizId:r.quizId})),f(null),m(!1))},[r,o,h,c,p,t]),A)return e.jsx("div",{className:"flex flex-col items-center justify-center min-h-[calc(100vh-380px)] text-center p-5",children:e.jsx(V,{text:t("resultsLoading"),className:"mb-10",size:"xl"})});if(N)return e.jsxs(a.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,ease:[.25,.1,.25,1]},className:"flex flex-col items-center justify-center min-h-[calc(100vh-380px)] text-center p-5",children:[e.jsx(j,{className:"w-16 h-16 text-red-400/80 mb-6"}),e.jsx("p",{className:"text-xl font-semibold text-[var(--color-text-primary)] mb-3",children:t("error")}),e.jsx("p",{className:"text-base text-[var(--color-text-secondary)] mb-10 max-w-md",children:N}),e.jsxs(n,{onClick:()=>l("/dashboard"),variant:"secondary",size:"lg",className:"py-3 px-7 rounded-xl",children:[" ",t("resultsGoToDashboard")," "]})]});if(!r||!s)return console.error("ResultsPage: Reached render stage where quizResult or currentDisplayQuiz is unexpectedly null despite no explicit error state and not loading."),e.jsxs(a.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,ease:[.25,.1,.25,1]},className:"flex flex-col items-center justify-center min-h-[calc(100vh-380px)] text-center p-5",children:[e.jsx(j,{className:"w-16 h-16 text-red-400/80 mb-6"}),e.jsx("p",{className:"text-xl font-semibold text-[var(--color-text-primary)] mb-3",children:t("error")}),e.jsxs("p",{className:"text-base text-[var(--color-text-secondary)] mb-10 max-w-md",children:[t("resultsErrorNotFound",{quizId:c||"unknown"})," (Unexpected)"]}),e.jsxs(n,{onClick:()=>l("/dashboard"),variant:"secondary",size:"lg",className:"py-3.5 px-8 rounded-xl",children:[" ",t("resultsGoToDashboard")," "]})]});if(s.id!==r.quizId)return console.error("ResultsPage: Mismatch between currentDisplayQuiz.id and quizResult.quizId. This indicates a critical state inconsistency."),e.jsxs(a.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,ease:[.25,.1,.25,1]},className:"flex flex-col items-center justify-center min-h-[calc(100vh-380px)] text-center p-5",children:[e.jsx(j,{className:"w-16 h-16 text-red-400/80 mb-6"}),e.jsx("p",{className:"text-xl font-semibold text-red-400 mb-4",children:"Critical Error: Data Mismatch"}),e.jsxs("p",{className:"text-sm text-[var(--color-text-muted)]",children:["Displayed Quiz ID: ",s.id,", Result Quiz ID: ",r.quizId]}),e.jsxs(n,{onClick:()=>l("/dashboard"),variant:"secondary",size:"lg",className:"py-3.5 px-8 rounded-xl mt-6",children:[" ",t("resultsGoToDashboard")," "]})]});const{score:d,answers:R,totalCorrect:Q,totalQuestions:D,sourceMode:y}=r,E=(i,b)=>b?b.trim()===i.correctAnswer.trim():!1,S=d>=70?"text-green-400":d>=40?"text-amber-400":"text-red-400",P=d>=70?"bg-gradient-to-r from-green-400 to-emerald-400":d>=40?"bg-gradient-to-r from-amber-400 to-yellow-400":"bg-gradient-to-r from-red-400 to-rose-400",$="https://img.icons8.com/?size=256&id=eoxMN35Z6JKg&format=png",L=y==="practice"?t("practiceSummaryTitle",{quizTitle:s.title}):t("resultsTitle",{quizTitle:s.title});return e.jsx(a.div,{initial:"hidden",animate:"visible",variants:K,children:e.jsxs(C,{className:"max-w-4xl mx-auto shadow-2xl !rounded-2xl",useGlassEffect:!0,children:[e.jsx(a.h1,{variants:u,className:"text-3xl sm:text-4xl font-bold text-[var(--color-text-primary)] mb-4 text-center leading-tight tracking-tight line-clamp-2",title:s.title,children:e.jsx(x,{text:L})}),e.jsx(a.p,{variants:u,className:"text-base text-[var(--color-text-secondary)] mb-12 text-center",children:t(y==="practice"?"practiceSummarySubtitle":"resultsSubtitle")}),e.jsx(a.div,{variants:u,children:e.jsxs(C,{className:"mb-12 !bg-[var(--color-bg-surface-2)]/70 shadow-xl !border-[var(--color-border-default)] p-0 overflow-hidden !rounded-2xl",useGlassEffect:!1,children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-around items-center text-center gap-8 p-6 sm:p-10 !bg-[var(--color-bg-surface-1)]/60",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("p",{className:"text-sm text-[var(--color-text-muted)] uppercase tracking-wider font-medium mb-1.5",children:t("resultsYourScore")}),e.jsxs("p",{className:`text-6xl sm:text-7xl font-extrabold ${S} tracking-tight`,children:[d.toFixed(0),e.jsx("span",{className:"text-4xl",children:"%"})]})]}),e.jsx("div",{className:"w-full md:w-px h-px md:h-24 bg-[var(--color-border-default)] my-3 md:my-0"}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("p",{className:"text-sm text-[var(--color-text-muted)] uppercase tracking-wider font-medium mb-1.5",children:t("resultsCorrectAnswers")}),e.jsxs("p",{className:"text-5xl sm:text-6xl font-bold text-[var(--color-text-primary)]",children:[Q," ",e.jsxs("span",{className:"text-3xl text-[var(--color-text-muted)]/80",children:["/ ",D]})]})]})]}),e.jsx(U,{progress:d,className:"w-full rounded-b-2xl overflow-hidden",size:"lg",barClassName:`${P} !h-3.5`,showPercentage:!1})]})}),e.jsx(a.h2,{variants:u,className:"text-2xl sm:text-3xl font-semibold text-[var(--color-text-primary)] mb-8 sm:mb-10",children:t("resultsBreakdownTitle")}),e.jsx(a.div,{variants:W,initial:"hidden",animate:"visible",className:"space-y-5",children:Array.isArray(s.questions)&&s.questions.map((i,b)=>{const w=R.find(B=>B.questionId===i.id),z=w?w.answer:"",I=E(i,z);return e.jsx(T,{question:i,userAnswerText:z,isCorrect:I,index:b,sourceContentSnippet:s.sourceContentSnippet,explanationIconUrl:$,initiallyOpen:!I},i.id)})}),e.jsxs(a.div,{variants:u,className:"mt-14 flex flex-col sm:flex-row justify-center items-center gap-4 sm:gap-5",children:[y==="practice"?e.jsx(n,{onClick:()=>l(`/practice/${s.id}`),variant:"outline",size:"lg",leftIcon:e.jsx(q,{className:"w-5 h-5"}),className:"w-full sm:w-auto py-3 px-8 rounded-xl",children:t("practiceAgain")}):e.jsx(n,{onClick:()=>l(`/quiz/${s.id}`),variant:"outline",size:"lg",leftIcon:e.jsx(q,{className:"w-5 h-5"}),className:"w-full sm:w-auto py-3 px-8 rounded-xl",children:t("resultsTryAgain")}),e.jsx(n,{onClick:()=>l("/dashboard"),variant:"secondary",size:"lg",leftIcon:e.jsx(O,{className:"w-5 h-5"}),className:"w-full sm:w-auto py-3 px-8 rounded-xl",children:t("resultsBackToDashboard")}),e.jsx(n,{onClick:()=>l("/create"),variant:"primary",size:"lg",leftIcon:e.jsx(J,{className:"w-5 h-5"}),className:"w-full sm:w-auto bg-gradient-to-r from-[var(--color-primary-accent)] to-indigo-500 hover:from-[var(--color-primary-accent-hover)] hover:to-indigo-600 text-white shadow-xl py-3 px-8 rounded-xl",children:t("resultsCreateNewQuiz")})]})]})})};Z.displayName="ResultsPage";export{Z as default};
