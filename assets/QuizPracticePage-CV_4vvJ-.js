import{j as e}from"./ui-BGuvgkTr.js";import{f as te,u as re,r as d}from"./router-BxjC687J.js";import{c as E,P as se,M as A,B as k,u as ie,K as ne,l as R,L as q,C as ae,e as oe,j as le,k as ce}from"./index-D1WZoZJd.js";import{u as de}from"./useQuizFlow-CufgfQ6P.js";import"./vendor-DoC2WAmd.js";import"./utils-rUpm7H1u.js";import"./markdown-Bj7tmv2T.js";const V=({question:n,options:P,currentIndex:p,totalQuestions:C,selectedOption:j,onSelectOption:a,onCheckAnswer:S,onSkipQuestion:o,isSubmitting:w,isAnswerChecked:h=!1,isAnswerCorrect:N=null,correctAnswer:g=""})=>{const{t:x}=E(),T=C>0?(p+1)/C*100:0;return e.jsxs("div",{className:"quiz-question-container",children:[e.jsxs("div",{className:"quiz-progress",children:[e.jsx("div",{className:"flex justify-between items-center mb-1.5",children:e.jsx("span",{className:"text-sm font-medium text-[var(--color-text-primary)]",children:x("quizTakingQuestionProgress",{current:p+1,total:C})})}),e.jsx(se,{progress:T,size:"md",className:"mb-5"})]}),e.jsx("div",{className:"question-content mb-4",children:e.jsx(A,{text:n,markdownFormatting:!0})}),e.jsxs("div",{className:"space-y-3",children:[" ",P.map((y,u)=>{const m=j===y,l=g===y;let b="",i="",r="";return h?m&&N?(b="answer-option-correct bg-green-100 dark:bg-green-900/30 border-green-500 text-green-700 dark:text-green-300 font-semibold scale-[1.01]",i="border-green-500 bg-green-500",r="correct-answer-pulse"):m&&!N?(b="answer-option-incorrect bg-red-100 dark:bg-red-900/30 border-red-500 text-red-700 dark:text-red-300 font-semibold scale-[1.01]",i="border-red-500 bg-red-500",r="incorrect-answer-pulse"):l?(b="answer-option-correct bg-green-100 dark:bg-green-900/30 border-green-500 text-green-700 dark:text-green-300 font-semibold",i="border-green-500 bg-green-500"):(b="bg-[var(--color-bg-surface-3)]/70 border-[var(--color-border-interactive)] text-[var(--color-text-secondary)]",i="border-[var(--color-text-muted)] bg-[var(--color-bg-surface-2)]"):(b=m?"bg-[var(--color-primary-accent)]/50 border-[var(--color-primary-accent)] text-[var(--color-primary-accent-text)] font-semibold scale-[1.01]":"bg-[var(--color-bg-surface-3)]/70 hover:bg-[var(--color-bg-surface-3)]/40 border-[var(--color-border-interactive)] hover:border-[var(--color-primary-accent)] text-[var(--color-text-primary)]",i=m?"border-[var(--color-primary-accent-text)] bg-[var(--color-primary-accent)]":"border-[var(--color-text-muted)] bg-[var(--color-bg-surface-2)] group-hover:border-[var(--color-primary-accent)]"),e.jsxs("button",{type:"button",className:`w-full flex items-center text-left p-3.5 sm:p-4 rounded-xl border-2 focus:outline-none focus-visible:ring-4 focus-visible:ring-[var(--color-primary-accent)]/50 focus-visible:ring-offset-2 shadow-lg 
                          transition-all var(--duration-fast) var(--ease-ios) will-change-transform, border, background-color
                          ${b} ${r}`,onClick:()=>a(y),disabled:w||h,"aria-pressed":m,"aria-checked":h&&l?"true":"false",children:[e.jsx("span",{className:`option-indicator mr-3.5 flex-shrink-0 w-6 h-6 rounded-full border-2 flex items-center justify-center ${i}`,children:(m||h&&l)&&e.jsx("div",{className:"w-3 h-3 bg-white rounded-full"})}),e.jsx("div",{className:"option-content flex-grow text-sm sm:text-base flex items-center",children:e.jsx(A,{text:y,markdownFormatting:!0,compact:!0,stripPrefix:!0})}),h&&e.jsx("span",{className:"ml-2",children:l?e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-green-500",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}):m&&!N?e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-red-500",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}):null})]},u)})]}),e.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-center mt-5 pt-5 border-t border-[var(--color-border-default)] gap-3",children:h?e.jsx("div",{className:"w-full flex justify-end items-center"}):e.jsxs(e.Fragment,{children:[e.jsx(k,{variant:"subtle",onClick:o,disabled:w,className:"w-full sm:w-auto",children:x("skipQuestion")}),e.jsx(k,{variant:"primary",onClick:S,disabled:w||!j,className:"w-full sm:w-auto",children:x(w?"loading":"checkAnswer")})]})})]})};V.displayName="PracticeQuizQuestion";const H=({explanation:n,className:P=""})=>{const{t:p}=E();return e.jsxs("div",{className:`animate-fadeInUp mt-5 p-5 rounded-lg bg-[var(--color-bg-surface-2)]/50 border border-[var(--color-border-default)] shadow-md ${P}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-[var(--color-primary-accent)]",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2h-1V9a1 1 0 00-1-1z",clipRule:"evenodd"})}),e.jsx("span",{className:"font-semibold text-[var(--color-primary-accent)] text-base",children:p("resultsExplanationTitle")})]}),e.jsx("div",{className:"explanation-content",children:e.jsx("div",{className:"pl-1.5 border-l-2 border-[var(--color-primary-accent)]/20",children:e.jsx("div",{className:"explanation-text text-sm leading-relaxed text-[var(--color-text-body)] markdown-content",children:e.jsx(A,{text:n,markdownFormatting:!0})})})})]})};H.displayName="PracticeQuizExplanation";const ue=()=>{const{t:n}=E(),{quizId:P}=te(),p=re(),{setQuizResult:C,currentUser:j}=ie(),[a,S]=d.useState(null),[o,w]=d.useState(!1),[h,N]=d.useState(null),[g,x]=d.useState([]),[T,y]=d.useState(!1),[u,m]=d.useState(!1),l=d.useRef(!1),b=d.useCallback(()=>{l.current||y(!0)},[]),{localActiveQuiz:i,currentQuestion:r,currentQuestionIndex:Q,loading:U,timeLeft:I,elapsedTime:B,goToNextQuestion:O,goToPreviousQuestion:$,formatTime:D,totalQuestions:L,shuffledQuestions:M,attemptSettings:J}=de(P,b);d.useEffect(()=>{M.length>0&&g.length===0&&x(M.map(s=>({questionId:s.id,selectedOption:null,isCorrect:null,firstTryCorrect:null,attempts:0})))},[M,g.length]),d.useEffect(()=>{if(l.current)return;let s=null,t=!1,f=null;if(r&&g.length>0){const z=g.find(F=>F.questionId===r.id);z&&(s=z.selectedOption,z.isCorrect!==null&&(t=!0,f=z.isCorrect))}S(s),w(t),N(f),m(!1)},[Q,r,g]);const v=d.useCallback(async()=>{if(l.current||!i)return;l.current=!0,m(!0);let s=[...g];r&&a&&!o?s=s.map(c=>c.questionId===r.id?{...c,selectedOption:a,isCorrect:null,attempts:c.attempts||0}:c):r&&!a&&!o&&(s=s.map(c=>c.questionId===r.id?{...c,selectedOption:null,isCorrect:null}:c));const t=s.filter(c=>c.isCorrect===!0).length,f=s.map(c=>({questionId:c.questionId,answer:c.selectedOption||""})),z=i.questions.length>0?t/i.questions.length*100:0,F={quizId:i.id,score:parseFloat(z.toFixed(2)),answers:f,totalCorrect:t,totalQuestions:i.questions.length,timeTaken:B,sourceMode:"practice",createdAt:new Date().toISOString()};if(C(F),j)try{await ne.saveQuizResult(F,j.id,j)?R.info("Practice result saved to database successfully","QuizPracticePage"):R.info("Practice result not saved to database (user not authenticated with Supabase, using local storage only)","QuizPracticePage")}catch(c){console.error("Failed to save practice result to database:",c)}else R.info("No user logged in, practice result saved locally only","QuizPracticePage");p(`/results/${i.id}`)},[i,g,r,a,o,C,J.timeLimit,I,p,j]),W=s=>{o||l.current||u||S(s)},X=()=>{if(!a||!r||l.current||u)return;m(!0);const s=a===r.correctAnswer;w(!0),N(s),x(t=>t.map(f=>f.questionId===r.id?{...f,selectedOption:a,isCorrect:s,attempts:(f.attempts||0)+1,...(f.attempts||0)===0&&{firstTryCorrect:s}}:f))},Y=d.useCallback(()=>{!i||!r||l.current||u||(m(!0),a&&!o?x(s=>s.map(t=>t.questionId===r.id&&(t.selectedOption!==a||t.isCorrect===null)?{...t,selectedOption:a,isCorrect:t.isCorrect,attempts:t.attempts||0}:t)):!a&&!o&&x(s=>s.map(t=>t.questionId===r.id&&t.selectedOption!==null&&t.isCorrect===null?{...t,selectedOption:null}:t)),O()||v())},[i,r,O,v,a,o,u]),Z=d.useCallback(()=>{!i||!r||l.current||u||(m(!0),O()||v())},[i,r,O,v,u]),_=d.useCallback(()=>{!r||l.current||u||(m(!0),a&&!o?x(s=>s.map(t=>t.questionId===r.id&&(t.selectedOption!==a||t.isCorrect===null)?{...t,selectedOption:a,isCorrect:t.isCorrect,attempts:t.attempts||0}:t)):!a&&!o&&x(s=>s.map(t=>t.questionId===r.id&&t.selectedOption!==null&&t.isCorrect===null?{...t,selectedOption:null}:t)),$())},[$,a,o,r,u]),G=d.useCallback(()=>{v()},[v]),ee=()=>r?e.jsxs("div",{className:"space-y-4",children:[e.jsx(V,{question:r.questionText,options:r.options,currentIndex:Q,totalQuestions:L,selectedOption:a,onSelectOption:W,onCheckAnswer:X,onSkipQuestion:Z,isSubmitting:u,isAnswerChecked:o,isAnswerCorrect:h,correctAnswer:r.correctAnswer}),o&&e.jsx(H,{explanation:r.explanation||n("resultsNoExplanation")})]}):null;if(u&&l.current)return e.jsx("div",{className:"flex flex-col items-center justify-center p-8 min-h-[400px]",children:e.jsx(q,{text:n("quizPracticeEnding")||"Processing...",size:"lg"})});if(U||!i)return e.jsx(q,{text:n("quizTakingLoading"),className:"mt-24",size:"xl"});if(!r)return i&&L>0&&Q>=L?(l.current||v(),e.jsx("div",{className:"flex flex-col items-center justify-center p-8 min-h-[400px]",children:e.jsx(q,{text:n("quizPracticeEnding")||"Completing practice...",size:"lg"})})):U?e.jsx(q,{text:n("quizTakingLoading"),className:"mt-24",size:"xl"}):(console.error("QuizPracticePage: currentQuestion is undefined, but not due to finishing. Quiz data might be missing or an error occurred."),e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 min-h-[400px]",children:[e.jsx(q,{text:n("error")+" - "+(n("quizTakingLoading")||"Processing..."),size:"lg"}),e.jsx(k,{onClick:()=>p("/dashboard"),className:"mt-4",children:n("resultsGoToDashboard")})]}));const K=Q===L-1;return e.jsxs(ae,{className:"max-w-2xl mx-auto shadow-2xl !rounded-2xl animate-page-slide-fade-in p-5 sm:p-6",useGlassEffect:!0,children:[e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-[var(--color-text-primary)] mb-3 leading-tight tracking-tight line-clamp-2",title:i.title,children:n("quizPracticeTitle",{quizTitle:i.title})}),e.jsxs("div",{className:"flex justify-between items-center text-xs text-[var(--color-text-secondary)] mb-2",children:[e.jsxs("span",{className:"font-semibold text-[var(--color-text-muted)]",children:["Time: ",D(B)]}),I!==null&&e.jsx("span",{className:`font-semibold ${I<=60?"text-red-400 animate-pulse":"text-[var(--color-primary-accent)]"}`,children:n("quizTakingTimeLeft",{time:D(I)})})]})]}),ee(),e.jsxs("div",{className:"quiz-navigation-actions mt-6 pt-6 border-t border-[var(--color-border-default)] flex flex-col sm:flex-row sm:justify-between gap-3",children:[e.jsx(k,{variant:"secondary",onClick:_,disabled:u||Q===0,size:"md",leftIcon:e.jsx(oe,{className:"w-4 h-4"}),className:"w-full sm:w-auto",children:n("previous")}),e.jsx(k,{variant:K&&o?"primary":"secondary",onClick:o?Y:v,disabled:u,size:"md",rightIcon:e.jsx(le,{className:"w-4 h-4"}),className:"w-full sm:w-auto",children:n(o?K?"finishPractice":"nextQuestion":"finishPractice")})]}),T&&e.jsx(ce,{isOpen:T&&!l.current,onClose:G,title:n("timesUp"),size:"md",hideCloseButton:!0,footerContent:e.jsx("div",{className:"flex justify-center",children:e.jsx(k,{variant:"primary",onClick:G,size:"md",children:n("timesUpSubmit")})}),children:e.jsx("p",{className:"text-[var(--color-text-body)] text-base leading-relaxed text-center",children:n("timesUpMessage")})})]})};ue.displayName="QuizPracticePage";export{ue as default};
