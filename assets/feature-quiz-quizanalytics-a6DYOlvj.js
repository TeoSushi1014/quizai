import{r as e,j as s}from"./core-react-DcE6uGcR.js";import{u as t,L as r,C as a,B as o,r as l,U as i}from"./app-components-CFPFxe5x.js";import{l as d,c}from"./services-BHj8px4z.js";import{a as n}from"./service-supabase-wASzC9XA.js";import{d as m,a as x}from"./router-Dk7yDelZ.js";import"./katex-core-BbYO2yyT.js";import"./katex-extras-AZS8NW-4.js";import"./google-services-Bc_loC93.js";/* empty css                        */import"./feature-quiz-home-Ch5jepSG.js";import"./feature-quiz-components-CChsAlA6.js";import"./ui-framework-CdNWeEQR.js";import"./feature-quiz-dashboard-C8yrEGC7.js";import"./markdown-processors-D3jN8hOQ.js";import"./react-markdown-Cej2CoYR.js";import"./feature-quiz-sharedquiz-Clu9xfzS.js";import"./feature-quiz-2SquOiTn.js";import"./util-storage-UFVse9kk.js";import"./util-document-Dv5rbOR1.js";import"./util-pdf-CkIVnOzu.js";const u=()=>{const{quizId:u}=m(),{currentUser:h}=t(),p=x(),[j,v]=e.useState(null),[y,f]=e.useState([]),[N,b]=e.useState({totalAttempts:0,averageScore:0,bestScore:0,averageTime:0,uniqueUsers:0}),[g,z]=e.useState(!0),[w,q]=e.useState(null);e.useEffect(()=>{h&&u?k():p("/")},[h,u,p]);const k=async()=>{if(u&&h)try{z(!0),d.info("Loading quiz analytics","QuizAnalyticsPage",{quizId:u});const e=await n.getQuizById(u);if(!e)return void q("Quiz not found or you do not have permission to view it");v(e);const s=await c.getQuizStats(u);b(s);const t=e.userId===h.id;d.info("Loading quiz history with ownership check","QuizAnalyticsPage",{quizId:u,isOwner:t,quizOwnerId:e.userId,currentUserId:h.id,userIdFilter:t?void 0:h.id});const r=await c.getQuizHistory({quizId:u,userId:t?void 0:h.id,limit:50});d.info("Quiz history results","QuizAnalyticsPage",{quizId:u,resultsCount:r.length,results:r.map(e=>({id:e.id,userId:e.user_id,userName:e.user_name,score:e.score}))}),f(r),d.info("Quiz analytics loaded successfully","QuizAnalyticsPage",{quizId:u,resultsCount:r.length})}catch(e){d.error("Failed to load quiz analytics","QuizAnalyticsPage",{},e),q("Failed to load quiz analytics")}finally{z(!1)}};return h&&u?g?s.jsx("div",{className:"flex justify-center items-center min-h-[calc(100vh-200px)]",children:s.jsx(r,{size:"xl",text:"Loading analytics..."})}):w?s.jsx("div",{className:"container mx-auto px-4 py-8",children:s.jsxs(a,{className:"max-w-md mx-auto p-8 text-center",children:[s.jsx("p",{className:"text-red-600 mb-4",children:w}),s.jsx(o,{onClick:()=>p("/dashboard"),children:"Back to Dashboard"})]})}):s.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-6xl",children:[s.jsxs("div",{className:"mb-8",children:[s.jsx(o,{variant:"outline",onClick:()=>p("/dashboard"),leftIcon:s.jsx(l,{className:"w-4 h-4"}),className:"mb-4",children:"Back to Dashboard"}),s.jsx("h1",{className:"text-3xl font-bold text-[var(--color-text-primary)] mb-2",children:"Quiz Analytics"}),j&&s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl text-[var(--color-text-secondary)] mb-2",children:j.title}),s.jsx("p",{className:"text-sm text-[var(--color-text-muted)]",children:j.userId===(null==h?void 0:h.id)?"Showing all attempts from everyone who took this quiz":"Showing your attempts only"})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[s.jsxs(a,{className:"p-6 rounded-xl border-2 border-[var(--color-border-default)] text-center shadow-md",children:[s.jsx("div",{className:"text-2xl font-bold text-[var(--color-primary-accent)]",children:N.totalAttempts}),s.jsx("div",{className:"text-sm text-[var(--color-text-secondary)]",children:"Total Attempts"})]}),s.jsxs(a,{className:"p-6 rounded-xl border-2 border-[var(--color-border-default)] text-center shadow-md",children:[s.jsx("div",{className:"text-2xl font-bold text-[var(--color-primary-accent)]",children:N.uniqueUsers}),s.jsx("div",{className:"text-sm text-[var(--color-text-secondary)]",children:"Unique Users"})]}),s.jsxs(a,{className:"p-6 rounded-xl border-2 border-[var(--color-border-default)] text-center shadow-md",children:[s.jsxs("div",{className:"text-2xl font-bold text-[var(--color-primary-accent)]",children:[N.averageScore,"%"]}),s.jsx("div",{className:"text-sm text-[var(--color-text-secondary)]",children:"Average Score"})]}),s.jsxs(a,{className:"p-6 rounded-xl border-2 border-[var(--color-border-default)] text-center shadow-md",children:[s.jsxs("div",{className:"text-2xl font-bold text-[var(--color-primary-accent)]",children:[N.bestScore,"%"]}),s.jsx("div",{className:"text-sm text-[var(--color-text-secondary)]",children:"Best Score"})]})]}),s.jsxs(a,{className:"p-6",children:[s.jsx("h3",{className:"text-xl font-semibold mb-6",children:"Detailed Results"}),0===y.length?s.jsx("div",{className:"text-center py-8",children:s.jsx("p",{className:"text-[var(--color-text-muted)]",children:"No attempts yet. Share your quiz to get started!"})}):s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b border-[var(--color-border-default)]",children:[s.jsx("th",{className:"text-left py-3 px-2",children:"User"}),s.jsx("th",{className:"text-left py-3 px-2",children:"Score"}),s.jsx("th",{className:"text-left py-3 px-2",children:"Time Taken"}),s.jsx("th",{className:"text-left py-3 px-2",children:"Date"})]})}),s.jsx("tbody",{children:y.map(e=>{return s.jsxs("tr",{className:"border-b border-[var(--color-border-default)] hover:bg-[var(--color-bg-surface-2)]",children:[s.jsx("td",{className:"py-3 px-2",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(i,{user:{id:e.user_id,name:e.user_name,email:e.user_email,imageUrl:e.user_image_url||null},size:"sm"}),s.jsxs("div",{children:[s.jsx("div",{className:"font-medium",children:e.user_name||"Anonymous User"}),e.user_email&&s.jsx("div",{className:"text-sm text-[var(--color-text-muted)]",children:e.user_email})]})]})}),s.jsxs("td",{className:"py-3 px-2",children:[s.jsxs("span",{className:"font-semibold "+(r=e.score,r>=80?"text-green-600 dark:text-green-400":r>=60?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400"),children:[e.score,"%"]}),s.jsxs("div",{className:"text-sm text-[var(--color-text-muted)]",children:[Math.round(e.score/100*e.total_questions),"/",e.total_questions]})]}),s.jsx("td",{className:"py-3 px-2",children:(t=e.time_taken,"number"!=typeof t||t<0?"N/A":`${Math.floor(t/60)}m ${Math.round(t%60)}s`)}),s.jsxs("td",{className:"py-3 px-2",children:[s.jsx("div",{className:"text-sm",children:new Date(e.created_at).toLocaleDateString()}),s.jsx("div",{className:"text-xs text-[var(--color-text-muted)]",children:new Date(e.created_at).toLocaleTimeString()})]})]},e.id);var t,r})})]})})]})]}):null};export{u as default};
