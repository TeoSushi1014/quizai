import{F as ee,b as te,a as F,u as se,r as b,c as ne,w as oe,j as t,L as ae,C as T,B as y,z as ie,H as re,J as le,N as ce,I as de,e as ue,f as B,D as R,T as $,P as xe,s as U,M as me,t as pe,O as fe}from"./index-DcfiZvdk.js";import{m as he}from"./proxy-CsBFvnED.js";const D=s=>{if(!s)return"NB";switch(s){case"Easy":return"NB";case"Medium":return"TH";case"Hard":return"VD";case"AI-Determined":return"NB";default:return"NB"}},k=s=>String.fromCharCode(65+s),L=(s,u,e,l,p=!1)=>{const m=s.questionText;let x=l;const i=m.match(/\(?\[?([A-Z]{2,3})[\]\)]?\.?\s/i);i&&i[1]&&(x=i[1].toUpperCase());let a=`${e("azotaFormatQuestionPrefix")} ${u}.(${x}) ${m}
`;return s.options.forEach((w,c)=>{const N=w===s.correctAnswer;a+=`${p&&N?"*":""}${k(c)}. ${w}	`,(c+1)%2===0&&c<s.options.length-1&&s.options.length>2?a=a.trimEnd()+`
`:a=a.trimEnd()+"  "}),a=a.trim()+`
`,a},G=(s,u,e,l,p=!1)=>{var w,c;const m=s.explanation.split("Cách giải:"),x=((w=m[0])==null?void 0:w.replace("Phương pháp:","").trim())||"",i=((c=m[1])==null?void 0:c.trim())||(x?"":s.explanation.trim());let a=`${e("azotaFormatQuestionPrefix")} ${u} (${l}):
`;if(x&&(a+=`${e("azotaFormatExplanationMethod")} ${x}
`),a+=`${e("azotaFormatExplanationSolution")} ${i||e("resultsNoExplanation")}
`,p){const N=s.options.findIndex(z=>z===s.correctAnswer);N!==-1&&(a+=`${e("azotaFormatChooseAnswer")} ${k(N)}
`)}return a},ge=(s,u)=>{var i;let e="";const l=D((i=s.config)==null?void 0:i.difficulty);let p=1;s.questions.length>0&&(e+=`${u("azotaFormatMCQSection")}
`,s.questions.forEach(a=>{e+=L(a,p++,u,l),e+=`
`})),e+=`${u("azotaFormatEndOfQuiz")}
`,e+=`${u("azotaFormatAnswerTableTitle")}
`;let m=1;s.questions.forEach(a=>{const w=a.options.findIndex(c=>c===a.correctAnswer);w!==-1&&(e+=`${m++}${k(w)} `)}),e=e.trim()+`

`,e+=`${u("azotaFormatExplanationSectionTitle")}
`;let x=1;return s.questions.forEach(a=>{var w;e+=G(a,x++,u,D((w=s.config)==null?void 0:w.difficulty)),e+=`
`}),e},we=(s,u)=>{var m;let e="";const l=D((m=s.config)==null?void 0:m.difficulty);let p=1;return s.questions.length>0&&(e+=`${u("azotaFormatMCQSection")}
`,s.questions.forEach(x=>{e+=L(x,p,u,l),e+=`${u("azotaFormatExplanationTitle")}
`,e+=G(x,p,u,l,!0),e+=`
`,p++})),e},ve=(s,u)=>{var m;let e="";const l=D((m=s.config)==null?void 0:m.difficulty);let p=1;return s.questions.length>0&&(e+=`${u("azotaFormatMCQSection")}
`,s.questions.forEach(x=>{e+=L(x,p++,u,l,!0),e+=`
`})),e},be=({isOpen:s,onClose:u,quiz:e})=>{const{t:l}=F(),[p,m]=b.useState("style1"),[x,i]=b.useState(""),[a,w]=b.useState(!1),[c,N]=b.useState(null);b.useEffect(()=>{if(s&&e){N(null);try{let f="";switch(p){case"style1":f=ge(e,l);break;case"style2":f=we(e,l);break;case"style4":f=ve(e,l);break;default:f=l("azotaExportErrorGenerating")}i(f)}catch(f){console.error("Error formatting quiz for Azota:",f),i(l("azotaExportErrorGenerating")),N(f instanceof Error?f.message:String(f))}}},[s,e,p,l]);const z=()=>{navigator.clipboard.writeText(x).then(()=>{w(!0),setTimeout(()=>w(!1),2e3)}).catch(f=>{console.error("Failed to copy text: ",f),alert(l("azotaExportErrorCopy"))})},h=()=>{const f=new Blob([x],{type:"text/plain;charset=utf-8"}),C=document.createElement("a");C.href=URL.createObjectURL(f);const Q=e.title.replace(/[^a-z0-9_.-]/gi,"_").substring(0,50)||"quiz";C.download=`${Q}_Azota_${p}.txt`,document.body.appendChild(C),C.click(),document.body.removeChild(C)},v=[{value:"style1",label:l("azotaExportFormatStyle1")},{value:"style2",label:l("azotaExportFormatStyle2")},{value:"style4",label:l("azotaExportFormatStyle4")}];return e?t.jsx(me,{isOpen:s,onClose:u,title:l("azotaExportTitle"),size:"3xl",children:t.jsxs("div",{className:"space-y-6",children:[t.jsx(U,{label:l("azotaExportSelectFormat"),options:v,value:p,onChange:f=>m(f.target.value)}),c&&t.jsxs("div",{role:"alert",className:"p-3 bg-red-500/20 border border-red-500/50 rounded-lg text-xs text-red-300",children:[t.jsxs("p",{children:[t.jsxs("strong",{children:[l("error"),":"]})," ",l("azotaExportErrorGenerating")]}),t.jsx("p",{className:"mt-1 text-red-400/80",children:c})]}),t.jsx($,{value:x,readOnly:!0,rows:18,className:"text-xs font-mono !bg-slate-700/70 !border-slate-600 p-4 min-h-[360px] shadow-inner","aria-label":l("azotaExportPreviewArea")}),t.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-3.5 pt-2",children:[t.jsx(y,{variant:"secondary",onClick:u,size:"md",children:l("close")}),t.jsxs(y,{variant:"outline",onClick:z,leftIcon:t.jsx(pe,{className:"w-4 h-4"}),size:"md",className:"w-full sm:w-auto",disabled:!!c,children:[" ",l(a?"azotaExportCopied":"azotaExportCopy")," "]}),t.jsxs(y,{variant:"primary",onClick:h,leftIcon:t.jsx(fe,{className:"w-4 h-4"}),size:"md",className:"w-full sm:w-auto",disabled:!!c,children:[" ",l("azotaExportDownload")," "]})]})]})}):null},je=()=>{const s=ee(),u=te(),{t:e}=F(),{addQuiz:l,updateQuiz:p,quizzes:m,language:x}=se(),[i,a]=b.useState(null),[w,c]=b.useState(!0),[N,z]=b.useState(!1),[h,v]=b.useState(null),[f,C]=b.useState(!1),[Q,M]=b.useState(null),P=b.useRef(null),J=ne(P,{threshold:.2,freezeOnceVisible:!0}),{quizId:E}=oe();b.useEffect(()=>{var d;let n=null;s.state&&(n=s.state);const r=E||((d=n==null?void 0:n.existingQuiz)==null?void 0:d.id);if(r&&!(n!=null&&n.existingQuiz)){const o=m.find(g=>g.id===r);if(o)n={...n,existingQuiz:o};else{v(e("reviewErrorQuizNotFound")),c(!1);return}}if(n!=null&&n.existingQuiz){const o=n.existingQuiz;a({title:o.title,questions:JSON.parse(JSON.stringify(o.questions)),config:o.config||{numQuestions:o.questions.length,difficulty:"Medium",language:x==="vi"?"Vietnamese":"English",customUserPrompt:"",selectedModel:"gemini"},sourceContentSnippet:o.sourceContentSnippet})}else if(n!=null&&n.generatedQuizData&&n.finalConfig){const{generatedQuizData:o,quizTitleSuggestion:g,finalConfig:S}=n;a({title:g||o.title,questions:JSON.parse(JSON.stringify(o.questions)),config:S,sourceContentSnippet:o.sourceContentSnippet})}else E||v(e("reviewErrorNoQuizData"));c(!1)},[s.state,E,m,e,x]),b.useEffect(()=>{if(Q){const n=`option-input-${Q.questionId}-${Q.optionIndex}`,r=document.getElementById(n);r==null||r.focus(),M(null)}},[Q]);const V=(n,r,d)=>{a(o=>o?{...o,questions:o.questions.map(g=>g.id===n?{...g,[r]:d}:g)}:null)},_=(n,r,d)=>{a(o=>o?{...o,questions:o.questions.map(g=>{if(g.id===n){const S=g.options[r],j=[...g.options];j[r]=d;let A=g.correctAnswer;return g.correctAnswer===S?A=d:!j.includes(g.correctAnswer)&&j.length>0?A=j[0]:j.length===0&&(A=""),{...g,options:j,correctAnswer:A}}return g})}:null)},H=n=>{let r=-1;a(d=>d?{...d,questions:d.questions.map(o=>o.id===n?(r=o.options.length,{...o,options:[...o.options,e("reviewNewOptionDefault",{index:r+1})]}):o)}:null),r!==-1&&M({questionId:n,optionIndex:r})},K=(n,r)=>{a(d=>d?{...d,questions:d.questions.map(o=>{if(o.id===n){if(o.options.length<=2)return alert(e("reviewErrorNotEnoughOptions",{id:""}).replace(" for question ID: {id}","")),o;const g=o.options[r],S=o.options.filter((A,q)=>q!==r);let j=o.correctAnswer;return g===o.correctAnswer&&!S.includes(g)&&(j=S.length>0?S[0]:""),{...o,options:S,correctAnswer:j}}return o})}:null)},Z=n=>{a(r=>r?r.questions.length===1?(v(e("reviewCannotSaveNoQuestions")),r):{...r,questions:r.questions.filter(d=>d.id!==n)}:null)},W=()=>{a(n=>n?{...n,questions:[...n.questions,{id:`manual-q-${Date.now()}`,questionText:e("reviewNewQuestionDefaultText"),options:[e("reviewNewOptionDefault",{index:1}),e("reviewNewOptionDefault",{index:2})],correctAnswer:e("reviewNewOptionDefault",{index:1}),explanation:e("reviewNewExplanationDefaultText")}]}:null)},X=()=>{var r;if(!i||i.questions.length===0){v(e("reviewCannotSaveNoQuestions"));return}for(const d of i.questions){if(!d.questionText.trim()){v(e("reviewErrorEmptyQuestionText",{id:d.id.substring(0,8)}));return}if(d.options.length<2){v(e("reviewErrorNotEnoughOptions",{id:d.id.substring(0,8)}));return}if(!d.correctAnswer||!d.options.includes(d.correctAnswer)){v(e("reviewErrorInvalidCorrectAnswer",{id:d.id.substring(0,8)}));return}if(!d.explanation.trim()){v(e("reviewErrorEmptyExplanation",{id:d.id.substring(0,8)}));return}}v(null),z(!0);const n={id:E||`quiz-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,title:i.title.trim()||e("untitledQuiz"),questions:i.questions,createdAt:E?((r=m.find(d=>d.id===E))==null?void 0:r.createdAt)||new Date().toISOString():new Date().toISOString(),sourceContentSnippet:i.sourceContentSnippet,config:i.config};setTimeout(()=>{E?p(n):l(n),z(!1),u("/dashboard")},700)},Y=b.useCallback(()=>{C(!1)},[]);if(w)return t.jsx(ae,{text:e("loading"),className:"mt-24",size:"xl"});if(h&&!i&&!N)return t.jsx(T,{className:"text-red-400 p-12 text-center shadow-xl !border-red-500/70 !bg-red-800/40 text-lg font-semibold !rounded-2xl animate-fadeInUp",useGlassEffect:!0,children:h});if(!i)return t.jsx(T,{className:"text-slate-400 p-12 text-center shadow-lg text-lg font-medium !rounded-2xl animate-fadeInUp",useGlassEffect:!0,children:e("reviewErrorNoQuizData")});const I=!!E,O=i?{id:E||"temp-id",createdAt:new Date().toISOString(),...i}:null;return t.jsxs("div",{className:"pb-16",children:[t.jsx("div",{className:"sticky-review-actions bg-slate-800 shadow-xl py-4 -mx-4 sm:-mx-6 lg:-mx-8 rounded-b-2xl border-b border-slate-700 animate-fadeInUp",children:t.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[t.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-slate-50 leading-tight truncate tracking-tight flex items-center",title:i.title,children:e(I?"reviewEditQuizTitle":"reviewFinalizeQuizTitle")}),t.jsxs("div",{className:"flex flex-wrap justify-center sm:justify-end items-center gap-2.5",children:[!I&&t.jsxs(y,{variant:"outline",size:"sm",onClick:()=>u("/create"),leftIcon:t.jsx(ie,{className:"w-4 h-4"}),className:"py-2.5 px-4 rounded-lg",children:[" ",e("reviewDiscardRegenerateShort")," "]}),t.jsxs(y,{variant:"secondary",size:"sm",onClick:()=>u("/dashboard"),leftIcon:t.jsx(re,{className:"w-4 h-4"}),className:"py-2.5 px-4 rounded-lg",children:[" ",e(I?"cancel":"reviewDiscardToDashboardShort")," "]}),t.jsxs(y,{variant:"outline",size:"sm",onClick:()=>C(!0),leftIcon:t.jsx(le,{className:"w-4 h-4"}),className:"py-2.5 px-4 rounded-lg border-sky-400/70 text-sky-300 hover:bg-sky-400/15",disabled:!O||O.questions.length===0,children:[" ",e("azotaExportButton")," "]}),t.jsxs(y,{variant:"primary",size:"sm",onClick:X,isLoading:N,disabled:N||!i.questions.length,leftIcon:t.jsx(ce,{className:"w-4 h-4"}),className:"bg-gradient-to-r from-green-500 to-teal-500 hover:from-green-600 hover:to-teal-600 text-white py-2.5 px-4 rounded-lg",children:[" ",e(N?"reviewSavingButton":I?"reviewSaveChangesButton":"reviewSaveButton")," "]})]})]}),h&&t.jsx("p",{role:"alert",className:"text-xs text-red-300 mt-4 bg-red-500/20 p-3 rounded-lg text-center sm:text-left shadow animate-fadeIn",children:h}),!i.questions.length&&t.jsx("p",{role:"alert",className:"text-xs text-yellow-400 mt-4 bg-yellow-500/20 p-3 rounded-lg text-center sm:text-left shadow animate-fadeIn",children:e("reviewCannotSaveNoQuestions")})]})}),t.jsxs("div",{children:[t.jsxs("div",{ref:P,className:`${J?"animate-fadeInUp":"opacity-0"} mb-6 sm:mb-8 mt-6 sm:mt-8`,children:[" ",t.jsxs(T,{useGlassEffect:!0,className:"shadow-2xl !rounded-2xl",children:[t.jsx("p",{className:"text-sm text-slate-300/90 mb-6",children:e(I?"reviewEditQuizDesc":"reviewFinalizeQuizDesc")}),t.jsx(de,{label:t.jsx("span",{className:"text-base font-semibold text-slate-100",children:e("reviewQuizTitleLabel")}),value:i.title,onChange:n=>a(r=>r?{...r,title:n.target.value}:null),className:"text-xl mb-3",placeholder:e("step2QuizTitlePlaceholder"),inputClassName:"!text-xl !font-semibold !py-3.5 !rounded-xl"})]})]}),t.jsx("div",{className:"space-y-6 sm:space-y-8",children:i.questions.map((n,r)=>t.jsx(Ne,{question:n,index:r,editableQuiz:i,setEditableQuiz:a,handleAddOption:H,handleRemoveOption:K,handleDeleteQuestion:Z,handleFieldChange:V,handleOptionChange:_,animationDelayFactor:r},n.id))})]}),t.jsx("div",{className:"mt-10 sm:mt-12 text-center",children:t.jsxs(y,{variant:"subtle",onClick:W,leftIcon:t.jsx(ue,{className:"w-5 h-5"}),className:"border-2 border-dashed hover:border-solid border-slate-600 hover:border-sky-400 text-slate-300 hover:text-sky-200 py-3.5 px-8 shadow-lg hover:shadow-xl rounded-xl animate-fadeInUp",style:{animationDelay:`${i.questions.length*.05+.2}s`},children:[" ",e("reviewAddNewQuestion")," "]})}),O&&t.jsx(be,{isOpen:f,onClose:Y,quiz:O})]})},Ne=({question:s,index:u,editableQuiz:e,setEditableQuiz:l,handleAddOption:p,handleRemoveOption:m,handleDeleteQuestion:x,handleFieldChange:i,handleOptionChange:a,animationDelayFactor:w})=>{const{t:c}=F(),N=[.25,.1,.25,1];return t.jsx(he.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},transition:{delay:w*.1,duration:.35,ease:N},children:t.jsxs(T,{className:"relative shadow-2xl !rounded-2xl !p-5 sm:!p-6 card-float-hover",useGlassEffect:!0,children:[t.jsxs("div",{className:"flex justify-between items-start mb-5",children:[t.jsxs("h3",{className:"text-lg sm:text-xl font-semibold text-slate-50 pt-1",children:[" ",c("reviewQuestionLabel",{index:u+1})," "]}),t.jsx(B,{content:c("reviewDeleteQuestionLabel"),placement:"left",wrapperClassName:"inline-flex",children:t.jsx(y,{variant:"ghost",size:"sm",onClick:()=>x(s.id),className:"!p-2.5 rounded-lg text-slate-400 hover:text-red-400 hover:bg-red-500/10","aria-label":c("reviewDeleteQuestionLabel"),disabled:e.questions.length<=1,tooltip:e.questions.length<=1?c("reviewCannotSaveNoQuestions"):void 0,children:t.jsx(R,{className:"w-5 h-5"})})})]}),t.jsxs("div",{className:"space-y-5",children:[t.jsx($,{label:t.jsx("span",{className:"text-sm font-medium text-slate-200",children:c("reviewQuestionTextLabel")}),value:s.questionText,onChange:h=>i(s.id,"questionText",h.target.value),rows:3,className:"min-h-[90px] font-mono text-sm",placeholder:c("reviewQuestionTextPlaceholder")}),t.jsxs("div",{className:"space-y-3.5 pl-4 sm:pl-5 border-l-2 border-slate-600/70 py-3",children:[t.jsx("label",{className:"block text-sm font-medium text-slate-200 mb-2",children:c("reviewOptionsLabel")}),s.options.map((h,v)=>t.jsx("div",{className:"space-y-2",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx($,{id:`option-input-${s.id}-${v}`,value:h,onChange:f=>a(s.id,v,f.target.value),rows:1,className:"text-sm font-mono overflow-x-auto overflow-y-hidden whitespace-nowrap !py-2.5 resize-none","aria-label":c("reviewOptionLabel",{index:v+1}),placeholder:c("reviewOptionPlaceholder",{index:v+1}),containerClassName:"flex-grow min-w-0"}),t.jsx(B,{content:c("reviewRemoveOptionLabel"),placement:"left",wrapperClassName:"inline-flex",children:t.jsx(y,{variant:"ghost",onClick:()=>m(s.id,v),"aria-label":c("reviewRemoveOptionLabel"),className:"!p-3 rounded-lg",disabled:s.options.length<=2,children:t.jsx(R,{className:"w-5 h-5"})})})]})},v)),s.options.length<5&&t.jsxs(y,{variant:"outline",onClick:()=>p(s.id),leftIcon:t.jsx(xe,{className:"w-4 h-4"}),className:"mt-2 py-2 px-4 rounded-lg text-xs",children:[" ",c("reviewAddOption")," "]}),s.options.length>0&&t.jsx(U,{label:t.jsx("span",{className:"text-sm font-medium text-slate-200",children:c("reviewCorrectAnswerLabel")}),value:s.correctAnswer,onChange:h=>i(s.id,"correctAnswer",h.target.value),options:s.options.map(h=>({value:h,label:h.length>70?h.substring(0,67)+"...":h})),containerClassName:"mt-3.5",className:"overflow-x-auto overflow-y-hidden whitespace-nowrap cursor-default thin-scrollbar-horizontal"})]}),t.jsx($,{label:t.jsx("span",{className:"text-sm font-medium text-slate-200",children:c("reviewExplanationLabel")}),value:s.explanation,onChange:h=>i(s.id,"explanation",h.target.value),rows:3,className:"min-h-[110px] font-mono text-sm",placeholder:c("reviewExplanationPlaceholder")})]})]})})};export{je as default};
