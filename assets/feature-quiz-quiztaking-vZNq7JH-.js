import{r as e,j as t}from"./core-react-DcE6uGcR.js";import{u as s,a as r,L as a,C as i,f as o,j as l,E as n,B as c,o as d,r as m,M as u}from"./app-components-CFPFxe5x.js";import{u as x}from"./feature-quiz-hooks-BfRW88BL.js";import{c as p,l as f}from"./services-BHj8px4z.js";import{d as b,a as j}from"./router-Dk7yDelZ.js";import"./katex-core-BbYO2yyT.js";import"./katex-extras-AZS8NW-4.js";import"./service-supabase-wASzC9XA.js";import"./google-services-Bc_loC93.js";/* empty css                        */import"./feature-quiz-home-Ch5jepSG.js";import"./feature-quiz-components-CChsAlA6.js";import"./ui-framework-CdNWeEQR.js";import"./feature-quiz-dashboard-C8yrEGC7.js";import"./markdown-processors-D3jN8hOQ.js";import"./react-markdown-Cej2CoYR.js";import"./feature-quiz-sharedquiz-Clu9xfzS.js";import"./feature-quiz-2SquOiTn.js";import"./util-storage-UFVse9kk.js";import"./util-document-Dv5rbOR1.js";import"./util-pdf-CkIVnOzu.js";const v=()=>{const{setQuizResult:v,currentUser:g}=s(),{t:h}=r(),{quizId:z}=b(),k=j(),[y,w]=e.useState(null),[N,q]=e.useState(!1),[C,Q]=e.useState(!1),T=e.useCallback(()=>{Q(!0)},[]),{localActiveQuiz:I,currentQuestion:S,currentQuestionIndex:L,loading:U,timeLeft:E,elapsedTime:A,userAnswers:F,goToNextQuestion:M,goToPreviousQuestion:P,updateUserAnswer:O,formatTime:B,totalQuestions:R,attemptSettings:D,markQuizCompleted:$}=x(z,T);e.useEffect(()=>{S&&F[S.id]?w(F[S.id]):w(null)},[S,F]);const G=e.useCallback(()=>{if(S&&y)O(S.id,y);else if(S&&!y&&F[S.id]){const e={...F};delete e[S.id],Object.entries(e).forEach(([e,t])=>{O(e,t)})}},[S,y,F,O]),H=e.useCallback(async()=>{if(!I)return;S&&y&&O(S.id,y),await $();let e=0;const t=[];I.questions.forEach(s=>{const r=F[s.id];r?(t.push({questionId:s.id,answer:r}),r===s.correctAnswer&&e++):t.push({questionId:s.id,answer:""})});const s=R>0?e/R*100:0,r={quizId:I.id,userId:null==g?void 0:g.id,score:parseFloat(s.toFixed(2)),answers:t,totalCorrect:e,totalQuestions:R,timeTaken:Math.max(1,A),sourceMode:"take",createdAt:(new Date).toISOString()};if(v(r),g)try{await p.saveQuizResult(r)||f.warn("Failed to save quiz result to database","QuizTakingPage")}catch(a){f.error("Error saving quiz result to database","QuizTakingPage",{},a)}q(!1),Q(!1),k(`/results/${I.id}`)},[I,S,y,O,v,k,R,D.timeLimit,g,A,F,$]),J=e.useCallback(()=>q(!1),[]),K=e.useCallback(()=>{H()},[H]);if(U||!I)return t.jsx(a,{text:h("quizTakingLoading"),className:"mt-24",size:"xl"});if(!S)return t.jsxs(i,{className:"max-w-3xl mx-auto p-5 sm:p-6 md:p-8 animate-fadeInUp rounded-lg bg-[var(--color-bg-surface-2)]/50 border border-[var(--color-border-default)] shadow-md",children:[t.jsx(a,{text:h("quizTakingLoading")}),t.jsx("p",{className:"text-center text-[var(--color-text-secondary)] mt-4",children:h("quizTakingErrorQuestionNotFound")})]});const V=R>0?(L+1)/R*100:0,W=L===R-1;return t.jsxs(i,{className:"max-w-3xl mx-auto p-5 sm:p-6 md:p-8 animate-fadeInUp rounded-lg bg-[var(--color-bg-surface-2)]/50 border border-[var(--color-border-default)] shadow-md",children:[t.jsxs("div",{className:"mb-6 sm:mb-8",children:[t.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-[var(--color-text-primary)] mb-3 sm:mb-4 leading-tight tracking-tight line-clamp-2",title:I.title,children:t.jsx(o,{text:I.title,markdownFormatting:!0})}),t.jsxs("div",{className:"flex justify-between items-center text-sm text-[var(--color-text-secondary)] mb-4 sm:mb-5",children:[t.jsx("span",{children:h("quizTakingQuestionProgress",{current:L+1,total:R})}),t.jsxs("div",{className:"flex gap-4",children:[t.jsxs("span",{className:"font-semibold text-[var(--color-text-muted)]",children:["Time: ",B(A)]}),""!==D.timeLimit&&null!==E&&t.jsx("span",{className:"font-semibold "+(E<=60?"text-red-400 animate-pulse":"text-[var(--color-primary-accent)]"),children:h("quizTakingTimeLeft",{time:B(E)})})]})]}),t.jsx(l,{progress:V,size:"md"})]}),t.jsxs("div",{className:"mt-6 md:mt-8",children:[t.jsx("div",{className:"quiz-question-text text-base sm:text-lg text-[var(--color-text-body)] leading-relaxed mb-4",children:t.jsx(n,{content:S.questionText})}),t.jsx("div",{className:"quiz-options space-y-3",children:S.options.map((e,s)=>{const r=y===e;return t.jsxs("button",{onClick:()=>(e=>{w(e)})(e),className:"w-full flex items-center text-left p-3.5 sm:p-4 rounded-xl border-2 focus:outline-none focus-visible:ring-4 focus-visible:ring-[var(--color-primary-accent)]/50 focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--color-bg-default)] shadow-lg transition-all var(--duration-fast) var(--ease-ios) will-change-transform, border, background-color "+(r?"bg-[var(--color-primary-accent)]/50 border-[var(--color-primary-accent)] text-[var(--color-primary-accent-text)] font-semibold scale-[1.01]":"bg-[var(--color-bg-surface-3)]/70 hover:bg-[var(--color-bg-surface-3)]/40 border-[var(--color-border-interactive)] hover:border-[var(--color-primary-accent)] text-[var(--color-text-primary)]"),"aria-pressed":r,children:[t.jsx("span",{className:"option-indicator mr-3.5 flex-shrink-0 w-6 h-6 rounded-full border-2 flex items-center justify-center transition-colors var(--duration-fast) var(--ease-ios) "+(r?"border-[var(--color-primary-accent-text)] bg-[var(--color-primary-accent)]":"border-[var(--color-text-muted)] bg-[var(--color-bg-surface-2)] group-hover:border-[var(--color-primary-accent)]")}),t.jsx("div",{className:"text-sm sm:text-base flex-grow markdown-content",children:t.jsx(n,{content:e})})]},s)})})]}),t.jsxs("div",{className:"flex flex-col space-y-3 pt-6 sm:pt-8 border-t border-[var(--color-border-default)] mt-6 sm:mt-8",children:[t.jsx(c,{onClick:()=>{I&&(G(),M()||q(!0))},disabled:!(y||S&&F[S.id]),variant:"primary",size:"lg",rightIcon:t.jsx(d,{className:"w-5 h-5"}),className:"w-full py-3 rounded-xl",children:h(W?"submit":"nextQuestion")}),t.jsxs("div",{className:"flex justify-between items-center pt-3",children:[t.jsx(c,{onClick:()=>{G(),P()},disabled:0===L,variant:"outline",size:"md",leftIcon:t.jsx(m,{className:"w-4 h-4"}),className:"py-2.5 px-5 rounded-lg",children:h("previous")}),t.jsx(c,{onClick:()=>q(!0),variant:"outline",size:"md",className:"py-2.5 px-5 rounded-lg",children:h("quizTakingSubmitQuiz")})]})]}),N&&t.jsx(u,{isOpen:N,onClose:J,title:h("quizTakingSubmitQuiz"),size:"md",footerContent:t.jsxs("div",{className:"flex justify-end gap-3.5",children:[t.jsx(c,{variant:"secondary",onClick:J,size:"md",children:h("cancel")}),t.jsx(c,{variant:"primary",onClick:H,size:"md",children:h("submit")})]}),children:t.jsx("p",{className:"text-[var(--color-text-body)] text-base leading-relaxed",children:h("submitConfirmationMessage")})}),C&&t.jsx(u,{isOpen:C,onClose:K,title:h("timesUp"),size:"md",hideCloseButton:!0,footerContent:t.jsx("div",{className:"flex justify-center",children:t.jsx(c,{variant:"primary",onClick:K,size:"md",children:h("timesUpSubmit")})}),children:t.jsx("p",{className:"text-[var(--color-text-body)] text-base leading-relaxed text-center",children:h("timesUpMessage")})})]})};v.displayName="QuizTakingPage";export{v as default};
