import{u as M,a as F,w as G,b as H,r as m,c as u,R as I,j as e,L as Y,B as f,C as R,p as J,A as K,m as W,z as T,H as Z,e as X}from"./index-DcfiZvdk.js";import{M as x}from"./MathText-Bdaeuop9.js";const te=()=>{const{activeQuiz:a,quizResult:l,quizzes:p,setActiveQuiz:h,currentUser:_}=M(),{t:s}=F(),{quizId:o}=G(),n=H(),j=m.useRef(null),$=u(j,{threshold:.1,freezeOnceVisible:!0}),w=m.useRef(null),q=u(w,{threshold:.2,freezeOnceVisible:!0}),N=m.useRef(null),A=u(N,{threshold:.5,freezeOnceVisible:!0}),y=m.useRef(null),S=u(y,{threshold:.5,freezeOnceVisible:!0}),[r,b]=I.useState(a);if(m.useEffect(()=>{if(o){const t=(a==null?void 0:a.id)===o?a:p.find(i=>i.id===o);t?((a==null?void 0:a.id)!==o&&h(t),b(t)):(console.warn(`ResultsPage: Quiz with ID ${o} not found in context or quizzes list. Navigating to dashboard.`),n("/dashboard"))}else if(a&&l&&a.id===l.quizId)b(a);else if(l&&a&&a.id!==l.quizId){const t=p.find(i=>i.id===l.quizId);t?(h(t),b(t)):(console.warn("ResultsPage: quizResult.quizId does not match any known quiz. Navigating to dashboard."),n("/dashboard"))}},[o,a,p,h,n,l]),!l||!r||r.id!==l.quizId)return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[calc(100vh-380px)] text-center p-5 animate-fadeInUp",children:[e.jsx(Y,{text:s("resultsLoading"),className:"mb-10",size:"xl"}),e.jsx("p",{className:"text-xl font-semibold text-slate-300 mb-4",children:s("resultsErrorNotFound")}),e.jsx("p",{className:"text-base text-slate-400 mb-12",children:s("resultsErrorNotFound")}),e.jsxs(f,{onClick:()=>n("/dashboard"),variant:"secondary",size:"lg",className:"py-3.5 px-8 rounded-xl",children:[" ",s("resultsGoToDashboard")," "]})]});const{score:c,answers:E,totalCorrect:V,totalQuestions:P,sourceMode:g}=l,O=(t,i)=>i?i.trim().toLowerCase()===t.correctAnswer.trim().toLowerCase():!1,U=c>=70?"text-green-400":c>=40?"text-amber-400":"text-red-400",D=c>=70?"bg-gradient-to-r from-green-400 to-emerald-400":c>=40?"bg-gradient-to-r from-amber-400 to-yellow-400":"bg-gradient-to-r from-red-400 to-rose-400",L="https://img.icons8.com/?size=256&id=eoxMN35Z6JKg&format=png",B=g==="practice"?s("practiceSummaryTitle",{quizTitle:r.title}):s("resultsTitle",{quizTitle:r.title});return e.jsx("div",{ref:j,className:`${$?"animate-page-slide-fade-in":"opacity-0"}`,children:e.jsxs(R,{className:"max-w-4xl mx-auto shadow-2xl !border-slate-700/40 !rounded-2xl",useGlassEffect:!0,children:[e.jsx("h1",{className:"text-3xl sm:text-4xl font-bold text-slate-50 mb-4 text-center leading-tight tracking-tight line-clamp-2",title:r.title,children:e.jsx(x,{text:B})}),e.jsx("p",{className:"text-base text-slate-300/80 mb-12 text-center",children:s(g==="practice"?"practiceSummarySubtitle":"resultsSubtitle")}),e.jsx("div",{ref:w,className:`${q?"animate-fadeInUp":"opacity-0"}`,children:e.jsxs(R,{className:"mb-12 !bg-slate-700/70 shadow-xl !border-slate-600/60 p-0 overflow-hidden !rounded-2xl",useGlassEffect:!1,children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-around items-center text-center gap-8 p-6 sm:p-10 !bg-slate-800/60",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("p",{className:"text-sm text-slate-400 uppercase tracking-wider font-medium mb-1.5",children:s("resultsYourScore")}),e.jsxs("p",{className:`text-6xl sm:text-7xl font-extrabold ${U} tracking-tight`,children:[c.toFixed(0),e.jsx("span",{className:"text-4xl",children:"%"})]})]}),e.jsx("div",{className:"w-full md:w-px h-px md:h-24 bg-slate-600/70 my-3 md:my-0"}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("p",{className:"text-sm text-slate-400 uppercase tracking-wider font-medium mb-1.5",children:s("resultsCorrectAnswers")}),e.jsxs("p",{className:"text-5xl sm:text-6xl font-bold text-slate-100",children:[V," ",e.jsxs("span",{className:"text-3xl text-slate-400/80",children:["/ ",P]})]})]})]}),e.jsx(J,{progress:c,className:"w-full rounded-b-2xl overflow-hidden",size:"lg",barClassName:`${D} !h-3.5`,showPercentage:!1})]})}),e.jsx("h2",{ref:N,className:`text-2xl sm:text-3xl font-semibold text-slate-100 mb-8 sm:mb-10 ${A?"animate-fadeInUp":"opacity-0"}`,children:s("resultsBreakdownTitle")}),e.jsx("div",{className:"space-y-5",children:r.questions.map((t,i)=>{const v=E.find(Q=>Q.questionId===t.id),z=v?v.answer:"",d=O(t,z),C=I.useRef(null),k=u(C,{threshold:.05});return e.jsx("div",{ref:C,className:`${k?"animate-fadeInUp":"opacity-0"}`,style:{animationDelay:k?`${i*75}ms`:void 0},children:e.jsx(K,{initiallyOpen:!d,containerClassName:`!rounded-xl shadow-lg ${d?"!border-green-500/60":"!border-red-500/60"}`,title:e.jsxs("div",{className:"flex items-center w-full gap-3",children:[e.jsxs("span",{className:"text-xs text-slate-400 font-semibold",children:["Q",i+1,"."]}),e.jsx("span",{className:`flex-grow text-sm sm:text-base ${d?"text-slate-200":"text-slate-100 font-semibold"} min-w-0 break-words`,title:t.questionText,children:e.jsx(x,{text:t.questionText})})]}),titleClassName:`py-3.5 px-4 sm:px-5 rounded-t-xl ${d?"hover:!bg-green-400/15":"hover:!bg-red-400/15"}`,contentClassName:"!bg-slate-700/30",children:e.jsxs("div",{className:"space-y-4 text-sm sm:text-base",children:[e.jsxs("p",{className:"text-slate-300",children:[e.jsxs("strong",{className:"font-semibold text-slate-100",children:[s("resultsYourAnswer")," "]}),e.jsx("span",{className:`${d?"text-green-400 font-medium":"text-red-400 font-medium"} break-words`,children:e.jsx(x,{text:z||s("resultsNotAnswered")})})]}),!d&&e.jsxs("p",{className:"text-slate-300",children:[e.jsxs("strong",{className:"font-semibold text-slate-100",children:[s("resultsCorrectAnswerMC")," "]}),e.jsx("span",{className:"text-green-400 font-medium break-words",children:e.jsx(x,{text:t.correctAnswer})})]}),e.jsxs("div",{className:"mt-5 pt-5 border-t border-slate-600/70",children:[e.jsxs("p",{className:"flex items-start text-base font-semibold text-sky-300 mb-2.5",children:[e.jsx("img",{src:L,alt:s("resultsExplanationTitle"),className:"w-5 h-5 mr-3 flex-shrink-0 mt-0.5"}),s("resultsExplanationTitle")]}),e.jsx("div",{className:"text-slate-300/90 leading-relaxed whitespace-pre-wrap break-words",children:e.jsx(x,{text:t.explanation||s("resultsNoExplanation")})})]}),r.sourceContentSnippet&&e.jsxs("details",{className:"mt-5 pt-5 border-t border-slate-600/70",children:[e.jsxs("summary",{className:"text-xs text-slate-400 cursor-pointer hover:text-sky-300 flex items-center font-semibold group transition-colors var(--duration-fast) var(--ease-ios)",children:[" ",e.jsx(W,{className:"w-4 h-4 mr-2.5 text-slate-500 group-hover:text-sky-400 transition-colors var(--duration-fast) var(--ease-ios)",strokeWidth:2})," ",s("resultsViewSourceSnippet")," "]}),e.jsx("blockquote",{className:"mt-3 text-xs text-slate-400/80 max-h-36 overflow-y-auto p-3.5 bg-slate-700/60 border border-slate-600/60 rounded-lg shadow-inner italic",children:e.jsx(x,{text:r.sourceContentSnippet})})]})]})})},t.id)})}),e.jsxs("div",{ref:y,className:`mt-14 flex flex-col sm:flex-row justify-center items-center gap-4 sm:gap-5 ${S?"animate-fadeInUp":"opacity-0"}`,children:[g==="practice"?e.jsx(f,{onClick:()=>n(`/practice/${r.id}`),variant:"outline",size:"lg",leftIcon:e.jsx(T,{className:"w-5 h-5"}),className:"w-full sm:w-auto py-3 px-8 rounded-xl",children:s("practiceAgain")}):e.jsx(f,{onClick:()=>n(`/quiz/${r.id}`),variant:"outline",size:"lg",leftIcon:e.jsx(T,{className:"w-5 h-5"}),className:"w-full sm:w-auto py-3 px-8 rounded-xl",children:s("resultsTryAgain")}),e.jsx(f,{onClick:()=>n("/dashboard"),variant:"secondary",size:"lg",leftIcon:e.jsx(Z,{className:"w-5 h-5"}),className:"w-full sm:w-auto py-3 px-8 rounded-xl",children:s("resultsBackToDashboard")}),e.jsx(f,{onClick:()=>n("/create"),variant:"primary",size:"lg",leftIcon:e.jsx(X,{className:"w-5 h-5"}),className:"w-full sm:w-auto bg-gradient-to-r from-sky-500 to-indigo-500 hover:from-sky-600 hover:to-indigo-600 text-white shadow-xl py-3 px-8 rounded-xl",children:s("resultsCreateNewQuiz")})]})]})})};export{te as default};
