import{u as P,b as k,f as G,r as e}from"./router-BxjC687J.js";import{u as _}from"./index-IZIOKjw3.js";function q(S){if(!S)return[];const n=[...S];for(let o=n.length-1;o>0;o--){const r=Math.floor(Math.random()*(o+1));[n[o],n[r]]=[n[r],n[o]]}return n}const E={shuffleQuestions:!1,shuffleAnswers:!1,timeLimit:0},H=(S,n)=>{var L;const{quizzes:o,activeQuiz:r,setActiveQuiz:A}=_(),Q=P(),x=k(),{quizId:M}=G(),d=S||M,[s,N]=e.useState(null),[l,R]=e.useState(E),[u,T]=e.useState([]),[a,g]=e.useState(0),[I,y]=e.useState(!0),[h,v]=e.useState(null),[C,D]=e.useState(0),i=e.useRef(null),m=e.useRef(null),z=(L=x.state)==null?void 0:L.attemptSettings,w=e.useMemo(()=>z,[JSON.stringify(z)]);e.useEffect(()=>{let t=!0;return(()=>{if(!d){t&&Q("/dashboard");return}const f=w||((s==null?void 0:s.id)===d?l:E);t&&JSON.stringify(f)!==JSON.stringify(l)&&R(f);let c=r&&r.id===d?r:o.find(p=>p.id===d);if(c){if(t){N(c),(!r||r.id!==c.id)&&A(c);let p=c.questions;f.shuffleQuestions&&(p=q([...c.questions])),T(p),g(0),f.timeLimit>0?v(f.timeLimit*60):v(null)}}else t&&Q("/dashboard");t&&y(!1)})(),()=>{t=!1,i.current&&clearInterval(i.current),m.current&&clearInterval(m.current)}},[d,o,r,Q,A,w,s==null?void 0:s.id,l]),e.useEffect(()=>{if(s&&!I)return m.current=window.setInterval(()=>{D(t=>t+1)},1e3),()=>{m.current&&clearInterval(m.current)}},[s,I]),e.useEffect(()=>{if(h===null){i.current&&clearInterval(i.current);return}if(h<=0){i.current&&clearInterval(i.current),s&&n&&n();return}return i.current=window.setInterval(()=>{v(t=>t?t-1:0)},1e3),()=>{i.current&&clearInterval(i.current)}},[h,s,n]);const F=e.useMemo(()=>{if(!u||u.length===0||a>=u.length)return;const t=u[a];return t&&l.shuffleAnswers?{...t,options:q([...t.options])}:t},[u,a,l.shuffleAnswers]),J=e.useCallback(()=>a<u.length-1?(g(t=>t+1),!0):!1,[a,u.length]),O=e.useCallback(()=>a>0?(g(t=>t-1),!0):!1,[a]);return{localActiveQuiz:s,shuffledQuestions:u,currentQuestion:F,currentQuestionIndex:a,loading:I,timeLeft:h,elapsedTime:C,attemptSettings:l,goToNextQuestion:J,goToPreviousQuestion:O,formatTime:t=>{const b=Math.floor(t/60),f=t%60;return`${b.toString().padStart(2,"0")}:${f.toString().padStart(2,"0")}`},totalQuestions:u.length,setShuffledQuestions:T,setCurrentQuestionIndex:g}};export{H as u};
