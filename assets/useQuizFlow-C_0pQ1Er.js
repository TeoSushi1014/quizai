import{u as k,b as G,f as _,r as e}from"./router-BxjC687J.js";import{u as $}from"./index-QW2lQ77I.js";function N(S){if(!S)return[];const s=[...S];for(let o=s.length-1;o>0;o--){const u=Math.floor(Math.random()*(o+1));[s[o],s[u]]=[s[u],s[o]]}return s}const M={shuffleQuestions:!1,shuffleAnswers:!1,timeLimit:""},K=(S,s)=>{var q;const{quizzes:o,activeQuiz:u,setActiveQuiz:w}=$(),v=k(),R=G(),{quizId:x}=_(),d=S||x,[r,D]=e.useState(null),[c,y]=e.useState(M),[i,z]=e.useState([]),[a,g]=e.useState(0),[T,C]=e.useState(!0),[h,A]=e.useState(null),[F,L]=e.useState(0),n=e.useRef(null),l=e.useRef(null),p=e.useRef(null),b=(q=R.state)==null?void 0:q.attemptSettings,E=e.useMemo(()=>b,[JSON.stringify(b)]);e.useEffect(()=>{let t=!0;return(()=>{if(!d){t&&v("/dashboard");return}const f=E||((r==null?void 0:r.id)===d?c:M);t&&JSON.stringify(f)!==JSON.stringify(c)&&y(f);let m=u&&u.id===d?u:o.find(Q=>Q.id===d);if(m){if(t){D(m),(!u||u.id!==m.id)&&w(m);let Q=m.questions;f.shuffleQuestions&&(Q=N([...m.questions])),z(Q),g(0),f.timeLimit!==""&&Number(f.timeLimit)>0?A(Number(f.timeLimit)*60):A(null)}}else t&&v("/dashboard");t&&C(!1)})(),()=>{t=!1,n.current&&clearInterval(n.current),l.current&&clearInterval(l.current)}},[d,o,u,v,w,E,r==null?void 0:r.id,c]),e.useEffect(()=>{if(r&&!T)return p.current||(p.current=Date.now(),L(0)),l.current=window.setInterval(()=>{const t=Date.now(),I=Math.floor((t-p.current)/1e3);L(I)},1e3),()=>{l.current&&clearInterval(l.current)}},[r,T]),e.useEffect(()=>()=>{p.current=null,n.current&&clearInterval(n.current),l.current&&clearInterval(l.current)},[]),e.useEffect(()=>{if(h===null){n.current&&clearInterval(n.current);return}if(h<=0){n.current&&clearInterval(n.current),r&&s&&s();return}return n.current=window.setInterval(()=>{A(t=>t?t-1:0)},1e3),()=>{n.current&&clearInterval(n.current)}},[h,r,s]);const J=e.useMemo(()=>{if(!i||i.length===0||a>=i.length)return;const t=i[a];return t&&c.shuffleAnswers?{...t,options:N([...t.options])}:t},[i,a,c.shuffleAnswers]),O=e.useCallback(()=>a<i.length-1?(g(t=>t+1),!0):!1,[a,i.length]),P=e.useCallback(()=>a>0?(g(t=>t-1),!0):!1,[a]);return{localActiveQuiz:r,shuffledQuestions:i,currentQuestion:J,currentQuestionIndex:a,loading:T,timeLeft:h,elapsedTime:F,attemptSettings:c,goToNextQuestion:O,goToPreviousQuestion:P,formatTime:t=>{const I=Math.floor(t/60),f=t%60;return`${I.toString().padStart(2,"0")}:${f.toString().padStart(2,"0")}`},totalQuestions:i.length,setShuffledQuestions:z,setCurrentQuestionIndex:g}};export{K as u};
