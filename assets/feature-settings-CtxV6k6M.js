import{r as e,j as a}from"./core-react-DcE6uGcR.js";import{C as s,Y as r,B as t,c as i,u as l,a as n,Z as o,L as c,f as d,$ as m,a0 as x}from"./app-components-CFPFxe5x.js";import{r as p,l as u}from"./services-BHj8px4z.js";import{m as y}from"./ui-framework-CdNWeEQR.js";import{a as h}from"./router-Dk7yDelZ.js";import"./katex-core-BbYO2yyT.js";import"./katex-extras-AZS8NW-4.js";import"./service-supabase-wASzC9XA.js";import"./google-services-Bc_loC93.js";/* empty css                        */import"./feature-quiz-home-Ch5jepSG.js";import"./feature-quiz-components-CChsAlA6.js";import"./feature-quiz-dashboard-C8yrEGC7.js";import"./markdown-processors-D3jN8hOQ.js";import"./react-markdown-Cej2CoYR.js";import"./feature-quiz-sharedquiz-Clu9xfzS.js";import"./feature-quiz-2SquOiTn.js";import"./util-storage-UFVse9kk.js";import"./util-document-Dv5rbOR1.js";import"./util-pdf-CkIVnOzu.js";const v=[{name:"GEMINI_API_KEY",displayName:"Google Gemini API Key (Personal)",description:"Optional: Use your own API key for quiz generation. Leave empty to use default system key.",placeholder:"AIzaSy... (optional - leave empty to use default)",pattern:/^AIza[0-9A-Za-z-_]{35}$/,required:!1}],j=({onApiKeyUpdate:l})=>{const[n,o]=e.useState({}),[c,d]=e.useState({}),[m,x]=e.useState({}),[h,j]=e.useState({}),[f,b]=e.useState(!1);e.useEffect(()=>{g()},[]);const g=async()=>{const e={},a={};for(const r of v)try{const s=await p.getUserPersonalApiKey(r.name);e[r.name]=s||"",a[r.name]=s?"valid":"unknown"}catch(s){u.error(`Failed to load API key: ${r.name}`,"ApiKeyManager",{},s),e[r.name]="",a[r.name]="unknown"}o(e),j(a)},N=e=>{switch(e){case"valid":return a.jsx(i,{className:"w-5 h-5 text-green-500"});case"invalid":return a.jsx("span",{className:"w-5 h-5 text-red-500",children:"⚠️"});default:return a.jsx(r,{className:"w-5 h-5 text-gray-400"})}};return a.jsxs(s,{className:"!bg-[var(--color-bg-surface-2)]/80 !border-[var(--color-border-default)] p-6 rounded-xl shadow-lg",children:[a.jsxs("div",{className:"flex items-center mb-6",children:[a.jsx(r,{className:"w-6 h-6 mr-3 text-[var(--color-primary-accent)]"}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-[var(--color-text-primary)]",children:"API Key Management"}),a.jsx("p",{className:"text-sm text-[var(--color-text-secondary)] mt-1",children:"Securely store your API keys in Supabase"})]})]}),a.jsxs("div",{className:"space-y-6",children:[v.map(e=>{var s;return a.jsxs(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-[var(--color-text-primary)]",children:[e.displayName,e.required&&a.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),a.jsx("p",{className:"text-xs text-[var(--color-text-secondary)] mt-1",children:e.description})]}),N(h[e.name]||"unknown")]}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:c[e.name]?"text":"password",value:n[e.name]||"",onChange:a=>((e,a)=>{o(s=>({...s,[e]:a}));const s=((e,a)=>{const s=v.find(a=>a.name===e);return!(!s||s.required&&!a.trim()||s.pattern&&!s.pattern.test(a))})(e,a);j(r=>({...r,[e]:a.trim()?s?"valid":"invalid":"unknown"}))})(e.name,a.target.value),placeholder:e.placeholder,className:"w-full px-4 py-3 pr-20 bg-[var(--color-bg-surface-1)] border rounded-lg text-[var(--color-text-primary)] placeholder-[var(--color-text-secondary)] focus:outline-none focus:ring-2 focus:ring-[var(--color-primary-accent)] "+("invalid"===h[e.name]?"border-red-500":"valid"===h[e.name]?"border-green-500":"border-[var(--color-border-default)]")}),a.jsxs("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex items-center space-x-2",children:[a.jsx("button",{type:"button",onClick:()=>{return a=e.name,void d(e=>({...e,[a]:!e[a]}));var a},className:"p-1 text-[var(--color-text-secondary)] hover:text-[var(--color-text-primary)] transition-colors",children:c[e.name]?a.jsx("span",{className:"w-5 h-5",children:"👁️"}):a.jsx("span",{className:"w-5 h-5",children:"🙈"})}),a.jsx(t,{onClick:()=>(async e=>{const a=n[e];if(a.trim()){x(a=>({...a,[e]:!0}));try{await p.setApiKey(e,a)?(j(a=>({...a,[e]:"valid"})),u.info(`API key saved successfully: ${e}`,"ApiKeyManager"),null==l||l()):(j(a=>({...a,[e]:"invalid"})),u.error(`Failed to save API key: ${e}`,"ApiKeyManager"))}catch(s){u.error(`Error saving API key: ${e}`,"ApiKeyManager",{},s),j(a=>({...a,[e]:"invalid"}))}finally{x(a=>({...a,[e]:!1}))}}})(e.name),isLoading:m[e.name],disabled:!(null==(s=n[e.name])?void 0:s.trim())||"invalid"===h[e.name],size:"sm",variant:"primary",className:"!py-1 !px-3",children:"Save"})]})]}),"invalid"===h[e.name]&&a.jsx("p",{className:"text-xs text-red-500",children:"Invalid API key format. Please check your key."})]},e.name)}),a.jsx("div",{className:"flex justify-end pt-4 border-t border-[var(--color-border-default)]",children:a.jsx(t,{onClick:async()=>{b(!0);try{const e=v.map(async e=>{const a=n[e.name];return!(null==a?void 0:a.trim())||p.setApiKey(e.name,a)});(await Promise.all(e)).every(Boolean)?(u.info("All API keys saved successfully","ApiKeyManager"),null==l||l(),await g()):u.error("Some API keys failed to save","ApiKeyManager")}catch(e){u.error("Error saving API keys","ApiKeyManager",{},e)}finally{b(!1)}},isLoading:f,variant:"primary",size:"lg",className:"min-w-[120px]",children:"Save All Keys"})})]}),a.jsx("div",{className:"mt-6 p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg",children:a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx(r,{className:"w-5 h-5 text-blue-400 flex-shrink-0 mt-0.5"}),a.jsxs("div",{className:"text-sm",children:[a.jsx("p",{className:"text-blue-300 font-medium mb-1",children:"How API Keys Work"}),a.jsxs("ul",{className:"text-blue-200/80 leading-relaxed space-y-1 text-xs list-disc list-inside",children:[a.jsxs("li",{children:[a.jsx("strong",{children:"Default System Key:"})," We provide a shared API key for all users to get started"]}),a.jsxs("li",{children:[a.jsx("strong",{children:"Personal API Key:"})," You can add your own key to avoid rate limits and have better control"]}),a.jsxs("li",{children:[a.jsx("strong",{children:"Priority:"})," Your personal key (if provided) will be used first, then falls back to system default"]}),a.jsxs("li",{children:[a.jsx("strong",{children:"Security:"})," All keys are encrypted and stored securely. Only you can see your personal keys"]})]})]})]})})]})},f=()=>{const{currentUser:e}=l(),{t:r}=n(),i=h(),{theme:p,toggleTheme:u}=o();return e?a.jsx("div",{className:"max-w-2xl mx-auto py-8 animate-page-slide-fade-in",children:a.jsxs(s,{useGlassEffect:!0,className:"shadow-2xl !rounded-2xl",children:[a.jsxs("div",{className:"text-center mb-10",children:[a.jsx("h1",{className:"text-3xl font-bold text-[var(--color-text-primary)] mb-3 tracking-tight",children:a.jsx(d,{text:r("navSettings")})}),a.jsx("p",{className:"text-[var(--color-text-secondary)] text-sm leading-relaxed",children:"Manage your application preferences and API settings."})]}),a.jsxs("div",{className:"space-y-8",children:[a.jsxs("section",{children:[a.jsx("h2",{className:"text-xl font-semibold text-[var(--color-text-primary)] mb-4 pb-2 border-b border-[var(--color-border-default)]",children:"Theme Settings"}),a.jsx("div",{className:"bg-[var(--color-bg-surface-2)] rounded-xl p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:["dark"===p?a.jsx(m,{className:"w-5 h-5 text-[var(--color-primary-accent)]"}):a.jsx(x,{className:"w-5 h-5 text-[var(--color-primary-accent)]"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium text-[var(--color-text-primary)]",children:"dark"===p?"Dark Mode":"Light Mode"}),a.jsx("p",{className:"text-sm text-[var(--color-text-secondary)]",children:"Switch between light and dark themes"})]})]}),a.jsx(t,{variant:"primary",size:"sm",onClick:u,className:"px-4",children:"dark"===p?"Switch to Light":"Switch to Dark"})]})})]}),a.jsxs("section",{children:[a.jsx("h2",{className:"text-xl font-semibold text-[var(--color-text-primary)] mb-4 pb-2 border-b border-[var(--color-border-default)]",children:"API Settings"}),a.jsx(j,{})]})]}),a.jsx("div",{className:"flex justify-center mt-10 pt-8 border-t border-[var(--color-border-default)]",children:a.jsx(t,{variant:"secondary",onClick:()=>i("/dashboard"),className:"px-8",children:"Back to Dashboard"})})]})}):(i("/signin",{state:{from:{pathname:"/settings"}}}),a.jsx(c,{text:r("loading")}))};export{f as default};
