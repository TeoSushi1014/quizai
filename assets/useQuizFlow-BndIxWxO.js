import{u as k,b as G,f as _,r as e}from"./router-BxjC687J.js";import{u as $}from"./index-Rs4uqy2c.js";function M(S){if(!S)return[];const s=[...S];for(let o=s.length-1;o>0;o--){const u=Math.floor(Math.random()*(o+1));[s[o],s[u]]=[s[u],s[o]]}return s}const R={shuffleQuestions:!1,shuffleAnswers:!1,timeLimit:0},K=(S,s)=>{var q;const{quizzes:o,activeQuiz:u,setActiveQuiz:w}=$(),v=k(),x=G(),{quizId:N}=_(),m=S||N,[n,D]=e.useState(null),[c,y]=e.useState(R),[i,z]=e.useState([]),[a,g]=e.useState(0),[T,C]=e.useState(!0),[h,A]=e.useState(null),[F,L]=e.useState(0),r=e.useRef(null),f=e.useRef(null),p=e.useRef(null),E=(q=x.state)==null?void 0:q.attemptSettings,b=e.useMemo(()=>E,[JSON.stringify(E)]);e.useEffect(()=>{let t=!0;return(()=>{if(!m){t&&v("/dashboard");return}const l=b||((n==null?void 0:n.id)===m?c:R);t&&JSON.stringify(l)!==JSON.stringify(c)&&y(l);let d=u&&u.id===m?u:o.find(Q=>Q.id===m);if(d){if(t){D(d),(!u||u.id!==d.id)&&w(d);let Q=d.questions;l.shuffleQuestions&&(Q=M([...d.questions])),z(Q),g(0),l.timeLimit>0?A(l.timeLimit*60):A(null)}}else t&&v("/dashboard");t&&C(!1)})(),()=>{t=!1,r.current&&clearInterval(r.current),f.current&&clearInterval(f.current)}},[m,o,u,v,w,b,n==null?void 0:n.id,c]),e.useEffect(()=>{if(n&&!T)return p.current||(p.current=Date.now(),L(0)),f.current=window.setInterval(()=>{const t=Date.now(),I=Math.floor((t-p.current)/1e3);L(I)},1e3),()=>{f.current&&clearInterval(f.current)}},[n,T]),e.useEffect(()=>()=>{p.current=null,r.current&&clearInterval(r.current),f.current&&clearInterval(f.current)},[]),e.useEffect(()=>{if(h===null){r.current&&clearInterval(r.current);return}if(h<=0){r.current&&clearInterval(r.current),n&&s&&s();return}return r.current=window.setInterval(()=>{A(t=>t?t-1:0)},1e3),()=>{r.current&&clearInterval(r.current)}},[h,n,s]);const J=e.useMemo(()=>{if(!i||i.length===0||a>=i.length)return;const t=i[a];return t&&c.shuffleAnswers?{...t,options:M([...t.options])}:t},[i,a,c.shuffleAnswers]),O=e.useCallback(()=>a<i.length-1?(g(t=>t+1),!0):!1,[a,i.length]),P=e.useCallback(()=>a>0?(g(t=>t-1),!0):!1,[a]);return{localActiveQuiz:n,shuffledQuestions:i,currentQuestion:J,currentQuestionIndex:a,loading:T,timeLeft:h,elapsedTime:F,attemptSettings:c,goToNextQuestion:O,goToPreviousQuestion:P,formatTime:t=>{const I=Math.floor(t/60),l=t%60;return`${I.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}`},totalQuestions:i.length,setShuffledQuestions:z,setCurrentQuestionIndex:g}};export{K as u};
