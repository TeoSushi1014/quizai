import{j as e}from"./ui-BGuvgkTr.js";import{r as n,f as B,u as G}from"./router-BxjC687J.js";import{b as M,l as c,C as f,L as F,B as d,U as X,u as O,X as W,M as L,n as E,k as Z,V as J,W as K,w as ee,p as te,Y as A,Z as re,_ as se}from"./index-Rs4uqy2c.js";import{q as ae}from"./quizResultsService-vGp8ATOM.js";import"./vendor-DoC2WAmd.js";import"./utils-rUpm7H1u.js";import"./markdown-Bj7tmv2T.js";const ie=({quizId:i,isOwner:r,currentUserId:m})=>{M();const[x,j]=n.useState([]),[y,g]=n.useState(!0),[a,p]=n.useState(null);n.useEffect(()=>{u()},[i,r,m]);const u=async()=>{try{g(!0),p(null);const s=await ae.getQuizHistory({quizId:i,userId:r?void 0:m,limit:20});j(s),g(!1),c.info("Quiz history loaded","QuizHistory",{quizId:i,resultCount:s.length,isOwner:r})}catch(s){c.error("Failed to load quiz history","QuizHistory",{},s),p("Failed to load history"),g(!1)}},t=s=>{if(!s)return"--:--";const b=Math.floor(s/60),h=Math.round(s%60);return`${b}m ${h}s`},v=s=>new Date(s).toLocaleDateString("vi-VN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),N=s=>s>=80?"text-[var(--color-success-accent)]":s>=60?"text-[var(--color-warning-accent)]":"text-[var(--color-danger-accent)]";return y?e.jsx(f,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-center py-4",children:[e.jsx(F,{}),e.jsx("span",{className:"ml-2 text-sm text-[var(--color-text-secondary)]",children:"Loading history..."})]})}):a?e.jsx(f,{className:"p-4",children:e.jsxs("div",{className:"text-center py-4",children:[e.jsx("p",{className:"text-sm text-[var(--color-danger-accent)] mb-2",children:a}),e.jsx(d,{onClick:u,variant:"outline",size:"sm",children:"Retry"})]})}):x.length===0?e.jsx(f,{className:"p-4",children:e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-sm text-[var(--color-text-secondary)]",children:r?"No attempts yet":"You haven't taken this quiz yet"})})}):e.jsxs(f,{className:"p-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("h3",{className:"text-lg font-semibold text-[var(--color-text-primary)]",children:[r?"Recent Results":"Your Results"," (",x.length,")"]})}),e.jsx("div",{className:"space-y-2",children:x.map(s=>e.jsx("div",{className:"flex items-center justify-between p-3 bg-[var(--color-bg-surface-2)] rounded-lg hover:bg-[var(--color-bg-surface-3)] transition-colors duration-200",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(X,{user:{id:s.user_id||"",name:s.user_name||"Anonymous",email:s.user_email||"",imageUrl:s.user_image_url},size:"sm",className:"w-8 h-8"}),e.jsx("span",{className:"text-sm font-medium text-[var(--color-text-primary)]",children:s.user_name||"Anonymous"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:`text-base font-semibold ${N(s.score)}`,children:[s.score,"%"]}),e.jsxs("span",{className:"text-xs text-[var(--color-text-secondary)]",children:["(",Math.round(s.score/100*s.total_questions),"/",s.total_questions,")"]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("span",{className:"text-sm text-[var(--color-text-secondary)]",children:t(s.time_taken)})}),e.jsx("span",{className:"text-xs text-[var(--color-text-muted)]",children:v(s.created_at)})]})},s.id))}),x.length>=20&&e.jsx("div",{className:"mt-3 text-center",children:e.jsx(d,{variant:"ghost",size:"sm",onClick:u,children:"Load More"})})]})},oe=()=>{var I,C,q,P;const{quizId:i}=B(),{t:r}=M(),m=G(),{quizzes:x,addQuiz:j,setActiveQuiz:y,setQuizResult:g,currentUser:a,showSuccessNotification:p,showErrorNotification:u}=O(),[t,v]=n.useState(null),[N,s]=n.useState(!0),[b,h]=n.useState(null),[z,S]=n.useState(!1),[Q,k]=n.useState(!1);n.useEffect(()=>{(async()=>{if(s(!0),h(null),!i){h(r("sharedQuizNotFound")),s(!1);return}if(!A(i)&&i.length<30){h(r("sharedQuizNotFound")),s(!1);return}A(i)||c.warn("SharedQuizPage: Proceeding with potentially corrupted quiz ID","SharedQuizPage",{quizId:i});try{if(a){const D=x.find(Y=>Y.id===i);if(D){c.info("SharedQuizPage: Displaying quiz owned by current user.","SharedQuizPage",{quizId:i}),v(D),s(!1);return}}const l=await re(i,a);l?(c.info("SharedQuizPage: Quiz data fetched successfully.","SharedQuizPage",{quizId:i}),v(l)):(c.warn("SharedQuizPage: Quiz not found via getSharedQuiz.","SharedQuizPage",{quizId:i}),h(r("sharedQuizNotFound")))}catch(l){c.error("Error loading shared quiz:","SharedQuizPage",{quizId:i},l),h(r("sharedQuizLoadError"))}finally{s(!1)}})()},[i,x,r,a]);const _=async()=>{const o=window.location.href;try{await navigator.clipboard.writeText(o),S(!0),setTimeout(()=>S(!1),2e3)}catch(l){c.error("Failed to copy share link from SharedQuizPage:","SharedQuizPage",void 0,l)}},T=()=>{t&&(y(t),g(null),m(`/quiz/${t.id}`))},w=()=>!t||!a?!1:x.some(o=>o.title===t.title&&o.questions.length===t.questions.length),R=async()=>{if(!t||!a){u("Please log in to save quizzes");return}if(w()){u("This quiz is already saved to your collection");return}k(!0);try{const o={...t,id:se(),userId:a.id,createdAt:new Date().toISOString(),lastModified:new Date().toISOString(),isShared:!1,sharedTimestamp:void 0};j(o),p("Quiz saved to your collection!"),c.info("Shared quiz saved to user collection","SharedQuizPage",{originalQuizId:t.id,newQuizId:o.id,userId:a.id})}catch(o){c.error("Failed to save shared quiz","SharedQuizPage",{quizId:t.id},o),u("Failed to save quiz. Please try again.")}finally{k(!1)}};if(N)return e.jsx("div",{className:"min-h-[calc(100vh-200px)] flex items-center justify-center",children:e.jsx(F,{text:r("loading")+"...",size:"xl"})});if(b||!t)return e.jsx("div",{className:"container mx-auto px-4 py-8 sm:py-12",children:e.jsxs(f,{className:"max-w-lg mx-auto mt-10 sm:mt-16 p-8 text-center animate-fadeInUp shadow-2xl",useGlassEffect:!0,children:[e.jsx(W,{className:"w-16 h-16 text-[var(--color-danger-accent)] mx-auto mb-6"}),e.jsx("h2",{className:"text-2xl font-semibold text-[var(--color-text-primary)] mb-3",children:r("sharedQuizError")}),e.jsx("p",{className:"text-[var(--color-text-secondary)] mb-4",children:b||r("sharedQuizNotFound")}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[e.jsx(d,{variant:"primary",onClick:()=>m("/"),size:"lg",className:"py-3 px-8 rounded-xl",children:r("home")}),e.jsx(d,{variant:"outline",onClick:()=>m("/create"),size:"lg",className:"py-3 px-8 rounded-xl",children:r("createQuiz")})]})]})});const U=(I=t.config)!=null&&I.difficulty&&t.config.difficulty!=="AI-Determined"?r(`step2Difficulty${t.config.difficulty}`):((C=t.config)==null?void 0:C.difficulty)==="AI-Determined"?r("dashboardQuizCardDifficulty"):r("notSpecified"),$=(q=t.config)!=null&&q.language?t.config.language.toLowerCase()==="english"?r("step2LanguageEnglish"):r("step2LanguageVietnamese"):r("notSpecified"),H=t.createdAt?new Date(t.createdAt).toLocaleDateString():r("notSpecified"),V=t.lastModified?new Date(t.lastModified).toLocaleDateString():r("notSpecified");return e.jsxs("div",{className:"container mx-auto px-4 py-8 sm:py-12",children:[e.jsxs(f,{className:"max-w-3xl mx-auto shadow-2xl !rounded-2xl animate-fadeInUp",useGlassEffect:!0,children:[e.jsxs("div",{className:"border-b border-[var(--color-border-default)] pb-6 mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-[var(--color-text-primary)] leading-tight tracking-tight line-clamp-3",title:t.title,children:e.jsx(L,{text:t.title,markdownFormatting:!0})}),e.jsx(d,{variant:"outline",size:"sm",onClick:_,leftIcon:z?e.jsx(E,{className:"w-4 h-4 text-[var(--color-success-accent)]"}):e.jsx(Z,{className:"w-4 h-4"}),className:`!py-2 px-4 rounded-lg shadow-sm flex-shrink-0 ${z?"!border-[var(--color-success-accent)] !text-[var(--color-success-accent)]":"!border-[var(--color-border-interactive)] hover:!border-[var(--color-primary-accent)]"}`,children:r(z?"copied":"copyShareLink")})]}),((P=t.creator)==null?void 0:P.name)&&e.jsxs("div",{className:"flex items-center text-sm text-[var(--color-text-secondary)] mt-3",children:[e.jsx(J,{className:"w-4 h-4 mr-2 text-[var(--color-text-muted)]"}),e.jsxs("span",{children:[r("dashboardQuizCardCreated",{date:""})," ",t.creator.name]})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"flex justify-between items-center mb-5",children:e.jsx("h2",{className:"text-xl font-semibold text-[var(--color-text-primary)]",children:r("quizDetails")})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 text-center sm:text-left mb-4",children:[e.jsxs("div",{className:"bg-[var(--color-bg-surface-2)]/60 p-4 rounded-xl border border-[var(--color-border-default)] shadow-md",children:[e.jsx("p",{className:"text-xs font-semibold text-[var(--color-text-muted)] uppercase tracking-wider mb-1",children:r("numberOfQuestions")}),e.jsx("p",{className:"text-2xl font-bold text-[var(--color-text-primary)]",children:t.questions.length})]}),e.jsxs("div",{className:"bg-[var(--color-bg-surface-2)]/60 p-4 rounded-xl border border-[var(--color-border-default)] shadow-md",children:[e.jsx("p",{className:"text-xs font-semibold text-[var(--color-text-muted)] uppercase tracking-wider mb-1",children:r("difficulty")}),e.jsx("p",{className:"text-lg font-semibold text-[var(--color-text-primary)]",children:U})]}),e.jsxs("div",{className:"bg-[var(--color-bg-surface-2)]/60 p-4 rounded-xl border border-[var(--color-border-default)] shadow-md",children:[e.jsx("p",{className:"text-xs font-semibold text-[var(--color-text-muted)] uppercase tracking-wider mb-1",children:r("step2LanguageLabel")}),e.jsx("p",{className:"text-lg font-semibold text-[var(--color-text-primary)]",children:$})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 text-center sm:text-left",children:[e.jsxs("div",{className:"bg-[var(--color-bg-surface-2)]/60 p-4 rounded-xl border border-[var(--color-border-default)] shadow-md",children:[e.jsx("p",{className:"text-xs font-medium text-[var(--color-text-muted)] uppercase tracking-wider mb-1",children:"Created"}),e.jsx("p",{className:"text-sm text-[var(--color-text-primary)]",children:H})]}),e.jsxs("div",{className:"bg-[var(--color-bg-surface-2)]/60 p-4 rounded-xl border border-[var(--color-border-default)] shadow-md",children:[e.jsx("p",{className:"text-xs font-medium text-[var(--color-text-muted)] uppercase tracking-wider mb-1",children:"Last Modified"}),e.jsx("p",{className:"text-sm text-[var(--color-text-primary)]",children:V})]})]}),t.sourceContentSnippet&&e.jsxs("div",{className:"mt-4 bg-[var(--color-bg-surface-2)]/60 p-4 rounded-xl border border-[var(--color-border-default)] shadow-md",children:[e.jsx("p",{className:"text-xs font-medium text-[var(--color-text-muted)] uppercase tracking-wider mb-1",children:"Source Content"}),e.jsx("p",{className:"text-sm text-[var(--color-text-secondary)] line-clamp-3",children:t.sourceContentSnippet})]})]}),t.questions&&t.questions.length>0&&e.jsxs("div",{className:"mb-10",children:[e.jsx("h2",{className:"text-xl font-semibold text-[var(--color-text-primary)] mb-5",children:r("previewQuestions")}),e.jsx("div",{className:"space-y-4",children:t.questions.slice(0,3).map((o,l)=>e.jsxs("div",{className:"bg-[var(--color-bg-surface-2)]/60 p-4 sm:p-5 rounded-xl border border-[var(--color-border-default)] shadow-md",children:[e.jsxs("div",{className:"font-medium text-[var(--color-text-primary)] mb-2 text-sm sm:text-base",children:[e.jsxs("span",{className:"text-[var(--color-primary-accent)] mr-2 font-semibold",children:[l+1,"."]}),e.jsx(L,{text:o.questionText,markdownFormatting:!0})]}),l===2&&t.questions.length>3&&e.jsx("p",{className:"text-xs text-[var(--color-text-muted)] italic text-center mt-3",children:r("andMoreQuestions",{count:t.questions.length-3})}),l<2&&t.questions.length>1&&e.jsx("p",{className:"text-xs text-[var(--color-text-muted)] italic mt-2",children:r("moreQuestionsInQuiz")})]},o.id))})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-center items-center gap-4 pt-6 border-t border-[var(--color-border-default)]",children:[e.jsx(d,{variant:"primary",size:"lg",onClick:T,leftIcon:e.jsx(K,{className:"w-5 h-5"}),className:"w-full sm:w-auto py-3.5 px-10 rounded-xl bg-gradient-to-r from-[var(--color-primary-accent)] to-indigo-500 hover:from-[var(--color-primary-accent-hover)] hover:to-indigo-600 shadow-xl",children:r("takeQuizNow")}),a&&!w()&&e.jsx(d,{variant:"outline",size:"lg",onClick:R,disabled:Q,leftIcon:e.jsx(ee,{className:"w-5 h-5"}),className:"w-full sm:w-auto py-3.5 px-8 rounded-xl border-green-500/50 text-green-600 hover:bg-green-50 hover:border-green-500 dark:border-green-400/50 dark:text-green-400 dark:hover:bg-green-900/20",children:Q?"Saving...":"Save Quiz"}),a&&w()&&e.jsx(d,{variant:"outline",size:"lg",disabled:!0,leftIcon:e.jsx(E,{className:"w-5 h-5"}),className:"w-full sm:w-auto py-3.5 px-8 rounded-xl border-green-500/50 text-green-600 bg-green-50 dark:border-green-400/50 dark:text-green-400 dark:bg-green-900/20",children:"Already Saved"}),e.jsx(d,{variant:"outline",size:"lg",onClick:()=>m("/create"),leftIcon:e.jsx(te,{className:"w-5 h-5"}),className:"w-full sm:w-auto py-3.5 px-8 rounded-xl",children:r("createQuiz")})]})]}),t&&e.jsx("div",{className:"mt-6",children:e.jsx(ie,{quizId:t.id,isOwner:(a==null?void 0:a.id)===t.userId,currentUserId:a==null?void 0:a.id})})]})};oe.displayName="SharedQuizPage";export{oe as default};
