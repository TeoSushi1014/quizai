import{j as e}from"./ui-BGuvgkTr.js";import{f as W,u as X,r as c}from"./router-BxjC687J.js";import{c as Z,u as _,L as H,C,X as J,W as D,B as d,M as P,o as T,m as K,Y as ee,Z as te,w as re,q as ae,l,_ as se,$ as oe}from"./index-Du8ONRop.js";import"./vendor-DoC2WAmd.js";import"./utils-rUpm7H1u.js";import"./markdown-Bj7tmv2T.js";const ie=()=>{var w,I,q,k;const{quizId:a}=W(),{t:r}=Z(),m=X(),{quizzes:h,addQuiz:L,setActiveQuiz:E,setQuizResult:A,currentUser:i,showSuccessNotification:F,showErrorNotification:g}=_(),[t,p]=c.useState(null),[M,u]=c.useState(!0),[N,x]=c.useState(null),[v,j]=c.useState(!1),[y,n]=c.useState(""),[le,U]=c.useState(!1),[S,Q]=c.useState(!1);c.useEffect(()=>{(async()=>{if(u(!0),x(null),n(""),!a){l.warn("SharedQuizPage: No quizId in params.","SharedQuizPage"),x(r("sharedQuizNotFound")),n("No quiz ID provided in URL"),u(!1);return}if(!D(a)){l.warn("SharedQuizPage: Invalid quiz ID format.","SharedQuizPage",{quizId:a}),x(r("sharedQuizNotFound")),n(`Invalid quiz ID format: ${a}`),u(!1);return}try{if(i){const f=h.find(z=>z.id===a);if(f){l.info("SharedQuizPage: Displaying quiz owned by current user.","SharedQuizPage",{quizId:a}),p(f),n("Quiz found in user's collection"),u(!1);return}}const o=await se(a,i);if(o)l.info("SharedQuizPage: Quiz data fetched successfully.","SharedQuizPage",{quizId:a}),p(o),n("Quiz found via sharing mechanism");else{if(l.warn("SharedQuizPage: Quiz not found via getSharedQuiz.","SharedQuizPage",{quizId:a}),a==="a35130c9-2b62-4327-85f2-f1796c37c47a"){const z={id:a,title:"Test Shared Quiz",questions:[{id:"q1",questionText:"What is 2 + 2?",options:["3","4","5","6"],correctAnswer:"1",explanation:"Basic arithmetic: 2 + 2 = 4"},{id:"q2",questionText:"The earth is round.",options:["True","False"],correctAnswer:"0",explanation:"The Earth is approximately spherical."}],createdAt:new Date().toISOString(),lastModified:new Date().toISOString()};p(z),n("Test quiz created for demonstration"),u(!1);return}const f=`Quiz ${a} not found in Supabase. User logged in: ${i?"Yes":"No"}`;n(f),x(r("sharedQuizNotFound"))}}catch(o){l.error("Error loading shared quiz:","SharedQuizPage",{quizId:a},o),x(r("sharedQuizLoadError")),n(`Error: ${o.message}`)}finally{u(!1)}})()},[a,h,r,i]);const $=async()=>{const s=window.location.href;try{await navigator.clipboard.writeText(s),j(!0),setTimeout(()=>j(!1),2e3)}catch(o){l.error("Failed to copy share link from SharedQuizPage:","SharedQuizPage",void 0,o)}},O=()=>{t&&(E(t),A(null),m(`/quiz/${t.id}`))},b=()=>!t||!i?!1:h.some(s=>s.title===t.title&&s.questions.length===t.questions.length),B=async()=>{if(!t||!i){g("Please log in to save quizzes");return}if(b()){g("This quiz is already saved to your collection");return}Q(!0);try{const s={...t,id:oe(),userId:i.id,createdAt:new Date().toISOString(),lastModified:new Date().toISOString(),isShared:!1,sharedTimestamp:void 0};L(s),U(!0),F("Quiz saved to your collection!"),l.info("Shared quiz saved to user collection","SharedQuizPage",{originalQuizId:t.id,newQuizId:s.id,userId:i.id})}catch(s){l.error("Failed to save shared quiz","SharedQuizPage",{quizId:t.id},s),g("Failed to save quiz. Please try again.")}finally{Q(!1)}};if(M)return e.jsx("div",{className:"min-h-[calc(100vh-200px)] flex items-center justify-center",children:e.jsx(H,{text:r("loading")+"...",size:"xl"})});if(N||!t)return e.jsx("div",{className:"container mx-auto px-4 py-8 sm:py-12",children:e.jsxs(C,{className:"max-w-lg mx-auto mt-10 sm:mt-16 p-8 text-center animate-fadeInUp shadow-2xl",useGlassEffect:!0,children:[e.jsx(J,{className:"w-16 h-16 text-[var(--color-danger-accent)] mx-auto mb-6"}),e.jsx("h2",{className:"text-2xl font-semibold text-[var(--color-text-primary)] mb-3",children:r("sharedQuizError")}),e.jsx("p",{className:"text-[var(--color-text-secondary)] mb-4",children:N||r("sharedQuizNotFound")}),y&&e.jsxs("div",{className:"bg-[var(--color-bg-surface-2)] p-4 rounded-lg mb-6 text-left",children:[e.jsx("div",{className:"flex items-center mb-2",children:e.jsx("span",{className:"text-sm font-semibold text-[var(--color-text-primary)]",children:"Debug Information"})}),e.jsx("p",{className:"text-xs text-[var(--color-text-muted)] font-mono break-all",children:y}),a&&e.jsxs("p",{className:"text-xs text-[var(--color-text-muted)] font-mono mt-2",children:["Quiz ID: ",a,e.jsx("br",{}),"Valid Format: ",D(a)?"Yes":"No"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[e.jsx(d,{variant:"primary",onClick:()=>m("/"),size:"lg",className:"py-3 px-8 rounded-xl",children:r("home")}),e.jsx(d,{variant:"outline",onClick:()=>m("/create"),size:"lg",className:"py-3 px-8 rounded-xl",children:r("createQuiz")})]})]})});const R=(w=t.config)!=null&&w.difficulty&&t.config.difficulty!=="AI-Determined"?r(`step2Difficulty${t.config.difficulty}`):((I=t.config)==null?void 0:I.difficulty)==="AI-Determined"?r("dashboardQuizCardDifficulty"):r("notSpecified"),Y=(q=t.config)!=null&&q.language?t.config.language.toLowerCase()==="english"?r("step2LanguageEnglish"):r("step2LanguageVietnamese"):r("notSpecified"),G=t.createdAt?new Date(t.createdAt).toLocaleDateString():r("notSpecified"),V=t.lastModified?new Date(t.lastModified).toLocaleDateString():r("notSpecified");return e.jsx("div",{className:"container mx-auto px-4 py-8 sm:py-12",children:e.jsxs(C,{className:"max-w-3xl mx-auto shadow-2xl !rounded-2xl animate-fadeInUp",useGlassEffect:!0,children:[e.jsxs("div",{className:"border-b border-[var(--color-border-default)] pb-6 mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-[var(--color-text-primary)] leading-tight tracking-tight line-clamp-3",title:t.title,children:e.jsx(P,{text:t.title,markdownFormatting:!0})}),e.jsx(d,{variant:"outline",size:"sm",onClick:$,leftIcon:v?e.jsx(T,{className:"w-4 h-4 text-[var(--color-success-accent)]"}):e.jsx(K,{className:"w-4 h-4"}),className:`!py-2 px-4 rounded-lg shadow-sm flex-shrink-0 ${v?"!border-[var(--color-success-accent)] !text-[var(--color-success-accent)]":"!border-[var(--color-border-interactive)] hover:!border-[var(--color-primary-accent)]"}`,children:r(v?"copied":"copyShareLink")})]}),((k=t.creator)==null?void 0:k.name)&&e.jsxs("div",{className:"flex items-center text-sm text-[var(--color-text-secondary)] mt-3",children:[e.jsx(ee,{className:"w-4 h-4 mr-2 text-[var(--color-text-muted)]"}),e.jsxs("span",{children:[r("dashboardQuizCardCreated",{date:""})," ",t.creator.name]})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"flex justify-between items-center mb-5",children:e.jsx("h2",{className:"text-xl font-semibold text-[var(--color-text-primary)]",children:r("quizDetails")})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 text-center sm:text-left mb-4",children:[e.jsxs("div",{className:"bg-[var(--color-bg-surface-2)]/60 p-4 rounded-xl border border-[var(--color-border-default)] shadow-md",children:[e.jsx("p",{className:"text-xs font-semibold text-[var(--color-text-muted)] uppercase tracking-wider mb-1",children:r("numberOfQuestions")}),e.jsx("p",{className:"text-2xl font-bold text-[var(--color-text-primary)]",children:t.questions.length})]}),e.jsxs("div",{className:"bg-[var(--color-bg-surface-2)]/60 p-4 rounded-xl border border-[var(--color-border-default)] shadow-md",children:[e.jsx("p",{className:"text-xs font-semibold text-[var(--color-text-muted)] uppercase tracking-wider mb-1",children:r("difficulty")}),e.jsx("p",{className:"text-lg font-semibold text-[var(--color-text-primary)]",children:R})]}),e.jsxs("div",{className:"bg-[var(--color-bg-surface-2)]/60 p-4 rounded-xl border border-[var(--color-border-default)] shadow-md",children:[e.jsx("p",{className:"text-xs font-semibold text-[var(--color-text-muted)] uppercase tracking-wider mb-1",children:r("step2LanguageLabel")}),e.jsx("p",{className:"text-lg font-semibold text-[var(--color-text-primary)]",children:Y})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 text-center sm:text-left",children:[e.jsxs("div",{className:"bg-[var(--color-bg-surface-2)]/30 p-3 rounded-lg border border-[var(--color-border-default)]/50",children:[e.jsx("p",{className:"text-xs font-medium text-[var(--color-text-muted)] mb-1",children:"Created"}),e.jsx("p",{className:"text-sm text-[var(--color-text-primary)]",children:G})]}),e.jsxs("div",{className:"bg-[var(--color-bg-surface-2)]/30 p-3 rounded-lg border border-[var(--color-border-default)]/50",children:[e.jsx("p",{className:"text-xs font-medium text-[var(--color-text-muted)] mb-1",children:"Last Modified"}),e.jsx("p",{className:"text-sm text-[var(--color-text-primary)]",children:V})]})]}),t.sourceContentSnippet&&e.jsxs("div",{className:"mt-4 bg-[var(--color-bg-surface-2)]/30 p-4 rounded-lg border border-[var(--color-border-default)]/50",children:[e.jsx("p",{className:"text-xs font-medium text-[var(--color-text-muted)] mb-2",children:"Source Content"}),e.jsx("p",{className:"text-sm text-[var(--color-text-secondary)] line-clamp-3",children:t.sourceContentSnippet})]})]}),t.questions&&t.questions.length>0&&e.jsxs("div",{className:"mb-10",children:[e.jsx("h2",{className:"text-xl font-semibold text-[var(--color-text-primary)] mb-5",children:r("previewQuestions")}),e.jsx("div",{className:"space-y-4",children:t.questions.slice(0,3).map((s,o)=>e.jsxs("div",{className:"bg-[var(--color-bg-surface-2)]/60 p-4 sm:p-5 rounded-xl border border-[var(--color-border-default)] shadow-md",children:[e.jsxs("div",{className:"font-medium text-[var(--color-text-primary)] mb-2 text-sm sm:text-base",children:[e.jsxs("span",{className:"text-[var(--color-primary-accent)] mr-2 font-semibold",children:[o+1,"."]}),e.jsx(P,{text:s.questionText,markdownFormatting:!0})]}),o===2&&t.questions.length>3&&e.jsx("p",{className:"text-xs text-[var(--color-text-muted)] italic text-center mt-3",children:r("andMoreQuestions",{count:t.questions.length-3})}),o<2&&t.questions.length>1&&e.jsx("p",{className:"text-xs text-[var(--color-text-muted)] italic mt-2",children:r("moreQuestionsInQuiz")})]},s.id))})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-center items-center gap-4 pt-6 border-t border-[var(--color-border-default)]",children:[e.jsx(d,{variant:"primary",size:"lg",onClick:O,leftIcon:e.jsx(te,{className:"w-5 h-5"}),className:"w-full sm:w-auto py-3.5 px-10 rounded-xl bg-gradient-to-r from-[var(--color-primary-accent)] to-indigo-500 hover:from-[var(--color-primary-accent-hover)] hover:to-indigo-600 shadow-xl",children:r("takeQuizNow")}),i&&!b()&&e.jsx(d,{variant:"outline",size:"lg",onClick:B,disabled:S,leftIcon:e.jsx(re,{className:"w-5 h-5"}),className:"w-full sm:w-auto py-3.5 px-8 rounded-xl border-green-500/50 text-green-600 hover:bg-green-50 hover:border-green-500 dark:border-green-400/50 dark:text-green-400 dark:hover:bg-green-900/20",children:S?"Saving...":"Save Quiz"}),i&&b()&&e.jsx(d,{variant:"outline",size:"lg",disabled:!0,leftIcon:e.jsx(T,{className:"w-5 h-5"}),className:"w-full sm:w-auto py-3.5 px-8 rounded-xl border-green-500/50 text-green-600 bg-green-50 dark:border-green-400/50 dark:text-green-400 dark:bg-green-900/20",children:"Already Saved"}),e.jsx(d,{variant:"outline",size:"lg",onClick:()=>m("/create"),leftIcon:e.jsx(ae,{className:"w-5 h-5"}),className:"w-full sm:w-auto py-3.5 px-8 rounded-xl",children:r("createQuiz")})]})]})})};ie.displayName="SharedQuizPage";export{ie as default};
