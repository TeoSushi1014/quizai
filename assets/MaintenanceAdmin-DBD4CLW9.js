import{j as e}from"./ui-BGuvgkTr.js";import{r as n}from"./router-BxjC687J.js";import{a5 as y,l as f,C as N,f as B,h as L,e as M,B as v,O as A}from"./index-RewXCStj.js";import"./vendor-DoC2WAmd.js";import"./utils-rUpm7H1u.js";import"./markdown-s3HPJSPm.js";const O=()=>{const[t,k]=n.useState(null),[E,x]=n.useState(!0),[c,g]=n.useState(!1),[h,l]=n.useState(null),[u,p]=n.useState(null),[r,i]=n.useState({isEnabled:!1,message:"Hệ thống đang bảo trì. Vui lòng thử lại sau.",allowedEmails:""});n.useEffect(()=>{o()},[]);const o=async()=>{try{x(!0);const a=await y.getMaintenanceSettings();a&&(k(a),i({isEnabled:a.isEnabled,message:a.message,allowedEmails:a.allowedEmails.join(", ")}))}catch(a){l("Không thể tải cài đặt bảo trì"),f.error("Failed to load maintenance settings","MaintenanceAdmin",{},a)}finally{x(!1)}},w=async()=>{var a,s,b;try{g(!0),l(null),p(null);const d=await A.auth.getUser(),j=((a=d.data.user)==null?void 0:a.email)||"unknown",C=((b=(s=d.data.user)==null?void 0:s.user_metadata)==null?void 0:b.name)||j,T=r.allowedEmails.split(",").map(m=>m.trim()).filter(m=>m.length>0);await y.updateMaintenanceSettings(r.isEnabled,r.message,T,j,C)?(p("Cài đặt bảo trì đã được cập nhật thành công"),await o()):l("Không thể cập nhật cài đặt bảo trì")}catch(d){l("Có lỗi xảy ra khi cập nhật cài đặt"),f.error("Failed to update maintenance settings","MaintenanceAdmin",{},d)}finally{g(!1)}},S=a=>{i(s=>({...s,isEnabled:a}))};return E?e.jsx("div",{className:"p-4",children:"Đang tải cài đặt bảo trì..."}):e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Quản Lý Bảo Trì"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Trạng thái hiện tại:"}),e.jsx("span",{className:`px-2 py-1 text-xs rounded ${t!=null&&t.isEnabled?"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400":"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400"}`,children:t!=null&&t.isEnabled?"Đang Bảo Trì":"Hoạt Động"})]})]}),h&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-700 dark:text-red-400 px-4 py-3 rounded",children:h}),u&&e.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 text-green-700 dark:text-green-400 px-4 py-3 rounded",children:u}),e.jsxs(N,{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Bật Chế Độ Bảo Trì"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Khi bật, tất cả người dùng sẽ thấy trang bảo trì"})]}),e.jsx(B,{label:"",checked:r.isEnabled,onChange:S})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Thông Báo Bảo Trì"}),e.jsx(L,{value:r.message,onChange:a=>i(s=>({...s,message:a.target.value})),placeholder:"Nhập thông báo bảo trì...",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Email Được Phép Truy Cập (phân cách bằng dấu phẩy)"}),e.jsx(M,{value:r.allowedEmails,onChange:a=>i(s=>({...s,allowedEmails:a.target.value})),placeholder:"admin@example.com, support@example.com"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Những email này sẽ vẫn có thể truy cập hệ thống trong chế độ bảo trì"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(v,{onClick:o,variant:"outline",disabled:c,children:"Làm Mới"}),e.jsx(v,{onClick:w,disabled:c,children:c?"Đang Lưu...":"Lưu Cài Đặt"})]})]}),t&&e.jsxs(N,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Thông Tin Cập Nhật"}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Cập nhật lần cuối:"})," ",new Date(t.updatedAt).toLocaleString("vi-VN")]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Bởi:"})," ",t.updatedByName," (",t.updatedBy,")"]}),t.allowedEmails.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Email được phép:"})," ",t.allowedEmails.join(", ")]})]})]})]})};export{O as default};
