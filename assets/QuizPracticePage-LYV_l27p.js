import{i as _,A as ee,k as te,h as se,r as d,j as e,E as N,B as f,C as re,n as w,T as ie,F as ne,p as le,a6 as P,w as T,q as ae,x as ce,H as q,X as oe}from"./index-DiPvQfa0.js";import{u as de}from"./useQuizFlow-DkShBi2O.js";const ue=()=>{var B;const{t:r}=_(),{quizId:D}=ee(),y=te(),{setQuizResult:S}=se(),[n,Q]=d.useState(null),[c,O]=d.useState(!1),[j,F]=d.useState(null),[g,p]=d.useState([]),[A,G]=d.useState(!1),[k,W]=d.useState(!1),l=d.useRef(!1),X=d.useCallback(()=>{l.current||G(!0)},[]),{localActiveQuiz:a,currentQuestion:i,currentQuestionIndex:b,loading:L,timeLeft:C,goToNextQuestion:U,goToPreviousQuestion:E,formatTime:H,totalQuestions:v,shuffledQuestions:I,attemptSettings:z}=de(D,X),J="https://img.icons8.com/?size=256&id=eoxMN35Z6JKg&format=png";d.useEffect(()=>{I.length>0&&g.length===0&&p(I.map(s=>({questionId:s.id,selectedOption:null,isCorrect:null,firstTryCorrect:null,attempts:0})))},[I,g.length]),d.useEffect(()=>{if(l.current)return;let s=null,t=!1,o=null;if(i&&g.length>0){const u=g.find(x=>x.questionId===i.id);u&&(s=u.selectedOption,u.isCorrect!==null&&(t=!0,o=u.isCorrect))}Q(s),O(t),F(o)},[b,i,g]);const h=d.useCallback(()=>{if(l.current||!a)return;l.current=!0;let s=[...g];i&&n&&!c?s=s.map(m=>m.questionId===i.id?{...m,selectedOption:n,isCorrect:null,attempts:m.attempts||0}:m):i&&!n&&!c&&(s=s.map(m=>m.questionId===i.id?{...m,selectedOption:null,isCorrect:null}:m));const t=s.filter(m=>m.isCorrect===!0).length,o=s.map(m=>({questionId:m.questionId,answer:m.selectedOption||""})),u=a.questions.length>0?t/a.questions.length*100:0,x={quizId:a.id,score:parseFloat(u.toFixed(2)),answers:o,totalCorrect:t,totalQuestions:a.questions.length,timeTaken:z.timeLimit>0?z.timeLimit*60-(C||0):void 0,sourceMode:"practice",createdAt:new Date().toISOString()};S(x),W(!0)},[a,g,i,n,c,S,z.timeLimit,C]);d.useEffect(()=>{k&&l.current&&a&&y(`/results/${a.id}`)},[k,a,y]);const K=s=>{c||l.current||Q(s)},Z=()=>{if(!n||!i||l.current)return;const s=n===i.correctAnswer;O(!0),F(s),p(t=>t.map(o=>o.questionId===i.id?{...o,selectedOption:n,isCorrect:s,attempts:(o.attempts||0)+1,...(o.attempts||0)===0&&{firstTryCorrect:s}}:o))},M=d.useCallback(()=>{!a||!i||l.current||(n&&!c?p(s=>s.map(t=>t.questionId===i.id&&(t.selectedOption!==n||t.isCorrect===null)?{...t,selectedOption:n,isCorrect:t.isCorrect,attempts:t.attempts||0}:t)):!n&&!c&&p(s=>s.map(t=>t.questionId===i.id&&t.selectedOption!==null&&t.isCorrect===null?{...t,selectedOption:null}:t)),U()||h())},[a,i,U,h,n,c]),V=d.useCallback(()=>{!i||l.current||(n&&!c?p(s=>s.map(t=>t.questionId===i.id&&(t.selectedOption!==n||t.isCorrect===null)?{...t,selectedOption:n,isCorrect:t.isCorrect,attempts:t.attempts||0}:t)):!n&&!c&&p(s=>s.map(t=>t.questionId===i.id&&t.selectedOption!==null&&t.isCorrect===null?{...t,selectedOption:null}:t)),E())},[E,n,c,i]),$=d.useCallback(()=>{h()},[h]);if(k)return e.jsx("div",{className:"flex flex-col items-center justify-center p-8 min-h-[400px]",children:e.jsx(N,{text:r("quizPracticeEnding")||"Processing...",size:"lg"})});if(L||!a)return e.jsx(N,{text:r("quizTakingLoading"),className:"mt-24",size:"xl"});if(!i)return a&&v>0&&b>=v?(l.current||h(),e.jsx("div",{className:"flex flex-col items-center justify-center p-8 min-h-[400px]",children:e.jsx(N,{text:r("quizPracticeEnding")||"Completing practice...",size:"lg"})})):L?e.jsx(N,{text:r("quizTakingLoading"),className:"mt-24",size:"xl"}):(console.error("QuizPracticePage: currentQuestion is undefined, but not due to finishing. Quiz data might be missing or an error occurred."),e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 min-h-[400px]",children:[e.jsx(N,{text:r("error")+" - "+(r("quizTakingLoading")||"Processing..."),size:"lg"}),e.jsx(f,{onClick:()=>y("/dashboard"),className:"mt-4",children:r("resultsGoToDashboard")})]}));const Y=v>0?(b+1)/v*100:0,R=b===v-1;return e.jsxs(re,{className:"max-w-3xl mx-auto shadow-2xl !rounded-2xl animate-page-slide-fade-in",useGlassEffect:!0,children:[e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-[var(--color-text-primary)] mb-4 leading-tight tracking-tight line-clamp-2",title:a.title,children:e.jsx(w,{text:r("quizPracticeTitle",{quizTitle:a.title})})}),e.jsxs("div",{className:"flex justify-between items-center text-sm text-[var(--color-text-secondary)] mb-5",children:[e.jsx("span",{children:r("quizTakingQuestionProgress",{current:b+1,total:v})}),C!==null&&e.jsx("span",{className:`font-semibold ${C<=60?"text-red-400 animate-pulse":"text-[var(--color-primary-accent)]"}`,children:r("quizTakingTimeLeft",{time:H(C)})}),((B=a.config)==null?void 0:B.customUserPrompt)&&e.jsx(ie,{content:e.jsx("div",{className:"max-w-xs text-left text-xs",children:e.jsx(w,{text:a.config.customUserPrompt})}),placement:"bottom-end",children:e.jsx(ne,{className:"w-5 h-5 text-yellow-300 cursor-help"})})]}),e.jsx(le,{progress:Y,size:"lg",barClassName:"bg-gradient-to-r from-purple-500 to-pink-500"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"p-6 sm:p-8 bg-[var(--color-bg-surface-2)]/60 rounded-xl shadow-inner border border-[var(--color-border-default)] min-h-[200px] flex flex-col",children:e.jsxs("div",{className:"animate-fadeInUp",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-[var(--color-text-primary)] mb-8 leading-relaxed",children:e.jsx(w,{text:i.questionText})}),e.jsx("div",{className:"flex-grow",children:e.jsx("div",{className:"space-y-4",children:i.options.map((s,t)=>{const o=n===s;let u="bg-[var(--color-bg-surface-3)] hover:bg-[var(--color-bg-surface-3)]/70 border-[var(--color-border-interactive)] hover:border-[var(--color-primary-accent)] text-[var(--color-text-primary)]",x=e.jsx(q,{className:"w-6 h-6 text-[var(--color-text-muted)] group-hover:text-[var(--color-primary-accent)] transition-colors var(--duration-fast) var(--ease-ios)",strokeWidth:2.5});return c?o&&j?(u="bg-green-500/40 border-green-500 text-green-50 font-semibold scale-[1.01]",x=e.jsx(P,{className:"w-6 h-6 text-green-50",isFilled:!0})):o&&!j?(u="bg-red-500/40 border-red-500 text-red-50 font-semibold scale-[1.01]",x=e.jsx(oe,{className:"w-6 h-6 text-red-50"})):s===i.correctAnswer?(u="bg-green-500/30 border-green-600 text-green-100 opacity-90",x=e.jsx(P,{className:"w-6 h-6 text-green-100",isFilled:!1})):(u="bg-[var(--color-bg-surface-3)]/50 border-[var(--color-border-default)] text-[var(--color-text-muted)] opacity-70 cursor-not-allowed",x=e.jsx(q,{className:"w-6 h-6 text-[var(--color-text-muted)]/70",strokeWidth:2.5})):o&&(u="bg-[var(--color-primary-accent)]/50 border-[var(--color-primary-accent)] text-[var(--color-primary-accent-text)] font-semibold hover:bg-[var(--color-primary-accent)]/60 scale-[1.01]",x=e.jsx(q,{className:"w-6 h-6 text-[var(--color-primary-accent-text)]",isFilled:!0,strokeWidth:1})),e.jsxs("button",{onClick:()=>K(s),disabled:c||l.current,className:`w-full flex items-center text-left p-4 sm:p-4 rounded-xl border-2 focus:outline-none focus-visible:ring-4 focus-visible:ring-[var(--color-primary-accent)]/50 focus-visible:ring-offset-2 ${o?"focus-visible:ring-offset-[var(--color-bg-surface-1)]":"focus-visible:ring-offset-[var(--color-bg-surface-2)]"} shadow-lg
                                 transition-all var(--duration-fast) var(--ease-ios) will-change-transform, border, background-color
                                 ${u}`,"aria-pressed":o,children:[e.jsx("span",{className:"mr-3.5 flex-shrink-0",children:x}),e.jsx("span",{className:"text-sm sm:text-base flex-grow",children:e.jsx(w,{text:s})})]},`${s}-${t}`)})})})]},i.id)}),c&&e.jsxs("div",{className:"my-6 p-5 bg-[var(--color-bg-surface-1)]/40 rounded-xl border border-[var(--color-border-default)] animate-fadeInUp",children:[e.jsxs("p",{className:"flex items-start text-base font-semibold text-[var(--color-primary-accent)] mb-2.5",children:[e.jsx("img",{src:J,alt:r("resultsExplanationTitle"),className:"w-5 h-5 mr-3 flex-shrink-0 mt-0.5"}),r("resultsExplanationTitle")]}),e.jsx("div",{className:"text-[var(--color-text-body)]/90 text-sm leading-relaxed whitespace-pre-wrap break-words",children:e.jsx(w,{text:i.explanation||r("resultsNoExplanation")})})]})]}),e.jsxs("div",{className:"flex flex-col space-y-3 pt-6 border-t border-[var(--color-border-default)] mt-6 sm:mt-8",children:[c?e.jsxs(e.Fragment,{children:[j===!0&&e.jsx("p",{className:"text-center text-green-400 font-semibold text-lg animate-fadeIn",children:r("answerCorrect")}),j===!1&&e.jsx("p",{className:"text-center text-red-400 font-semibold text-lg animate-fadeIn",children:r("answerIncorrect")}),e.jsx(f,{onClick:M,variant:"primary",size:"lg",rightIcon:e.jsx(T,{className:"w-5 h-5"}),disabled:l.current,className:`w-full py-3 rounded-xl ${j?"bg-green-500 hover:bg-green-600":"bg-red-500 hover:bg-red-600"}`,children:r(R?"finishPractice":"nextQuestion")})]}):e.jsx(f,{onClick:Z,disabled:!n||l.current,variant:"primary",size:"lg",leftIcon:e.jsx(P,{className:"w-5 h-5"}),className:"w-full py-3 rounded-xl",children:r("checkAnswer")}),e.jsxs("div",{className:"flex justify-between items-center pt-3",children:[e.jsx(f,{onClick:V,disabled:b===0||l.current,variant:"outline",size:"md",leftIcon:e.jsx(ae,{className:"w-4 h-4"}),className:"py-2.5 px-5 rounded-lg",children:r("previous")}),!c&&(R?e.jsx(f,{onClick:h,disabled:l.current,variant:"outline",size:"md",rightIcon:e.jsx(T,{className:"w-4 h-4"}),className:"py-2.5 px-5 rounded-lg",children:r("finishPractice")}):e.jsx(f,{onClick:M,disabled:l.current,variant:"outline",size:"md",rightIcon:e.jsx(T,{className:"w-4 h-4"}),className:"py-2.5 px-5 rounded-lg",children:r("skipQuestion")})),c&&e.jsx(f,{onClick:h,disabled:l.current,variant:"outline",size:"md",className:"py-2.5 px-5 rounded-lg",children:r("finishPractice")})]})]}),A&&e.jsx(ce,{isOpen:A&&!l.current,onClose:$,title:r("timesUp"),size:"md",hideCloseButton:!0,footerContent:e.jsx("div",{className:"flex justify-center",children:e.jsx(f,{variant:"primary",onClick:$,size:"md",children:r("timesUpSubmit")})}),children:e.jsx("p",{className:"text-[var(--color-text-body)] text-base leading-relaxed text-center",children:r("timesUpMessage")})})]})};ue.displayName="QuizPracticePage";export{ue as default};
