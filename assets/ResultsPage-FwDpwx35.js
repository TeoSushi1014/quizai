import{h as O,i as A,A as J,k as X,J as Q,r as c,j as e,E as Y,m as i,X as N,B as d,C as k,n as u,p as H,N as T,O as K,Q as W,U as Z,D as _}from"./index-s5Pu3w2C.js";const w={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.4,ease:[.25,.1,.25,1]}}},D=({question:t,userAnswerText:f,isCorrect:n,index:v,sourceContentSnippet:s,explanationIconUrl:x,initiallyOpen:l})=>{const{t:r}=A(),a=Q();return e.jsx(i.div,{variants:w,initial:a?{opacity:1,y:0}:w.hidden,animate:w.visible,transition:{duration:a?.001:.4,ease:[.25,.1,.25,1]},children:e.jsx(Z,{initiallyOpen:l,containerClassName:`!rounded-xl shadow-lg ${n?"!border-green-500/60":"!border-red-500/60"}`,title:e.jsxs("div",{className:"flex items-center w-full gap-3",children:[e.jsxs("span",{className:"text-xs text-[var(--color-text-muted)] font-semibold",children:["Q",v+1,"."]}),e.jsx("span",{className:`flex-grow text-sm sm:text-base ${n?"text-[var(--color-text-secondary)]":"text-[var(--color-text-primary)] font-semibold"} min-w-0 break-words`,title:t.questionText,children:e.jsx(u,{text:t.questionText})})]}),titleClassName:`py-3.5 px-4 sm:px-5 rounded-t-xl ${n?"hover:!bg-green-400/15":"hover:!bg-red-400/15"}`,contentClassName:"!bg-[var(--color-bg-surface-2)]/30",children:e.jsxs("div",{className:"space-y-4 text-sm sm:text-base",children:[e.jsxs("p",{className:"text-[var(--color-text-secondary)]",children:[e.jsxs("strong",{className:"font-semibold text-[var(--color-text-primary)]",children:[r("resultsYourAnswer")," "]}),e.jsx("span",{className:`${n?"text-green-400 font-medium":"text-red-400 font-medium"} break-words`,children:e.jsx(u,{text:f||r("resultsNotAnswered")})})]}),!n&&e.jsxs("p",{className:"text-[var(--color-text-secondary)]",children:[e.jsxs("strong",{className:"font-semibold text-[var(--color-text-primary)]",children:[r("resultsCorrectAnswerMC")," "]}),e.jsx("span",{className:"text-green-400 font-medium break-words",children:e.jsx(u,{text:t.correctAnswer})})]}),e.jsxs("div",{className:"mt-5 pt-5 border-t border-[var(--color-border-default)]",children:[e.jsxs("p",{className:"flex items-start text-base font-semibold text-[var(--color-primary-accent)] mb-2.5",children:[e.jsx("img",{src:x,alt:r("resultsExplanationTitle"),className:"w-5 h-5 mr-3 flex-shrink-0 mt-0.5"}),r("resultsExplanationTitle")]}),e.jsx("div",{className:"text-[var(--color-text-body)]/90 leading-relaxed whitespace-pre-wrap break-words",children:e.jsx(u,{text:t.explanation||r("resultsNoExplanation")})})]}),s&&e.jsxs("details",{className:"mt-5 pt-5 border-t border-[var(--color-border-default)]",children:[e.jsxs("summary",{className:"text-xs text-[var(--color-text-muted)] cursor-pointer hover:text-[var(--color-primary-accent)] flex items-center font-semibold group transition-colors var(--duration-fast) var(--ease-ios)",children:[" ",e.jsx(_,{className:"w-4 h-4 mr-2.5 text-[var(--color-text-muted)] group-hover:text-[var(--color-primary-accent)] transition-colors var(--duration-fast) var(--ease-ios)",strokeWidth:2})," ",r("resultsViewSourceSnippet")," "]}),e.jsx("blockquote",{className:"mt-3 text-xs text-[var(--color-text-muted)]/80 max-h-36 overflow-y-auto p-3.5 bg-[var(--color-bg-surface-2)]/60 border border-[var(--color-border-default)] rounded-lg shadow-inner italic",children:e.jsx(u,{text:s})})]})]})})})};D.displayName="QuestionResultItem";const ee=t=>({hidden:{opacity:t?1:0},visible:{opacity:1,transition:{staggerChildren:t?0:.1,duration:t?.001:.3,ease:[.25,.1,.25,1]}}}),te=t=>({hidden:{opacity:t?1:0,y:t?0:20},visible:{opacity:1,y:0,transition:{duration:t?.001:.4,ease:[.25,.1,.25,1]}}}),se=t=>({hidden:{opacity:t?1:0},visible:{opacity:1,transition:{staggerChildren:t?0:.075}}}),re=()=>{const{quizResult:t,isLoading:f,getQuizByIdFromAll:n,setActiveQuiz:v}=O(),{t:s}=A(),{quizId:x}=J(),l=X(),r=Q(),[a,y]=c.useState(null),[R,p]=c.useState(!0),[z,b]=c.useState(null),E=c.useMemo(()=>ee(r),[r]),h=c.useMemo(()=>te(r),[r]),S=c.useMemo(()=>se(r),[r]);if(c.useEffect(()=>{if(p(!0),b(null),f)return;if(!t){console.warn(`ResultsPage: App context loaded, but quizResult is null. Param quizId from URL: ${x}.`),b(s("resultsErrorNotFound",{quizId:x||"unknown"})),y(null),p(!1);return}if(!t.quizId){console.error("ResultsPage: quizResult object exists but quizResult.quizId is missing. Invalid state."),b(s("resultsErrorNotFound",{quizId:"unknown"})),y(null),p(!1);return}const o=n(t.quizId);o?(y(o),v(o),p(!1)):(console.error(`ResultsPage: Quiz ${t.quizId} not found in fully loaded quizzes list.`),b(s("resultsErrorNotFound",{quizId:t.quizId})),y(null),p(!1))},[t,n,v,x,f,s]),R)return e.jsx("div",{className:"flex flex-col items-center justify-center min-h-[calc(100vh-380px)] text-center p-5",children:e.jsx(Y,{text:s("resultsLoading"),className:"mb-10",size:"xl"})});if(z)return e.jsxs(i.div,{initial:r?{opacity:1,y:0}:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:r?.001:.4,ease:[.25,.1,.25,1]},className:"flex flex-col items-center justify-center min-h-[calc(100vh-380px)] text-center p-5",children:[e.jsx(N,{className:"w-16 h-16 mb-6 text-[var(--color-danger-accent)]"}),e.jsx("p",{className:"text-xl font-semibold text-[var(--color-text-primary)] mb-3",children:s("error")}),e.jsx("p",{className:"text-base text-[var(--color-text-secondary)] mb-10 max-w-md",children:z}),e.jsxs(d,{onClick:()=>l("/dashboard"),variant:"secondary",size:"lg",className:"py-3 px-7 rounded-xl",children:[" ",s("resultsGoToDashboard")," "]})]});if(!t||!a)return console.error("ResultsPage: Reached render stage where quizResult or currentDisplayQuiz is unexpectedly null despite no explicit error state and not loading."),e.jsxs(i.div,{initial:r?{opacity:1,y:0}:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:r?.001:.4,ease:[.25,.1,.25,1]},className:"flex flex-col items-center justify-center min-h-[calc(100vh-380px)] text-center p-5",children:[e.jsx(N,{className:"w-16 h-16 mb-6 text-[var(--color-danger-accent)]"}),e.jsx("p",{className:"text-xl font-semibold text-[var(--color-text-primary)] mb-3",children:s("error")}),e.jsxs("p",{className:"text-base text-[var(--color-text-secondary)] mb-10 max-w-md",children:[s("resultsErrorNotFound",{quizId:x||"unknown"})," (Unexpected)"]}),e.jsxs(d,{onClick:()=>l("/dashboard"),variant:"secondary",size:"lg",className:"py-3.5 px-8 rounded-xl",children:[" ",s("resultsGoToDashboard")," "]})]});if(a.id!==t.quizId)return console.error("ResultsPage: Mismatch between currentDisplayQuiz.id and quizResult.quizId. This indicates a critical state inconsistency."),e.jsxs(i.div,{initial:r?{opacity:1,y:0}:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:r?.001:.4,ease:[.25,.1,.25,1]},className:"flex flex-col items-center justify-center min-h-[calc(100vh-380px)] text-center p-5",children:[e.jsx(N,{className:"w-16 h-16 mb-6 text-[var(--color-danger-accent)]"}),e.jsx("p",{className:"text-xl font-semibold mb-4 text-[var(--color-danger-accent)]",children:"Critical Error: Data Mismatch"}),e.jsxs("p",{className:"text-sm text-[var(--color-text-muted)]",children:["Displayed Quiz ID: ",a.id,", Result Quiz ID: ",t.quizId]}),e.jsxs(d,{onClick:()=>l("/dashboard"),variant:"secondary",size:"lg",className:"py-3.5 px-8 rounded-xl mt-6",children:[" ",s("resultsGoToDashboard")," "]})]});const{score:m,answers:P,totalCorrect:$,totalQuestions:F,sourceMode:j}=t,L=(o,g)=>g?g.trim()===o.correctAnswer.trim():!1,V=m>=70?"text-green-400":m>=40?"text-amber-400":"text-red-400",M=m>=70?"bg-gradient-to-r from-green-400 to-emerald-400":m>=40?"bg-gradient-to-r from-amber-400 to-yellow-400":"bg-gradient-to-r from-red-400 to-rose-400",B="https://img.icons8.com/?size=256&id=eoxMN35Z6JKg&format=png",G=j==="practice"?s("practiceSummaryTitle",{quizTitle:a.title}):s("resultsTitle",{quizTitle:a.title});return e.jsx(i.div,{initial:"hidden",animate:"visible",variants:E,children:e.jsxs(k,{className:"max-w-4xl mx-auto shadow-2xl !rounded-2xl",useGlassEffect:!0,children:[e.jsx(i.h1,{variants:h,className:"text-3xl sm:text-4xl font-bold text-[var(--color-text-primary)] mb-4 text-center leading-tight tracking-tight line-clamp-2",title:a.title,children:e.jsx(u,{text:G})}),e.jsx(i.p,{variants:h,className:"text-base text-[var(--color-text-secondary)] mb-12 text-center",children:s(j==="practice"?"practiceSummarySubtitle":"resultsSubtitle")}),e.jsx(i.div,{variants:h,children:e.jsxs(k,{className:"mb-12 !bg-[var(--color-bg-surface-2)]/70 shadow-xl !border-[var(--color-border-default)] p-0 overflow-hidden !rounded-2xl",useGlassEffect:!1,children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-around items-center text-center gap-8 p-6 sm:p-10 !bg-[var(--color-bg-surface-1)]/60",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("p",{className:"text-sm text-[var(--color-text-muted)] uppercase tracking-wider font-medium mb-1.5",children:s("resultsYourScore")}),e.jsxs("p",{className:`text-6xl sm:text-7xl font-extrabold ${V} tracking-tight`,children:[m.toFixed(0),e.jsx("span",{className:"text-4xl",children:"%"})]})]}),e.jsx("div",{className:"w-full md:w-px h-px md:h-24 bg-[var(--color-border-default)] my-3 md:my-0"}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("p",{className:"text-sm text-[var(--color-text-muted)] uppercase tracking-wider font-medium mb-1.5",children:s("resultsCorrectAnswers")}),e.jsxs("p",{className:"text-5xl sm:text-6xl font-bold text-[var(--color-text-primary)]",children:[$," ",e.jsxs("span",{className:"text-3xl text-[var(--color-text-muted)]/80",children:["/ ",F]})]})]})]}),e.jsx(H,{progress:m,className:"w-full rounded-b-2xl overflow-hidden",size:"lg",barClassName:`${M} !h-3.5`,showPercentage:!1})]})}),e.jsx(i.h2,{variants:h,className:"text-2xl sm:text-3xl font-semibold text-[var(--color-text-primary)] mb-8 sm:mb-10",children:s("resultsBreakdownTitle")}),e.jsx(i.div,{variants:S,initial:"hidden",animate:"visible",className:"space-y-5",children:Array.isArray(a.questions)&&a.questions.map((o,g)=>{const I=P.find(U=>U.questionId===o.id),C=I?I.answer:"",q=L(o,C);return e.jsx(D,{question:o,userAnswerText:C,isCorrect:q,index:g,sourceContentSnippet:a.sourceContentSnippet,explanationIconUrl:B,initiallyOpen:!q},o.id)})}),e.jsxs(i.div,{variants:h,className:"mt-14 flex flex-col sm:flex-row justify-center items-center gap-4 sm:gap-5",children:[j==="practice"?e.jsx(d,{onClick:()=>l(`/practice/${a.id}`),variant:"outline",size:"lg",leftIcon:e.jsx(T,{className:"w-5 h-5"}),className:"w-full sm:w-auto py-3 px-8 rounded-xl",children:s("practiceAgain")}):e.jsx(d,{onClick:()=>l(`/quiz/${a.id}`),variant:"outline",size:"lg",leftIcon:e.jsx(T,{className:"w-5 h-5"}),className:"w-full sm:w-auto py-3 px-8 rounded-xl",children:s("resultsTryAgain")}),e.jsx(d,{onClick:()=>l("/dashboard"),variant:"secondary",size:"lg",leftIcon:e.jsx(K,{className:"w-5 h-5"}),className:"w-full sm:w-auto py-3 px-8 rounded-xl",children:s("resultsBackToDashboard")}),e.jsx(d,{onClick:()=>l("/create"),variant:"primary",size:"lg",leftIcon:e.jsx(W,{className:"w-5 h-5"}),className:"w-full sm:w-auto bg-gradient-to-r from-[var(--color-primary-accent)] to-indigo-500 hover:from-[var(--color-primary-accent-hover)] hover:to-indigo-600 text-white shadow-xl py-3 px-8 rounded-xl",children:s("resultsCreateNewQuiz")})]})]})})};re.displayName="ResultsPage";export{re as default};
