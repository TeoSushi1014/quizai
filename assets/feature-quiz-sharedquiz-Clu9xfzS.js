import{r as e,j as r}from"./core-react-DcE6uGcR.js";import{a as t,u as a,L as s,C as i,i as o,B as l,f as d,c as n,d as c,q as u,E as m,W as x,O as h,n as f}from"./app-components-CFPFxe5x.js";import{l as p,p as g}from"./services-BHj8px4z.js";import{a as v,b}from"./feature-quiz-2SquOiTn.js";import{c as j}from"./feature-quiz-components-CChsAlA6.js";import{d as z,a as y}from"./router-Dk7yDelZ.js";function N(e){const r=[];for(const t of e)v(t.id)?r.push(t):t.id.startsWith("new-quiz-")?p.warn("Found legacy quiz with old ID format","QuizValidation",{quizId:t.id,title:t.title}):p.warn("Found quiz with invalid UUID","QuizValidation",{quizId:t.id,title:t.title});return r}function w(e){return v(e)}const S=()=>{var v,N,S,Q;const{quizId:q}=z(),{t:I}=t(),k=y(),{quizzes:P,addQuiz:C,setActiveQuiz:D,setQuizResult:L,currentUser:F,showSuccessNotification:E,showErrorNotification:A}=a(),[O,M]=e.useState(null),[T,U]=e.useState(!0),[_,V]=e.useState(null),[G,W]=e.useState(!1),[$,B]=e.useState(!1);e.useEffect(()=>{(async()=>{if(U(!0),V(null),!q)return V(I("sharedQuizNotFound")),void U(!1);if(!w(q)&&q.length<30)return V(I("sharedQuizNotFound")),void U(!1);w(q)||p.warn("SharedQuizPage: Proceeding with potentially corrupted quiz ID","SharedQuizPage",{quizId:q});try{if(F){const e=P.find(e=>e.id===q);if(e)return p.info("SharedQuizPage: Displaying quiz owned by current user.","SharedQuizPage",{quizId:q}),M(e),void U(!1)}const e=await g(q,F);e?(p.info("SharedQuizPage: Quiz data fetched successfully.","SharedQuizPage",{quizId:q}),M(e)):(p.warn("SharedQuizPage: Quiz not found via getSharedQuiz.","SharedQuizPage",{quizId:q}),V(I("sharedQuizNotFound")))}catch(e){p.error("Error loading shared quiz:","SharedQuizPage",{quizId:q},e),V(I("sharedQuizLoadError"))}finally{U(!1)}})()},[q,P,I,F]);const R=()=>!(!O||!F)&&P.some(e=>e.title===O.title&&e.questions.length===O.questions.length);if(T)return r.jsx("div",{className:"min-h-[calc(100vh-200px)] flex items-center justify-center",children:r.jsx(s,{text:I("loading")+"...",size:"xl"})});if(_||!O)return r.jsx("div",{className:"container mx-auto px-4 py-8 sm:py-12",children:r.jsxs(i,{className:"max-w-lg mx-auto mt-10 sm:mt-16 p-8 text-center animate-fadeInUp shadow-2xl",useGlassEffect:!0,children:[r.jsx(o,{className:"w-16 h-16 text-[var(--color-danger-accent)] mx-auto mb-6"}),r.jsx("h2",{className:"text-2xl font-semibold text-[var(--color-text-primary)] mb-3",children:I("sharedQuizError")}),r.jsx("p",{className:"text-[var(--color-text-secondary)] mb-4",children:_||I("sharedQuizNotFound")}),r.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[r.jsx(l,{variant:"primary",onClick:()=>k("/"),size:"lg",className:"py-3 px-8 rounded-xl",children:I("home")}),r.jsx(l,{variant:"outline",onClick:()=>k("/create"),size:"lg",className:"py-3 px-8 rounded-xl",children:I("createQuiz")})]})]})});const H=(null==(v=O.config)?void 0:v.difficulty)&&"AI-Determined"!==O.config.difficulty?I(`step2Difficulty${O.config.difficulty}`):"AI-Determined"===(null==(N=O.config)?void 0:N.difficulty)?I("dashboardQuizCardDifficulty"):I("notSpecified"),J=(null==(S=O.config)?void 0:S.language)?"english"===O.config.language.toLowerCase()?I("step2LanguageEnglish"):I("step2LanguageVietnamese"):I("notSpecified"),K=O.createdAt?new Date(O.createdAt).toLocaleDateString():I("notSpecified"),X=O.lastModified?new Date(O.lastModified).toLocaleDateString():I("notSpecified");return r.jsxs("div",{className:"container mx-auto px-4 py-8 sm:py-12",children:[r.jsxs(i,{className:"max-w-3xl mx-auto shadow-2xl !rounded-2xl animate-fadeInUp",useGlassEffect:!0,children:[r.jsxs("div",{className:"border-b border-[var(--color-border-default)] pb-6 mb-6",children:[r.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[r.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-[var(--color-text-primary)] leading-tight tracking-tight line-clamp-3",title:O.title,children:r.jsx(d,{text:O.title,markdownFormatting:!0})}),r.jsx(l,{variant:"outline",size:"sm",onClick:async()=>{const e=window.location.href;try{await navigator.clipboard.writeText(e),W(!0),setTimeout(()=>W(!1),2e3)}catch(r){p.error("Failed to copy share link from SharedQuizPage:","SharedQuizPage",void 0,r)}},leftIcon:G?r.jsx(n,{className:"w-4 h-4 text-[var(--color-success-accent)]"}):r.jsx(c,{className:"w-4 h-4"}),className:"!py-2 px-4 rounded-lg shadow-sm flex-shrink-0 "+(G?"!border-[var(--color-success-accent)] !text-[var(--color-success-accent)]":"!border-[var(--color-border-interactive)] hover:!border-[var(--color-primary-accent)]"),children:I(G?"copied":"copyShareLink")})]}),(null==(Q=O.creator)?void 0:Q.name)&&r.jsxs("div",{className:"flex items-center text-sm text-[var(--color-text-secondary)] mt-3",children:[r.jsx(u,{className:"w-4 h-4 mr-2 text-[var(--color-text-muted)]"}),r.jsxs("span",{children:[I("dashboardQuizCardCreated",{date:""})," ",O.creator.name]})]})]}),r.jsxs("div",{className:"mb-8",children:[r.jsx("div",{className:"flex justify-between items-center mb-5",children:r.jsx("h2",{className:"text-xl font-semibold text-[var(--color-text-primary)]",children:I("quizDetails")})}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 text-center sm:text-left mb-4",children:[r.jsxs("div",{className:"bg-[var(--color-bg-surface-2)]/60 p-4 rounded-xl border border-[var(--color-border-default)] shadow-md",children:[r.jsx("p",{className:"text-xs font-semibold text-[var(--color-text-muted)] uppercase tracking-wider mb-1",children:I("numberOfQuestions")}),r.jsx("p",{className:"text-2xl font-bold text-[var(--color-text-primary)]",children:O.questions.length})]}),r.jsxs("div",{className:"bg-[var(--color-bg-surface-2)]/60 p-4 rounded-xl border border-[var(--color-border-default)] shadow-md",children:[r.jsx("p",{className:"text-xs font-semibold text-[var(--color-text-muted)] uppercase tracking-wider mb-1",children:I("difficulty")}),r.jsx("p",{className:"text-lg font-semibold text-[var(--color-text-primary)]",children:H})]}),r.jsxs("div",{className:"bg-[var(--color-bg-surface-2)]/60 p-4 rounded-xl border border-[var(--color-border-default)] shadow-md",children:[r.jsx("p",{className:"text-xs font-semibold text-[var(--color-text-muted)] uppercase tracking-wider mb-1",children:I("step2LanguageLabel")}),r.jsx("p",{className:"text-lg font-semibold text-[var(--color-text-primary)]",children:J})]})]}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 text-center sm:text-left",children:[r.jsxs("div",{className:"bg-[var(--color-bg-surface-2)]/60 p-4 rounded-xl border border-[var(--color-border-default)] shadow-md",children:[r.jsx("p",{className:"text-xs font-medium text-[var(--color-text-muted)] uppercase tracking-wider mb-1",children:"Created"}),r.jsx("p",{className:"text-sm text-[var(--color-text-primary)]",children:K})]}),r.jsxs("div",{className:"bg-[var(--color-bg-surface-2)]/60 p-4 rounded-xl border border-[var(--color-border-default)] shadow-md",children:[r.jsx("p",{className:"text-xs font-medium text-[var(--color-text-muted)] uppercase tracking-wider mb-1",children:"Last Modified"}),r.jsx("p",{className:"text-sm text-[var(--color-text-primary)]",children:X})]})]}),O.sourceContentSnippet&&r.jsxs("div",{className:"mt-4 bg-[var(--color-bg-surface-2)]/60 p-4 rounded-xl border border-[var(--color-border-default)] shadow-md",children:[r.jsx("p",{className:"text-xs font-medium text-[var(--color-text-muted)] uppercase tracking-wider mb-1",children:"Source Content"}),r.jsx("p",{className:"text-sm text-[var(--color-text-secondary)] line-clamp-3",children:O.sourceContentSnippet})]})]}),O.questions&&O.questions.length>0&&r.jsxs("div",{className:"mb-10",children:[r.jsx("h2",{className:"text-xl font-semibold text-[var(--color-text-primary)] mb-5",children:I("previewQuestions")}),r.jsx("div",{className:"space-y-4",children:O.questions.slice(0,3).map((e,t)=>r.jsxs("div",{className:"bg-[var(--color-bg-surface-2)]/60 p-4 sm:p-5 rounded-xl border border-[var(--color-border-default)] shadow-md",children:[r.jsxs("div",{className:"font-medium text-[var(--color-text-primary)] mb-2 text-sm sm:text-base",children:[r.jsxs("span",{className:"text-[var(--color-primary-accent)] mr-2 font-semibold",children:[t+1,"."]}),r.jsx(m,{content:e.questionText})]}),2===t&&O.questions.length>3&&r.jsx("p",{className:"text-xs text-[var(--color-text-muted)] italic text-center mt-3",children:I("andMoreQuestions",{count:O.questions.length-3})}),t<2&&O.questions.length>1&&r.jsx("p",{className:"text-xs text-[var(--color-text-muted)] italic mt-2",children:I("moreQuestionsInQuiz")})]},e.id))})]}),r.jsxs("div",{className:"flex flex-col sm:flex-row justify-center items-center gap-4 pt-6 border-t border-[var(--color-border-default)]",children:[r.jsx(l,{variant:"primary",size:"lg",onClick:()=>{O&&(D(O),L(null),k(`/quiz/${O.id}`))},leftIcon:r.jsx(x,{className:"w-5 h-5"}),className:"w-full sm:w-auto py-3.5 px-10 rounded-xl bg-gradient-to-r from-[var(--color-primary-accent)] to-indigo-500 hover:from-[var(--color-primary-accent-hover)] hover:to-indigo-600 shadow-xl",children:I("takeQuizNow")}),F&&!R()&&r.jsx(l,{variant:"outline",size:"lg",onClick:async()=>{if(O)if(F&&R())A("This quiz is already saved to your collection");else{B(!0);try{const e={...O,id:b(),userId:(null==F?void 0:F.id)||"anonymous",createdAt:(new Date).toISOString(),lastModified:(new Date).toISOString(),isShared:!1,sharedTimestamp:void 0};C(e),E("Quiz saved to your collection!"),p.info("Shared quiz saved to user collection","SharedQuizPage",{originalQuizId:O.id,newQuizId:e.id,userId:(null==F?void 0:F.id)||"anonymous",anonymous:!F})}catch(e){p.error("Failed to save shared quiz","SharedQuizPage",{quizId:O.id},e),A("Failed to save quiz. Please try again.")}finally{B(!1)}}else A("Cannot save this quiz")},disabled:$,leftIcon:r.jsx(h,{className:"w-5 h-5"}),className:"w-full sm:w-auto py-3.5 px-8 rounded-xl border-green-500/50 text-green-600 hover:bg-green-50 hover:border-green-500 dark:border-green-400/50 dark:text-green-400 dark:hover:bg-green-900/20",children:$?"Saving...":"Save Quiz"}),F&&R()&&r.jsx(l,{variant:"outline",size:"lg",disabled:!0,leftIcon:r.jsx(n,{className:"w-5 h-5"}),className:"w-full sm:w-auto py-3.5 px-8 rounded-xl border-green-500/50 text-green-600 bg-green-50 dark:border-green-400/50 dark:text-green-400 dark:bg-green-900/20",children:"Already Saved"}),r.jsx(l,{variant:"outline",size:"lg",onClick:()=>k("/create"),leftIcon:r.jsx(f,{className:"w-5 h-5"}),className:"w-full sm:w-auto py-3.5 px-8 rounded-xl",children:I("createQuiz")})]})]}),O&&r.jsx("div",{className:"mt-6",children:r.jsx(j,{quizId:O.id,isOwner:(null==F?void 0:F.id)===O.userId,currentUserId:null==F?void 0:F.id})})]})};S.displayName="SharedQuizPage";const Q=Object.freeze(Object.defineProperty({__proto__:null,default:S},Symbol.toStringTag,{value:"Module"}));export{Q as S,N as a,w as v};
