import{r as e,j as s}from"./core-react-DcE6uGcR.js";import{a,u as r,M as t,I as i,B as l,c as o,d as c,L as n,F as d,X as m,e as x,S as u,C as h,f as p,T as v,H as g,P as b,D as f,h as j,i as N,j as w,E as y,U as k}from"./app-components-CFPFxe5x.js";import{s as C,l as z,c as S}from"./services-BHj8px4z.js";import{a as L}from"./router-Dk7yDelZ.js";import{m as q}from"./ui-framework-CdNWeEQR.js";const Q=new Map,M=({isOpen:h,onClose:p,quiz:v})=>{const{t:g}=a(),{currentUser:b,showErrorNotification:f}=r(),[j,N]=e.useState(""),[w,y]=e.useState(!1),[k,S]=e.useState(!1),[L,q]=e.useState(null),M=e.useRef(!1);e.useEffect(()=>{let e=!0;return(async()=>{if(!M.current)if(h&&v){if(!b)return q("Please log in to share quizzes"),void f("Please log in to share quizzes");if(!w&&!L){const a=Q.get(v.id);if(a)return void N(a);M.current=!0,y(!0),S(!1),q(null);try{const s=await C(v,b);e&&(N(s.shareUrl),Q.set(v.id,s.shareUrl))}catch(s){z.error("Error generating share URL in Modal:","ShareModal",{quizId:v.id},s),e&&(s.message.includes("properly authenticated with Supabase")?q("Please sign in again to share quizzes"):q(g("dashboardShareLinkFailed")),N(""))}finally{e&&y(!1),M.current=!1}}}else h||(y(!1),S(!1),q(null),M.current=!1)})(),()=>{e=!1,M.current=!1}},[h,null==v?void 0:v.id,b,g,f]);const I=e=>{if(!j||w||L)return;let s="";const a=encodeURIComponent(v.title),r=encodeURIComponent(j);switch(e){case"facebook":s=`https://www.facebook.com/sharer/sharer.php?u=${r}&quote=${a}`;break;case"twitter":s=`https://twitter.com/intent/tweet?url=${r}&text=${a}`;break;case"linkedin":s=`https://www.linkedin.com/sharing/share-offsite/?url=${r}`}window.open(s,"_blank","noopener,noreferrer")};return s.jsxs(t,{isOpen:h,onClose:p,title:s.jsxs("div",{className:"flex items-center",children:[s.jsx(u,{className:"w-5 h-5 mr-2.5 text-[var(--color-primary-accent)]"}),g("shareQuizTitle")]}),size:"md",useSolidBackground:!0,children:[s.jsxs("div",{className:"space-y-6 py-2",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-[var(--color-text-secondary)] mb-2",children:g("shareQuizDescription")}),s.jsxs("div",{className:"flex items-center gap-2.5",children:[s.jsx(i,{value:w?"":L||j,readOnly:!0,disabled:w||!!L,placeholder:g(w?"generatingShareLink":L?"dashboardShareLinkFailed":"shareUrlPlaceholder"),className:"flex-grow !py-2.5",inputClassName:"text-sm "+(L?"text-[var(--color-danger-accent)]":""),error:L||void 0}),s.jsx(l,{variant:"outline",onClick:async()=>{if(j&&!w&&!L)try{await navigator.clipboard.writeText(j),S(!0),setTimeout(()=>S(!1),2500)}catch(e){z.error("Failed to copy link:","ShareModal",void 0,e)}},disabled:w||!j||!!L,leftIcon:k?s.jsx(o,{className:"w-4 h-4 text-[var(--color-success-accent)]"}):s.jsx(c,{className:"w-4 h-4"}),className:"!py-2.5 px-4 rounded-lg "+(k?"!border-[var(--color-success-accent)] !text-[var(--color-success-accent)]":"!border-[var(--color-border-interactive)] hover:!border-[var(--color-primary-accent)]"),tooltip:g(k?"copied":"copy"),children:g(k?"copied":"copy")})]}),w&&s.jsx(n,{size:"xs",text:g("generatingShareLink"),className:"!py-2 !items-start !text-left !pl-1",textClassName:"!text-xs"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-[var(--color-text-secondary)] mb-3",children:g("shareOnSocial")}),s.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[s.jsx(l,{variant:"outline",onClick:()=>I("facebook"),disabled:w||!j||!!L,className:"w-full !p-2.5 rounded-lg bg-[#1877F2]/10 text-[#1877F2] border-[#1877F2]/30 hover:bg-[#1877F2]/20 hover:border-[#1877F2]/50 flex items-center justify-center","aria-label":"Share on Facebook",children:s.jsx(d,{className:"w-5 h-5"})}),s.jsx(l,{variant:"outline",onClick:()=>I("twitter"),disabled:w||!j||!!L,className:"w-full !p-2.5 rounded-lg bg-[#000000]/10 text-[#000000] border-[#000000]/30 hover:bg-[#000000]/20 hover:border-[#000000]/50 dark:bg-white/10 dark:text-white dark:border-white/30 dark:hover:bg-white/20 dark:hover:border-white/50 flex items-center justify-center","aria-label":"Share on X",children:s.jsx(m,{className:"w-5 h-5"})}),s.jsx(l,{variant:"outline",onClick:()=>I("linkedin"),disabled:w||!j||!!L,className:"w-full !p-2.5 rounded-lg bg-[#0077b5]/10 text-[#0077b5] border-[#0077b5]/30 hover:bg-[#0077b5]/20 hover:border-[#0077b5]/50 flex items-center justify-center","aria-label":"Share on LinkedIn",children:s.jsx(x,{className:"w-5 h-5"})})]})]})]}),s.jsx("div",{className:"flex justify-end mt-8 border-t border-[var(--color-modal-border)] pt-5",children:s.jsx(l,{variant:"secondary",onClick:p,size:"md",className:"py-2.5 px-6 rounded-lg",children:g("close")})})]})};M.displayName="ShareModal";const I={shuffleQuestions:!1,shuffleAnswers:!1,timeLimit:""},F=[.25,.1,.25,1],A=({quiz:c,onDelete:d,onEdit:m,animationDelay:x=0})=>{var w,y;const{t:k,language:C}=a(),[S,Q]=e.useState(!1),[A,$]=e.useState(!1),[T,D]=e.useState(I),[R,O]=e.useState({type:"idle",message:k("share")}),[U,_]=e.useState(!1),{setActiveQuiz:B,setQuizResult:E,currentUser:P,showErrorNotification:H}=r(),J=L(),V=null==(w=c.config)?void 0:w.difficulty;let X;X="Easy"===V||"Medium"===V||"Hard"===V?`step2Difficulty${V}`:"dashboardQuizCardDifficulty";const Y=k(X),G=new Date(c.lastModified||c.createdAt).toLocaleDateString(C,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),W=c.lastModified?k("dashboardQuizCardLastModified",{date:G}):k("dashboardQuizCardCreated",{date:G}),K=e=>{const s=localStorage.getItem(`attemptSettings_${e}`);if(s)try{const e=JSON.parse(s);return{...e,timeLimit:0===e.timeLimit?"":e.timeLimit}}catch(a){return z.error("Failed to parse stored attempt settings:","QuizCard",{quizId:e},a),I}return I},Z=e.useCallback(()=>{Q(!1)},[]),ee=e.useCallback(()=>{$(!1)},[]),se=(e,s)=>{if("timeLimit"===e){if(""===s||0===s||"0"===s)return void D(e=>({...e,timeLimit:""}));const e=Number(s);return void D(s=>({...s,timeLimit:isNaN(e)?"":Math.max(1,e)}))}D(a=>({...a,[e]:s}))},ae=e=>{const s=K(c.id);B(c),"take"===e?(E(null),J(`/quiz/${c.id}`,{state:{attemptSettings:s}})):J(`/practice/${c.id}`,{state:{attemptSettings:s}})};let re,te="text-[var(--color-text-secondary)] opacity-80 hover:text-[var(--color-success-accent)] hover:bg-[var(--color-success-accent)]/10 hover:!border-[var(--color-success-accent)]/70";switch(R.type){case"sharing":re=s.jsx(n,{size:"sm",className:"w-4 h-4 !p-0",textClassName:"!hidden"}),te="text-[var(--color-primary-accent)] bg-[var(--color-primary-accent)]/10 !border-[var(--color-primary-accent)]/70 cursor-default";break;case"copied":re=s.jsx(o,{className:"w-4 h-4 text-[var(--color-success-accent)]"}),te="text-[var(--color-success-accent)] bg-[var(--color-success-accent)]/10 !border-[var(--color-success-accent)]/70 hover:!border-[var(--color-success-accent)]";break;case"failed":re=s.jsx(N,{className:"w-4 h-4 text-[var(--color-danger-accent)]"}),te="text-[var(--color-danger-accent)] bg-[var(--color-danger-accent)]/10 !border-[var(--color-danger-accent)]/70 hover:!border-[var(--color-danger-accent)]";break;default:re=s.jsx(u,{className:"w-4 h-4"})}return s.jsxs(s.Fragment,{children:[s.jsx(q.div,{className:"h-full",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.35,ease:F,delay:x},children:s.jsxs(h,{className:"flex flex-col justify-between group relative overflow-hidden !p-0 !rounded-2xl h-full card-float-hover",useGlassEffect:!0,children:[s.jsxs("div",{className:"p-4 sm:p-6 flex-grow pb-4",children:[s.jsx("h3",{className:"text-base sm:text-lg font-semibold text-[var(--color-text-primary)] mb-3 group-hover:text-[var(--color-primary-accent)] line-clamp-2 transition-colors var(--duration-fast) var(--ease-ios)",title:c.title,children:s.jsx(p,{text:c.title,markdownFormatting:!0})}),s.jsxs("div",{className:"mb-3 space-y-2",children:[s.jsxs("div",{className:"text-sm sm:text-xs text-[var(--color-text-secondary)] opacity-90 flex items-center flex-wrap gap-x-3.5 gap-y-2",children:[s.jsx("span",{className:"font-medium text-[var(--color-text-primary)]",children:k("dashboardQuizCardQuestions",{count:c.questions.length})}),s.jsx("span",{className:"text-[var(--color-text-muted)] text-lg",children:"•"}),s.jsx("span",{className:"px-2.5 py-1 rounded-full font-semibold shadow-sm bg-[var(--color-primary-accent)]/20 text-[var(--color-primary-accent)]",children:Y}),(null==(y=c.config)?void 0:y.language)&&s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"text-[var(--color-text-muted)] text-lg",children:"•"}),s.jsx("span",{className:"uppercase text-[0.7rem] sm:text-xs font-bold tracking-wider px-2.5 py-1 rounded-full shadow-sm bg-purple-500/20 text-purple-400",children:c.config.language.substring(0,2)})]})]}),c.sourceContentSnippet&&s.jsxs("div",{className:"text-sm sm:text-xs text-[var(--color-text-secondary)] opacity-90 italic line-clamp-1",title:c.sourceContentSnippet,children:[k("dashboardQuizCardSource",{snippet:""}),s.jsx("span",{children:c.sourceContentSnippet})]}),s.jsx("p",{className:"text-sm sm:text-xs text-[var(--color-text-secondary)] opacity-90 pt-1",children:W})]})]}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-2.5 items-stretch sm:items-center justify-between mt-auto border-t border-[var(--color-border-default)] p-3 sm:p-4 bg-[var(--color-bg-surface-1)]/30 rounded-b-2xl",children:[s.jsxs("div",{className:"flex gap-2.5 w-full sm:w-auto",children:[s.jsx(l,{size:"sm",variant:"primary",onClick:()=>ae("take"),className:"flex-grow sm:flex-grow-0 shadow-lg hover:shadow-[var(--color-primary-accent)]/40 py-2.5 px-4 sm:py-2 sm:px-4 rounded-lg min-h-[44px]",children:k("dashboardQuizCardTakeQuiz")}),s.jsx(l,{size:"sm",variant:"secondary",onClick:()=>ae("practice"),className:"flex-grow sm:flex-grow-0 py-2.5 px-4 sm:py-2 sm:px-4 rounded-lg bg-purple-500/80 hover:bg-purple-500 text-white hover:shadow-purple-400/40 min-h-[44px]",children:k("practiceModeCardButton")})]}),s.jsxs("div",{className:"flex flex-wrap gap-x-2 gap-y-2 w-full sm:w-auto justify-between sm:justify-end items-center",children:[s.jsxs("div",{className:"flex items-center gap-x-2",children:[s.jsx(v,{content:"Analytics",wrapperClassName:"inline-flex",children:s.jsx(l,{size:"sm",variant:"outline",onClick:()=>{P?J(`/quiz-analytics/${c.id}`):H("Please log in to view analytics")},className:"!p-2.5 rounded-lg !border-[var(--color-border-interactive)] hover:!border-[var(--color-primary-accent)] min-w-[40px] min-h-[40px]","aria-label":"Analytics",children:s.jsx(g,{className:"w-4 h-4"})})}),s.jsx(v,{content:k("edit"),wrapperClassName:"inline-flex",children:s.jsx(l,{size:"sm",variant:"outline",onClick:()=>m(c),className:"!p-2.5 rounded-lg !border-[var(--color-border-interactive)] hover:!border-[var(--color-primary-accent)] min-w-[40px] min-h-[40px]","aria-label":k("edit"),children:s.jsx(b,{className:"w-4 h-4",strokeWidth:2})})}),s.jsx(v,{content:k("delete"),wrapperClassName:"inline-flex",children:s.jsx(l,{size:"sm",variant:"outline",onClick:()=>{Q(!0)},className:"!p-2.5 rounded-lg text-[var(--color-text-secondary)] opacity-80 hover:text-[var(--color-danger-accent)] hover:bg-[var(--color-danger-accent)]/10 hover:!border-[var(--color-danger-accent)]/70 !border-[var(--color-border-interactive)] min-w-[40px] min-h-[40px]","aria-label":k("delete"),children:s.jsx(f,{className:"w-4 h-4"})})})]}),s.jsxs("div",{className:"flex items-center gap-x-2",children:[s.jsx(v,{content:"idle"===R.type?k("share"):R.message,placement:"top",wrapperClassName:"inline-flex",children:s.jsx(l,{size:"sm",variant:"outline",onClick:()=>{_(!0),O({type:"idle",message:k("share")})},className:`!p-2.5 rounded-lg !border-[var(--color-border-interactive)] transition-all var(--duration-fast) var(--ease-ios) min-w-[40px] min-h-[40px] ${te}`,"aria-label":k("share"),disabled:"sharing"===R.type,children:re})}),s.jsx(v,{content:k("attemptSettingsModalTitle"),wrapperClassName:"inline-flex",children:s.jsx(l,{size:"sm",variant:"outline",onClick:()=>{D(K(c.id)),$(!0)},className:"!p-2.5 rounded-lg text-[var(--color-text-secondary)] opacity-80 hover:text-[var(--color-primary-accent)] hover:!bg-[var(--color-primary-accent)]/10 hover:!border-[var(--color-primary-accent)]/70 !border-[var(--color-border-interactive)] min-w-[40px] min-h-[40px]","aria-label":k("attemptSettingsModalTitle"),children:s.jsx("img",{src:"https://img.icons8.com/?size=256&id=s5NUIabJrb4C&format=png",alt:k("settings"),className:"w-4 h-4 opacity-80 group-hover:opacity-100"})})})]})]})]})]})}),S&&s.jsx(t,{isOpen:S,onClose:Z,title:k("confirmDeletionTitle"),size:"md",useSolidBackground:!0,footerContent:s.jsxs("div",{className:"flex justify-end gap-4",children:[s.jsx(l,{variant:"secondary",onClick:Z,size:"md",children:k("cancel")}),s.jsx(l,{variant:"danger",onClick:()=>{d(c.id),Q(!1)},size:"md",children:k("confirmDeleteButton")})]}),children:s.jsx("div",{className:"text-[var(--color-text-body)] text-base",children:s.jsx(p,{text:k("confirmDeletionMessage",{quizName:c.title}),markdownFormatting:!0})})}),A&&s.jsx(t,{isOpen:A,onClose:ee,title:k("attemptSettingsModalTitle"),size:"lg",useSolidBackground:!0,footerContent:s.jsxs("div",{className:"flex justify-end gap-4",children:[s.jsx(l,{variant:"secondary",onClick:ee,size:"md",children:k("cancel")}),s.jsx(l,{variant:"primary",onClick:()=>{try{const e={...T,timeLimit:""===T.timeLimit?"":Math.max(0,Number(T.timeLimit)||0)};localStorage.setItem(`attemptSettings_${c.id}`,JSON.stringify(e))}catch(e){z.error("Failed to save attempt settings to localStorage:","QuizCard",{quizId:c.id},e)}$(!1)},size:"md",children:k("saveSettingsButtonText")})]}),children:s.jsxs("div",{className:"space-y-6",children:[s.jsx(j,{label:k("attemptShuffleQuestionsLabel"),checked:T.shuffleQuestions,onChange:e=>se("shuffleQuestions",e)}),s.jsx(j,{label:k("attemptShuffleAnswersLabel"),checked:T.shuffleAnswers,onChange:e=>se("shuffleAnswers",e)}),s.jsx(i,{label:k("attemptTimeLimitLabel"),type:"number",name:"timeLimit",value:""===T.timeLimit?"":T.timeLimit,onChange:e=>{const s=e.target.value;se("timeLimit",""===s?"":Math.max(0,parseInt(s,10)||0))},min:"0",containerClassName:"mt-4",inputClassName:"w-32",placeholder:k("attemptTimeLimitInfo")+" (leave empty for infinite)"})]})}),U&&s.jsx(M,{isOpen:U,onClose:()=>_(!1),quiz:c})]})},$=()=>s.jsxs("div",{className:"bg-[var(--color-bg-surface-1)] shadow-lg rounded-2xl p-0 overflow-hidden h-full border border-[var(--color-border-default)]",children:[" ",s.jsxs("div",{className:"p-4 sm:p-6 pb-4 animate-pulse",children:[s.jsx("div",{className:"h-5 bg-[var(--color-bg-surface-2)] rounded w-3/4 mb-3"}),s.jsx("div",{className:"h-5 bg-[var(--color-bg-surface-2)] rounded w-1/2 mb-4 sm:mb-5"}),s.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[s.jsx("div",{className:"h-4 bg-[var(--color-bg-surface-2)] rounded w-20"}),s.jsx("div",{className:"h-4 bg-[var(--color-bg-surface-2)] rounded w-24"}),s.jsx("div",{className:"h-4 bg-[var(--color-bg-surface-2)] rounded w-12"})]}),s.jsx("div",{className:"h-3 bg-[var(--color-bg-surface-2)] rounded w-full mb-2"}),s.jsx("div",{className:"h-3 bg-[var(--color-bg-surface-2)] rounded w-1/3"})]}),s.jsxs("div",{className:"border-t border-[var(--color-border-default)] p-3 sm:p-4 bg-[var(--color-bg-surface-1)]/50 animate-pulse mt-auto",children:[" ",s.jsxs("div",{className:"flex gap-2.5 mb-2.5",children:[" ",s.jsx("div",{className:"h-10 bg-[var(--color-bg-surface-2)] rounded flex-grow"}),s.jsx("div",{className:"h-10 bg-[var(--color-bg-surface-2)] rounded flex-grow"})]}),s.jsxs("div",{className:"flex flex-wrap gap-x-2 gap-y-2 justify-between",children:[" ",s.jsxs("div",{className:"flex items-center gap-x-2",children:[s.jsx("div",{className:"h-8 w-8 bg-[var(--color-bg-surface-2)] rounded-lg"}),s.jsx("div",{className:"h-8 w-8 bg-[var(--color-bg-surface-2)] rounded-lg"})]}),s.jsxs("div",{className:"flex items-center gap-x-2",children:[s.jsx("div",{className:"h-8 w-8 bg-[var(--color-bg-surface-2)] rounded-lg"}),s.jsx("div",{className:"h-8 w-8 bg-[var(--color-bg-surface-2)] rounded-lg"})]})]})]})]});$.displayName="QuizCardSkeleton";const T=({question:e,index:r,isCorrect:t})=>{const{t:i}=a(),l=i("resultsQuestionItem",{index:r+1}),c=function(e){const s=function(e){return e.replace(/^#+\s*Câu hỏi\s*\d*\s*$/gm,"").replace(/^#+\s+/gm,"").replace(/<[^>]*>?/gm,"").replace(/\[([^\]]+)\]\([^)]+\)/g,"$1").replace(/\{#[^}]+\}/g,"").replace(/cu-hi-\d+/g,"").replace(/\n+/g," ").replace(/\s+/g," ").trim()}(e),a=s.match(/(?:Thông báo|Câu hỏi|[^.!?]+\?)/);return a?a[0].trim():s}(e.questionText);return s.jsxs("div",{className:"flex items-start w-full gap-3",children:[s.jsx("div",{className:"flex items-center justify-center w-8 h-8 sm:w-9 sm:h-9 rounded-lg flex-shrink-0 mt-0.5 "+(t?"bg-green-100 dark:bg-green-500/20 text-green-600 dark:text-green-300":"bg-red-100 dark:bg-red-500/20 text-red-600 dark:text-red-300"),children:t?s.jsx(o,{className:"w-5 h-5"}):s.jsx(N,{className:"w-5 h-5"})}),s.jsxs("div",{className:"ml-1 flex-grow min-w-0 inline-flex items-baseline",children:[s.jsx("span",{className:"text-[var(--color-text-secondary)] text-xs font-semibold mr-1.5",children:l}),s.jsx("span",{className:"text-[var(--color-text-primary)] font-medium text-sm md:text-base leading-relaxed whitespace-pre-line",children:c})]})]})},D=({question:r,options:t,currentIndex:i,totalQuestions:o,selectedOption:c,onSelectOption:n,onCheckAnswer:d,onSkipQuestion:m,isSubmitting:x,isAnswerChecked:u=!1,isAnswerCorrect:h=null,correctAnswer:p=""})=>{const{t:v}=a(),g=o>0?(i+1)/o*100:0,b=e.useMemo(()=>r?r.replace(/🔗/g,"").replace(/<a[^>]*>/g,"").replace(/<\/a>/g,"").replace(/<svg[^>]*>.*?<\/svg>/g,"").replace(/\s*\[\s*link\s*\]\s*/gi,"").replace(/\s*\[\s*chain\s*\]\s*/gi,""):"",[r]);return s.jsxs("div",{className:"quiz-question-container",children:[s.jsxs("div",{className:"quiz-progress",children:[s.jsx("div",{className:"flex justify-between items-center mb-1.5",children:s.jsx("span",{className:"text-sm font-medium text-[var(--color-text-primary)]",children:v("quizTakingQuestionProgress",{current:i+1,total:o})})}),s.jsx(w,{progress:g,size:"md",className:"mb-5"})]}),s.jsx("div",{className:"question-content mb-4",onClick:e=>{const s=e.target;("A"===s.tagName||s.closest("a"))&&(e.preventDefault(),e.stopPropagation())},children:s.jsx(y,{content:b})}),s.jsx("div",{className:"question-options space-y-2.5",children:t.map((e,a)=>{const r=c===e,t=u&&e===p;let i="flex w-full p-3.5 rounded-lg border transition-all duration-300 ease-in-out",l="text-[var(--color-text-body)]";r?u?h?(i+=" border-green-500 bg-green-500/10",l="text-green-700 dark:text-green-300 font-medium"):(i+=" border-red-500 bg-red-500/10",l="text-red-700 dark:text-red-300"):(i+=" border-[var(--color-primary-accent)] bg-[var(--color-primary-accent)]/10",l="text-[var(--color-primary-accent)] font-medium"):u&&e===p?(i+=" border-blue-500 bg-blue-500/10",l="text-blue-700 dark:text-blue-300 font-medium"):i+=" border-[var(--color-border-default)] bg-[var(--color-bg-surface-2)]/50 hover:bg-[var(--color-bg-surface-2)]";const o=/^[A-D]\.\s/.test(e.trim());return s.jsxs("button",{className:i,onClick:()=>n(e),disabled:u||x,"aria-checked":r,role:"radio","aria-disabled":u||x,children:[!o&&s.jsx("div",{className:"option-index mr-3 min-w-[1.5rem] h-6 flex items-center justify-center rounded-full text-xs font-bold",children:String.fromCharCode(65+a)}),s.jsx("div",{className:`option-content flex-grow text-sm sm:text-base flex items-center ${l}`,children:s.jsx(y,{content:e,compact:!0})}),u&&s.jsx("span",{className:"ml-2",children:t?s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-green-500",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}):r&&!h?s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-red-500",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}):null})]},a)})}),s.jsx("div",{className:"quiz-actions flex gap-3 mt-6",children:u?s.jsx(l,{variant:"primary",onClick:m,className:"w-full",children:v("nextQuestion")}):s.jsxs(s.Fragment,{children:[s.jsx(l,{variant:"primary",onClick:d,disabled:!c||x,className:"flex-1",isLoading:x,children:v("checkAnswer")}),s.jsx(l,{variant:"outline",onClick:m,disabled:x,className:"flex-grow-0 px-4",children:v("skipQuestion")})]})})]})},R=({explanation:e,className:r=""})=>{const{t:t}=a();return s.jsxs("div",{className:`animate-fadeInUp mt-5 p-5 rounded-lg bg-[var(--color-bg-surface-2)]/50 border border-[var(--color-border-default)] shadow-md ${r}`,children:[s.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-[var(--color-primary-accent)]",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2h-1V9a1 1 0 00-1-1z",clipRule:"evenodd"})}),s.jsx("span",{className:"font-semibold text-[var(--color-primary-accent)] text-base",children:t("resultsExplanationTitle")})]}),s.jsx("div",{className:"explanation-content",children:s.jsx("div",{className:"pl-1.5 border-l-2 border-[var(--color-primary-accent)]/20",children:s.jsx("div",{className:"explanation-text text-sm leading-relaxed text-[var(--color-text-body)]",children:s.jsx(y,{content:e})})})})]})},O=({quizId:r,isOwner:t,currentUserId:i})=>{a();const[o,c]=e.useState([]),[d,m]=e.useState(!0),[x,u]=e.useState(null);e.useEffect(()=>{p()},[r,t,i]);const p=async()=>{try{m(!0),u(null);const e=await S.getQuizHistory({quizId:r,userId:t?void 0:i,limit:20});c(e),m(!1),z.info("Quiz history loaded","QuizHistory",{quizId:r,resultCount:e.length,isOwner:t})}catch(e){z.error("Failed to load quiz history","QuizHistory",{},e),u("Failed to load history"),m(!1)}};return d?s.jsx(h,{className:"p-4",children:s.jsxs("div",{className:"flex items-center justify-center py-4",children:[s.jsx(n,{}),s.jsx("span",{className:"ml-2 text-sm text-[var(--color-text-secondary)]",children:"Loading history..."})]})}):x?s.jsx(h,{className:"p-4",children:s.jsxs("div",{className:"text-center py-4",children:[s.jsx("p",{className:"text-sm text-[var(--color-danger-accent)] mb-2",children:x}),s.jsx(l,{onClick:p,variant:"outline",size:"sm",children:"Retry"})]})}):0===o.length?s.jsx(h,{className:"p-4",children:s.jsx("div",{className:"text-center py-4",children:s.jsx("p",{className:"text-sm text-[var(--color-text-secondary)]",children:t?"No attempts yet":"You haven't taken this quiz yet"})})}):s.jsxs(h,{className:"p-4",children:[s.jsx("div",{className:"flex items-center justify-between mb-3",children:s.jsxs("h3",{className:"text-lg font-semibold text-[var(--color-text-primary)]",children:[t?"Recent Results":"Your Results"," (",o.length,")"]})}),s.jsx("div",{className:"space-y-2",children:o.map(e=>{return s.jsx("div",{className:"flex items-center justify-between p-3 bg-[var(--color-bg-surface-2)] rounded-lg hover:bg-[var(--color-bg-surface-3)] transition-colors duration-200",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(k,{user:{id:e.user_id||"",name:e.user_name||"Anonymous",email:e.user_email||"",imageUrl:e.user_image_url},size:"sm",className:"w-8 h-8"}),s.jsx("span",{className:"text-sm font-medium text-[var(--color-text-primary)]",children:e.user_name||"Anonymous"})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsxs("span",{className:"text-base font-semibold "+(t=e.score,t>=80?"text-[var(--color-success-accent)]":t>=60?"text-[var(--color-warning-accent)]":"text-[var(--color-danger-accent)]"),children:[e.score,"%"]}),s.jsxs("span",{className:"text-xs text-[var(--color-text-secondary)]",children:["(",Math.round(e.score/100*e.total_questions),"/",e.total_questions,")"]})]}),s.jsx("div",{className:"flex items-center space-x-2",children:s.jsx("span",{className:"text-sm text-[var(--color-text-secondary)]",children:(a=e.time_taken,a?`${Math.floor(a/60)}m ${Math.round(a%60)}s`:"--:--")})}),s.jsx("span",{className:"text-xs text-[var(--color-text-muted)]",children:(r=e.created_at,new Date(r).toLocaleDateString("vi-VN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}))})]})},e.id);var a,r,t})}),o.length>=20&&s.jsx("div",{className:"mt-3 text-center",children:s.jsx(l,{variant:"ghost",size:"sm",onClick:p,children:"Load More"})})]})};export{T as A,D as P,$ as Q,A as a,R as b,O as c};
