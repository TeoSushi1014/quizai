import{l as o}from"./index-B8PSnp0g.js";import"./ui-BGuvgkTr.js";import"./router-BxjC687J.js";import"./vendor-DoC2WAmd.js";import"./utils-rUpm7H1u.js";import"./markdown-Bj7tmv2T.js";const u="https://jbuqonmeorldgiwvdror.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpidXFvbm1lb3JsZGdpd3Zkcm9yIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc0ODMxNjYwNCwiZXhwIjoyMDYzODkyNjA0fQ.qul2BaYdkubaXlgRmXBFtQZI3Ok_P_SokuP9nC2mVDU";class h{constructor(){this.baseUrl=`${u}/rest/v1`,this.headers={apikey:l,Authorization:`Bearer ${l}`,"Content-Type":"application/json",Prefer:"return=representation","x-client-info":"quizai-service-role-api"}}async getQuizzes(e){try{const t=new URLSearchParams({select:"*",user_id:`eq.${e}`,order:"created_at.desc"}),s=`${this.baseUrl}/quizzes?${t.toString()}`;o.info("ServiceRoleApi: Fetching user quizzes","ServiceRoleApi",{userId:e});const r=await fetch(s,{method:"GET",headers:this.headers});if(!r.ok){const a=await r.text();return o.error("ServiceRoleApi: Failed to fetch quizzes","ServiceRoleApi",{status:r.status,error:a,userId:e}),{data:null,error:{message:a,status:r.status}}}const i=await r.json();return o.info("ServiceRoleApi: Successfully fetched quizzes","ServiceRoleApi",{userId:e,count:i.length}),{data:i,error:null}}catch(t){const s=t instanceof Error?t.message:"Unknown error";return o.error("ServiceRoleApi: Network error fetching quizzes","ServiceRoleApi",{error:s,userId:e}),{data:null,error:{message:s}}}}async getQuizById(e,t){try{const s=new URLSearchParams({select:"*",id:`eq.${e}`,user_id:`eq.${t}`,limit:"1"}),r=`${this.baseUrl}/quizzes?${s.toString()}`;o.info("ServiceRoleApi: Fetching quiz by ID","ServiceRoleApi",{quizId:e,userId:t});const i=await fetch(r,{method:"GET",headers:this.headers});if(!i.ok){const c=await i.text();return o.error("ServiceRoleApi: Failed to fetch quiz","ServiceRoleApi",{status:i.status,error:c,quizId:e,userId:t}),{data:null,error:{message:c,status:i.status}}}const a=await i.json(),n=Array.isArray(a)&&a.length>0?a[0]:null;return o.info("ServiceRoleApi: Successfully fetched quiz","ServiceRoleApi",{quizId:e,userId:t,found:!!n}),{data:n,error:null}}catch(s){const r=s instanceof Error?s.message:"Unknown error";return o.error("ServiceRoleApi: Network error fetching quiz","ServiceRoleApi",{error:r,quizId:e,userId:t}),{data:null,error:{message:r}}}}async getSharedQuizByQuizId(e){try{const t=new URLSearchParams({select:"id,quiz_id,share_token,is_public,expires_at,created_at",quiz_id:`eq.${e}`,is_public:"eq.true",limit:"1"}),s=`${this.baseUrl}/shared_quizzes?${t.toString()}`;o.info("ServiceRoleApi: Fetching shared quiz by quiz_id","ServiceRoleApi",{quizId:e});const r=await fetch(s,{method:"GET",headers:this.headers});if(!r.ok){const n=await r.text();return o.error("ServiceRoleApi: Failed to fetch shared quiz","ServiceRoleApi",{status:r.status,error:n,quizId:e}),{data:null,error:{message:n,status:r.status}}}const i=await r.json(),a=Array.isArray(i)&&i.length>0?i[0]:null;return o.info("ServiceRoleApi: Successfully fetched shared quiz","ServiceRoleApi",{quizId:e,found:!!a}),{data:a,error:null}}catch(t){const s=t instanceof Error?t.message:"Unknown error";return o.error("ServiceRoleApi: Network error fetching shared quiz","ServiceRoleApi",{error:s,quizId:e}),{data:null,error:{message:s}}}}async getSharedQuizByToken(e){try{const t=new URLSearchParams({select:"id,quiz_id,share_token,is_public,expires_at,created_at",share_token:`eq.${e}`,is_public:"eq.true",limit:"1"}),s=`${this.baseUrl}/shared_quizzes?${t.toString()}`;o.info("ServiceRoleApi: Fetching shared quiz by token","ServiceRoleApi",{shareToken:e});const r=await fetch(s,{method:"GET",headers:this.headers});if(!r.ok){const n=await r.text();return o.error("ServiceRoleApi: Failed to fetch shared quiz by token","ServiceRoleApi",{status:r.status,error:n,shareToken:e}),{data:null,error:{message:n,status:r.status}}}const i=await r.json(),a=Array.isArray(i)&&i.length>0?i[0]:null;return o.info("ServiceRoleApi: Successfully fetched shared quiz by token","ServiceRoleApi",{shareToken:e,found:!!a}),{data:a,error:null}}catch(t){const s=t instanceof Error?t.message:"Unknown error";return o.error("ServiceRoleApi: Network error fetching shared quiz by token","ServiceRoleApi",{error:s,shareToken:e}),{data:null,error:{message:s}}}}async getUserById(e){try{const t=new URLSearchParams({select:"name,email",id:`eq.${e}`,limit:"1"}),s=`${this.baseUrl}/users?${t.toString()}`;o.info("ServiceRoleApi: Fetching user by ID","ServiceRoleApi",{userId:e});const r=await fetch(s,{method:"GET",headers:this.headers});if(!r.ok){const n=await r.text();return o.error("ServiceRoleApi: Failed to fetch user","ServiceRoleApi",{status:r.status,error:n,userId:e}),{data:null,error:{message:n,status:r.status}}}const i=await r.json(),a=Array.isArray(i)&&i.length>0?i[0]:null;return o.info("ServiceRoleApi: Successfully fetched user","ServiceRoleApi",{userId:e,found:!!a}),{data:a,error:null}}catch(t){const s=t instanceof Error?t.message:"Unknown error";return o.error("ServiceRoleApi: Network error fetching user","ServiceRoleApi",{error:s,userId:e}),{data:null,error:{message:s}}}}}const R=new h;export{R as serviceRoleApi};
