import{i as J,k as K,E as V,m as W,r as o,j as e,F as q,C as B,o as j,q as X,B as u,x as Y,s as Z,y as M}from"./index-BOozfOqE.js";import{u as _}from"./useQuizFlow-BjDKNMUx.js";const ee=()=>{const{setQuizResult:C}=J(),{t}=K(),{quizId:U}=V(),w=W(),[n,y]=o.useState({}),[a,g]=o.useState(null),[k,f]=o.useState(!1),[N,z]=o.useState(!1),F=o.useCallback(()=>{z(!0)},[]),{localActiveQuiz:i,currentQuestion:s,currentQuestionIndex:p,loading:L,timeLeft:m,goToNextQuestion:P,goToPreviousQuestion:E,formatTime:O,totalQuestions:l,attemptSettings:v}=_(U,F);o.useEffect(()=>{s&&n[s.id]?g(n[s.id]):g(null)},[s,n]);const $=r=>{g(r)},T=o.useCallback(()=>{s&&a?y(r=>({...r,[s.id]:a})):s&&!a&&n[s.id]&&y(r=>{const c={...r};return delete c[s.id],c})},[s,a,n]),h=o.useCallback(()=>{if(!i)return;let r={...n};s&&a?r[s.id]=a:s&&!a&&r[s.id]&&delete r[s.id];let c=0;const d=[];i.questions.forEach(x=>{const b=r[x.id];b?(d.push({questionId:x.id,answer:b}),b===x.correctAnswer&&c++):d.push({questionId:x.id,answer:""})});const I=l>0?c/l*100:0,A={quizId:i.id,score:parseFloat(I.toFixed(2)),answers:d,totalCorrect:c,totalQuestions:l,timeTaken:v.timeLimit>0?v.timeLimit*60-(m||0):void 0,sourceMode:"take",createdAt:new Date().toISOString()};C(A),f(!1),z(!1),w(`/results/${i.id}`)},[i,n,s,a,m,C,w,l,v.timeLimit]),R=()=>{i&&(T(),P()||f(!0))},D=()=>{T(),E()},S=o.useCallback(()=>f(!1),[]),Q=o.useCallback(()=>{h()},[h]);if(L||!i)return e.jsx(q,{text:t("quizTakingLoading"),className:"mt-24",size:"xl"});if(!s)return e.jsxs(B,{className:"max-w-3xl mx-auto p-5 sm:p-6 md:p-8 animate-fadeInUp rounded-lg bg-[var(--color-bg-surface-2)]/50 border border-[var(--color-border-default)] shadow-md",children:[e.jsx(q,{text:t("quizTakingLoading")}),e.jsx("p",{className:"text-center text-[var(--color-text-secondary)] mt-4",children:t("quizTakingErrorQuestionNotFound")})]});const G=l>0?(p+1)/l*100:0,H=p===l-1;return e.jsxs(B,{className:"max-w-3xl mx-auto p-5 sm:p-6 md:p-8 animate-fadeInUp rounded-lg bg-[var(--color-bg-surface-2)]/50 border border-[var(--color-border-default)] shadow-md",children:[e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-[var(--color-text-primary)] mb-3 sm:mb-4 leading-tight tracking-tight line-clamp-2",title:i.title,children:e.jsx(j,{text:i.title,markdownFormatting:!0})}),e.jsxs("div",{className:"flex justify-between items-center text-sm text-[var(--color-text-secondary)] mb-4 sm:mb-5",children:[e.jsx("span",{children:t("quizTakingQuestionProgress",{current:p+1,total:l})}),m!==null&&e.jsx("span",{className:`font-semibold ${m<=60?"text-red-400 animate-pulse":"text-[var(--color-primary-accent)]"}`,children:t("quizTakingTimeLeft",{time:O(m)})})]}),e.jsx(X,{progress:G,size:"md"})]}),e.jsxs("div",{className:"mt-6 md:mt-8",children:[e.jsxs("div",{className:"quiz-question-text text-base sm:text-lg text-[var(--color-text-body)] leading-relaxed mb-4",children:[" ",e.jsx(j,{text:s.questionText,markdownFormatting:!0})]}),e.jsxs("div",{className:"quiz-options space-y-3",children:[" ",s.options.map((r,c)=>{const d=a===r;return e.jsxs("button",{onClick:()=>$(r),className:`w-full flex items-center text-left p-3.5 sm:p-4 rounded-xl border-2 focus:outline-none focus-visible:ring-4 focus-visible:ring-[var(--color-primary-accent)]/50 focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--color-bg-default)] shadow-lg transition-all var(--duration-fast) var(--ease-ios) will-change-transform, border, background-color ${d?"bg-[var(--color-primary-accent)]/50 border-[var(--color-primary-accent)] text-[var(--color-primary-accent-text)] font-semibold scale-[1.01]":"bg-[var(--color-bg-surface-3)]/70 hover:bg-[var(--color-bg-surface-3)]/40 border-[var(--color-border-interactive)] hover:border-[var(--color-primary-accent)] text-[var(--color-text-primary)]"}`,"aria-pressed":d,children:[e.jsx("span",{className:`option-indicator mr-3.5 flex-shrink-0 w-6 h-6 rounded-full border-2 flex items-center justify-center transition-colors var(--duration-fast) var(--ease-ios) ${d?"border-[var(--color-primary-accent-text)] bg-[var(--color-primary-accent)]":"border-[var(--color-text-muted)] bg-[var(--color-bg-surface-2)] group-hover:border-[var(--color-primary-accent)]"}`}),e.jsx("div",{className:"text-sm sm:text-base flex-grow markdown-content",children:e.jsx(j,{text:r,markdownFormatting:!0})})]},c)})]})]}),e.jsxs("div",{className:"flex flex-col space-y-3 pt-6 sm:pt-8 border-t border-[var(--color-border-default)] mt-6 sm:mt-8",children:[e.jsx(u,{onClick:R,disabled:!a&&!(s&&n[s.id]),variant:"primary",size:"lg",rightIcon:e.jsx(Y,{className:"w-5 h-5"}),className:"w-full py-3 rounded-xl",children:t(H?"submit":"nextQuestion")}),e.jsxs("div",{className:"flex justify-between items-center pt-3",children:[e.jsx(u,{onClick:D,disabled:p===0,variant:"outline",size:"md",leftIcon:e.jsx(Z,{className:"w-4 h-4"}),className:"py-2.5 px-5 rounded-lg",children:t("previous")}),e.jsx(u,{onClick:()=>f(!0),variant:"outline",size:"md",className:"py-2.5 px-5 rounded-lg",children:t("quizTakingSubmitQuiz")})]})]}),k&&e.jsx(M,{isOpen:k,onClose:S,title:t("quizTakingSubmitQuiz"),size:"md",footerContent:e.jsxs("div",{className:"flex justify-end gap-3.5",children:[e.jsx(u,{variant:"secondary",onClick:S,size:"md",children:t("cancel")}),e.jsx(u,{variant:"primary",onClick:h,size:"md",children:t("submit")})]}),children:e.jsx("p",{className:"text-[var(--color-text-body)] text-base leading-relaxed",children:t("submitConfirmationMessage")})}),N&&e.jsx(M,{isOpen:N,onClose:Q,title:t("timesUp"),size:"md",hideCloseButton:!0,footerContent:e.jsx("div",{className:"flex justify-center",children:e.jsx(u,{variant:"primary",onClick:Q,size:"md",children:t("timesUpSubmit")})}),children:e.jsx("p",{className:"text-[var(--color-text-body)] text-base leading-relaxed text-center",children:t("timesUpMessage")})})]})};ee.displayName="QuizTakingPage";export{ee as default};
