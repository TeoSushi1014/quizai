import{j as e,m as r}from"./ui-BGuvgkTr.js";import{u as P,r as i}from"./router-BxjC687J.js";import{c as S,u as k,L as I,B as l,C as u,V as E,f as z,i as B,l as b}from"./index-B5YPul_d.js";import"./vendor-DoC2WAmd.js";import"./utils-rUpm7H1u.js";import"./markdown-Bj7tmv2T.js";const L=()=>{const{t:s}=S(),{currentUser:a,updateUserProfile:g,isLoading:y}=k(),j=P(),[o,m]=i.useState((a==null?void 0:a.name)||""),[n,x]=i.useState((a==null?void 0:a.bio)||""),[c,p]=i.useState(!1),[f,h]=i.useState(!1);if(i.useEffect(()=>{a&&(m(a.name||""),x(a.bio||""))},[a]),y&&!a)return e.jsx("div",{className:"flex justify-center items-center min-h-[calc(100vh-200px)]",children:e.jsx(I,{size:"xl",text:s("loading")})});if(!a)return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[calc(100vh-200px)] text-center p-5",children:[e.jsx("p",{className:"text-xl font-semibold text-[var(--color-text-primary)] mb-4",children:s("error")}),e.jsx("p",{className:"text-base text-[var(--color-text-secondary)] mb-8",children:"User not found. Please sign in to view your profile."}),e.jsx(l,{onClick:()=>window.location.hash="/signin",variant:"primary",className:"py-2.5 px-5 sm:px-6 rounded-lg transform transition-transform hover:scale-[1.03] active:scale-[0.98]",children:s("signIn")})]});const N=async()=>{if(!a)return;h(!0),b.info("Attempting to save profile","ProfilePage",{userId:a.id,newName:o,newBioLength:n.length}),await g({name:o,bio:n})?p(!1):b.error("Profile update failed in ProfilePage after context call.","ProfilePage",{userId:a.id}),h(!1)},v=()=>{m(a.name||""),x(a.bio||""),p(!1)},d={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5,ease:"easeOut"}}},w=[{labelKey:"profileQuizzes",value:a.quizCount,suffix:""},{labelKey:"profileCompletions",value:a.completionCount,suffix:""},{labelKey:"profileAvgScore",value:a.averageScore,suffix:a.averageScore!==null&&a.averageScore!==void 0?"%":""}];return e.jsxs(r.div,{className:"container mx-auto py-6 sm:py-8 md:py-10 max-w-4xl",initial:"hidden",animate:"visible",variants:{visible:{transition:{staggerChildren:.1}}},children:[e.jsx(r.h1,{variants:d,className:"text-3xl sm:text-4xl font-bold text-[var(--color-text-primary)] mb-8 sm:mb-10 text-center tracking-tight",children:s("profile")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 sm:gap-8",children:[e.jsx(r.div,{variants:d,className:"md:col-span-1",children:e.jsxs(u,{useGlassEffect:!0,className:"p-6 sm:p-8 flex flex-col items-center justify-center text-center !rounded-2xl shadow-xl",children:[e.jsx("div",{className:"mb-5",children:e.jsx(E,{user:a,size:"lg",className:"border-4 border-[var(--color-primary-accent)] shadow-lg"})}),e.jsx("h2",{className:"text-xl font-semibold text-[var(--color-text-primary)] mb-1 truncate max-w-full",title:a.name||void 0,children:a.name||s("user")}),e.jsx("p",{className:"text-sm text-[var(--color-text-secondary)] mb-6 truncate max-w-full",title:a.email||void 0,children:a.email}),e.jsx("div",{className:"mt-auto w-full",children:e.jsx(l,{variant:c?"secondary":"primary",size:"md",className:"w-full py-2.5 rounded-lg shadow-md",onClick:()=>c?v():p(!0),children:s(c?"cancel":"edit")})})]})}),e.jsx(r.div,{variants:d,className:"md:col-span-2",children:e.jsxs(u,{useGlassEffect:!0,className:"p-6 sm:p-8 !rounded-2xl shadow-xl",children:[e.jsx("h2",{className:"text-xl font-semibold text-[var(--color-text-primary)] mb-6 border-b border-[var(--color-border-default)] pb-4",children:s("profileInformation")}),c?e.jsxs(r.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-5",children:[e.jsx(z,{label:e.jsx("span",{className:"text-sm font-medium text-[var(--color-text-secondary)]",children:s("profileName")}),value:o,onChange:t=>m(t.target.value),placeholder:s("profileNamePlaceholder"),inputClassName:"text-base"}),e.jsx(B,{label:e.jsx("span",{className:"text-sm font-medium text-[var(--color-text-secondary)]",children:s("profileBio")}),value:n,onChange:t=>x(t.target.value),placeholder:s("profileBioPlaceholder"),rows:4,className:"min-h-[100px] text-base"}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-3",children:[e.jsx(l,{variant:"secondary",size:"md",onClick:v,className:"py-2.5 px-6 rounded-lg",children:s("cancel")}),e.jsx(l,{variant:"primary",size:"md",onClick:N,isLoading:f,className:"py-2.5 px-6 rounded-lg shadow-lg",children:s(f?"savingButton":"save")})]})]}):e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"animate-fadeIn",children:[e.jsx("h3",{className:"text-xs font-semibold text-[var(--color-text-muted)] uppercase tracking-wider mb-1",children:s("profileName")}),e.jsx("p",{className:"text-[var(--color-text-primary)] text-base",children:o||"-"})]}),e.jsxs("div",{className:"animate-fadeIn",style:{animationDelay:"0.1s"},children:[e.jsx("h3",{className:"text-xs font-semibold text-[var(--color-text-muted)] uppercase tracking-wider mb-1",children:s("profileEmail")}),e.jsx("p",{className:"text-[var(--color-text-primary)] text-base",children:a.email||"-"})]}),e.jsxs("div",{className:"animate-fadeIn",style:{animationDelay:"0.2s"},children:[e.jsx("h3",{className:"text-xs font-semibold text-[var(--color-text-muted)] uppercase tracking-wider mb-1",children:s("profileBio")}),e.jsx("p",{className:"text-[var(--color-text-primary)] text-base whitespace-pre-line break-words",children:n||e.jsx("span",{className:"italic text-[var(--color-text-muted)]",children:s("profileBioPlaceholder")})})]})]})]})}),e.jsx(r.div,{variants:d,className:"md:col-span-3",children:e.jsxs(u,{useGlassEffect:!0,className:"p-6 sm:p-8 !rounded-2xl shadow-xl",children:[e.jsx("h2",{className:"text-xl font-semibold text-[var(--color-text-primary)] mb-6 border-b border-[var(--color-border-default)] pb-4",children:s("profileStats")}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 sm:gap-5",children:w.map((t,C)=>e.jsxs(r.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.3,delay:.1*C,ease:"easeOut"},className:"bg-[var(--color-bg-surface-2)]/50 p-5 rounded-xl border border-[var(--color-border-default)] text-center shadow-md hover:shadow-lg transition-shadow",children:[e.jsx("h3",{className:"text-xs font-semibold text-[var(--color-text-muted)] uppercase tracking-wider mb-1.5",children:s(t.labelKey)}),e.jsxs("p",{className:"text-3xl font-bold text-[var(--color-primary-accent)]",children:[t.value!==void 0&&t.value!==null?t.value:"-",t.suffix]})]},t.labelKey))}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx(l,{variant:"outline",onClick:()=>j("/history"),className:"px-6 py-2",children:"ðŸ“Š View Quiz History"})})]})})]})]})};L.displayName="ProfilePage";export{L as default};
