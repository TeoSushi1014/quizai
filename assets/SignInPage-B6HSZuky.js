import{h as p,i as x,k as P,V as y,R as I,l as n,a3 as w,j as t,C as S,B as v}from"./index-fFP91eYx.js";const j={},k=()=>{const{login:u,currentUser:c}=p(),{t:s}=x(),l=P(),g=y(),d=void 0;I.useEffect(()=>{var e,o;if(c){const i=((o=(e=g.state)==null?void 0:e.from)==null?void 0:o.pathname)||"/dashboard";n.info("User already signed in, redirecting.","SignInPage",{from:i}),l(i,{replace:!0})}},[c,l,g.state]);const a=e=>{n.error("Google Login Failed.","SignInPage",{errorDetails:e})},r=w({onSuccess:async e=>{if(n.info("Google Login Succeeded (token obtained).","SignInPage",{hasAccessToken:!!e.access_token}),e.access_token)try{const o=await fetch("https://www.googleapis.com/oauth2/v3/userinfo",{headers:{Authorization:`Bearer ${e.access_token}`}});if(!o.ok){const m=await o.json().catch(()=>({message:"Failed to parse error response from userinfo endpoint"}));n.error("Failed to fetch user info from Google.","SignInPage",{status:o.status,errorData:m}),a(m);return}const i=await o.json(),f={id:i.sub,name:i.name,email:i.email,imageUrl:i.picture};n.info("User info fetched successfully. Calling login context function.","SignInPage",{userId:f.id}),u(f,e.access_token)}catch(o){n.error("Error during token validation or fetching user info.","SignInPage",void 0,o),a(o)}else n.error("Login success callback, but no access_token in tokenResponse.","SignInPage",{tokenResponse:e}),a(e)},onError:a,scope:"email profile https://www.googleapis.com/auth/drive.file"}),h=()=>{if(n.info("Custom Google Login button clicked.","SignInPage"),!d){n.warn("VITE_RECAPTCHA_SITE_KEY is not configured. Proceeding with login directly.","SignInPage"),r();return}if(typeof grecaptcha>"u"||typeof grecaptcha.enterprise>"u"||typeof grecaptcha.enterprise.ready!="function"){n.warn("reCAPTCHA enterprise.js not loaded or not ready. Proceeding with login directly.","SignInPage"),r();return}grecaptcha.enterprise.ready(async()=>{try{const e=await grecaptcha.enterprise.execute(d,{action:"LOGIN"});n.info("reCAPTCHA token obtained for LOGIN action.","SignInPage",{tokenPreview:e.slice(0,10)+"..."}),n.info("Skipping reCAPTCHA assessment for now. Proceeding with login.","SignInPage"),r()}catch(e){n.error("Lỗi khi thực thi reCAPTCHA (token generation):","SignInPage",void 0,e),r()}})};return t.jsx("div",{className:"flex flex-col items-center justify-center min-h-[calc(100vh-250px)] py-10 sm:py-16",children:t.jsxs(S,{className:"max-w-md w-full text-center shadow-2xl p-8 sm:p-10 md:p-12 !rounded-2xl",useGlassEffect:!0,children:[t.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-slate-50 mb-4 mt-8 sm:mt-10",children:s("signInTitle")}),t.jsx("p",{className:"text-slate-300/80 mb-10 text-sm",children:s("signInSubtitle")}),t.jsx("div",{className:"flex justify-center mb-8",children:t.jsx(v,{onClick:h,variant:"outline",size:"lg",leftIcon:t.jsx("img",{src:"https://img.icons8.com/color/48/google-logo.png",alt:"Google",className:"w-5 h-5"}),className:"w-full max-w-xs sm:w-[280px] !justify-start !text-slate-200 !bg-slate-700/60 hover:!bg-slate-600/80 !border-slate-600 hover:!border-slate-500 !px-4 !py-3 !rounded-lg shadow-md",children:t.jsx("span",{className:"ml-3 text-sm font-medium",children:s("loginWithGoogle")})})}),t.jsxs("p",{className:"text-xs text-slate-400/80",children:[s("signInAgreementPrompt")," "," ",t.jsx("a",{href:"#",className:"text-sky-400 hover:underline font-medium",children:s("footerTerms")})," ",s("and")," "," ",t.jsx("a",{href:"#",className:"text-sky-400 hover:underline font-medium",children:s("footerPrivacy")}),"."]})]})})};k.displayName="SignInPage";export{k as default};
